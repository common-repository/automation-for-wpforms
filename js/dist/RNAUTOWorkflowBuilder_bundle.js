rndefine("#RNAUTOWorkflowBuilder",["lit","#RNAUTOCoreUI/ModelBase","#RNAUTOCoreUI/LitModel","lit/decorators","#RNAUTOCore/LitElementBase","lit/directives/repeat.js","#RNAUTOLit/Lit","#RNAUTOCore/EventManager","#RNAUTODialog/Dialog","#RNAUTOCoreUI/ToastService","#RNAUTOPreMadeDialogs/DeleteDialog","#RNAUTOCommonLibs/ConditionBuilder.Model","#RNAUTOCommonLibs/ConditionGroupOptions","#RNAUTOCommonLibs/DropdownProperty.Model","#RNAUTOCore/WpAjaxPost","#RNAUTOCommonLibs/DataSourceForm","#RNAUTOCommonLibs/DataSource","#RNAUTOCore/StoreBase","#RNAUTOCommonLibs/ConditionBase.Options","#RNAUTOCommonLibs/ActionDictionary","#RNAUTODialog/DialogBase","#RNAUTOCommonLibs/ActionFactory","#RNAUTOCommonLibs/EmailAction.Options","#RNAUTOCommonLibs/DropdownProperty","#RNAUTOPreMadeDialogs/ConfirmDialog","#RNAUTOCommonLibs/UserProperty.Model","#RNAUTOCommonLibs/CheckboxProperty.Model","#RNAUTOCommonLibs/EmailProperty.Model","#RNAUTOCommonLibs/AccordionProperty.Model","#RNAUTOCommonLibs/TextWithTagsProperty.Model","#RNAUTOCommonLibs/SimpleTextProperty.Model","#RNAUTOCommonLibs/EmailAddressProperty.Model"],(function(e,t,n,i,o,s,r,a,l,c,u,h,d,p,f,v,g,y,m,_,x,b,k,C,E,S,P,w,A,M,D,T){"use strict";i.customElement("rnawf-wfstatus")(class extends o.LitElementBase{constructor(...e){super(...e),this.IsBusy=!1}render(){return e.html` <div id="aw_save_box" class="postbox" style="margin:0"> <div class="inside" style="padding: 0"> <div class="submitbox" id="submitpost"> <table style="width: 100%"> <tbody> <tr> <td style="padding: 10px"> <div style="display: flex;align-items: center;"> <label style="font-weight: bold">Form:</label> <div style="width: 100%;margin-left: 3px;"> <select style="width: 100%" .value="${this.model.Options.FormId}" @change="${e=>{this.model.SetForm(e.target.value)}}"> <option value="" ?selected="${""==this.model.Options.FormId}">Select a form</option> ${rnBuilderVar.FormList.map((t=>e.html`<option value="${t.Id}" ?selected="${this.model.Options.FormId==t.Id}">${t.Name}</option>`))} </select> </div> </div> </td> </tr> <tr> <td style="padding: 10px;border-top: 1px solid #f2f2f2;"> <div style="display: flex;align-items: center;"> <label style="font-weight: bold">Status:</label> <div style="width: 100%;margin-left: 3px;"> <select style="width: 100%" .value="${this.model.Options.Status}" @change="${e=>{this.model.Options.Status=e.target.value,this.forceUpdate()}}"> <option value="active" ?selected="${"active"==this.model.Options.Status}">Active</option> <option value="disabled" ?selected="${"disabled"==this.model.Options.Status}">Disabled</option> </select> </div> </div> </td> </tr> </tbody> </table> <div id="major-publishing-actions"> <div id="delete-action"> </div> <div id="publishing-action"> <rn-spinner-button .isBusy="${this.IsBusy}" @click="${()=>this.Save()}" .label="Save"></rn-spinner-button> </div> <div class="clear"></div> </div> </div> </div> </div> `}async Save(){this.IsBusy=!0,this.forceUpdate(),await this.model.Save(),this.IsBusy=!1,this.forceUpdate()}});var O={};!function(e){Object.defineProperty(e,"__esModule",{value:!0});var t="chevron-left",n=[9001],i="f053",o="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l192 192c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 278.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192z";e.definition={prefix:"fas",iconName:t,icon:[384,512,n,i,o]},e.faChevronLeft=e.definition,e.prefix="fas",e.iconName=t,e.width=384,e.height=512,e.ligatures=n,e.unicode=i,e.svgPathData=o,e.aliases=n}(O);var j={},I={};function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}!function(e){Object.defineProperty(e,"__esModule",{value:!0});var t="gear",n=[9881,"cog"],i="f013",o="M495.9 166.6c3.2 8.7 .5 18.4-6.4 24.6l-43.3 39.4c1.1 8.3 1.7 16.8 1.7 25.4s-.6 17.1-1.7 25.4l43.3 39.4c6.9 6.2 9.6 15.9 6.4 24.6c-4.4 11.9-9.7 23.3-15.8 34.3l-4.7 8.1c-6.6 11-14 21.4-22.1 31.2c-5.9 7.2-15.7 9.6-24.5 6.8l-55.7-17.7c-13.4 10.3-28.2 18.9-44 25.4l-12.5 57.1c-2 9.1-9 16.3-18.2 17.8c-13.8 2.3-28 3.5-42.5 3.5s-28.7-1.2-42.5-3.5c-9.2-1.5-16.2-8.7-18.2-17.8l-12.5-57.1c-15.8-6.5-30.6-15.1-44-25.4L83.1 425.9c-8.8 2.8-18.6 .3-24.5-6.8c-8.1-9.8-15.5-20.2-22.1-31.2l-4.7-8.1c-6.1-11-11.4-22.4-15.8-34.3c-3.2-8.7-.5-18.4 6.4-24.6l43.3-39.4C64.6 273.1 64 264.6 64 256s.6-17.1 1.7-25.4L22.4 191.2c-6.9-6.2-9.6-15.9-6.4-24.6c4.4-11.9 9.7-23.3 15.8-34.3l4.7-8.1c6.6-11 14-21.4 22.1-31.2c5.9-7.2 15.7-9.6 24.5-6.8l55.7 17.7c13.4-10.3 28.2-18.9 44-25.4l12.5-57.1c2-9.1 9-16.3 18.2-17.8C227.3 1.2 241.5 0 256 0s28.7 1.2 42.5 3.5c9.2 1.5 16.2 8.7 18.2 17.8l12.5 57.1c15.8 6.5 30.6 15.1 44 25.4l55.7-17.7c8.8-2.8 18.6-.3 24.5 6.8c8.1 9.8 15.5 20.2 22.1 31.2l4.7 8.1c6.1 11 11.4 22.4 15.8 34.3zM256 336c44.2 0 80-35.8 80-80s-35.8-80-80-80s-80 35.8-80 80s35.8 80 80 80z";e.definition={prefix:"fas",iconName:t,icon:[512,512,n,i,o]},e.faGear=e.definition,e.prefix="fas",e.iconName=t,e.width=512,e.height=512,e.ligatures=n,e.unicode=i,e.svgPathData=o,e.aliases=n}(I),function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=I;e.definition={prefix:t.prefix,iconName:t.iconName,icon:[t.width,t.height,t.aliases,t.unicode,t.svgPathData]},e.faCog=e.definition,e.prefix=t.prefix,e.iconName=t.iconName,e.width=t.width,e.height=t.height,e.ligatures=t.aliases,e.unicode=t.unicode,e.svgPathData=t.svgPathData,e.aliases=t.aliases}(j),i.customElement("rnawf-action-editor")(class extends o.LitElementBase{render(){return e.html`<div> <div style="margin-bottom: 20px"> <a style="font-size: 20px;display: flex;align-items: center;margin-bottom: 3px" href="#" @click="${()=>{this.GoBack()}}"><rn-fontawesome .icon="${O.faChevronLeft}" style="margin-right: 3px;"></rn-fontawesome> Back</a> </div> <div style="margin-top: 10px"> <rnaut-title-section @change="${e=>this.model.SelectedNode.Options.Title=e.target.value}" .value="${this.model.SelectedNode.Options.Title}" style="height: 38px;margin-bottom: 15px;"></rnaut-title-section> <h2 style="margin:30px 0 0 0;display: flex;align-items: center;"><rn-fontawesome style="margin-right: 3px" .icon="${j.faCog}"></rn-fontawesome>Settings</h2> <hr style="margin-bottom: 0"/> <div style="background-color: white;padding: 10px"> ${this.DisplayFields()} </div> ${s.repeat(this.model.SelectedNode.GetAdditionalSettingSections(),(e=>e.Label),(t=>e.html` <h2 style="margin:30px 0 0 0;display: flex;align-items: center;"><rn-fontawesome style="margin-right: 3px" .icon="${t.Icon}"></rn-fontawesome>${t.Label}</h2> <hr style="margin-bottom: 0"/> <div style="margin-bottom: 10px;background-color: white"> ${r.rnIf(null!=t.Settings&&s.repeat(t.Settings,(e=>e.Label),(e=>e.Render())))} ${t.Content} </div> `))} </div> </div>`}connectedCallback(){super.connectedCallback(),a.EventManager.Subscribe("RefreshFieldProperties",(()=>this.forceUpdate()),this)}disconnectedCallback(){super.disconnectedCallback(),a.EventManager.UnsubscribeEvent("RefreshFieldProperties",this)}GoBack(){this.model.SetSelectedNode(null),this.model.Refresh()}DisplayFields(){return null==this.model.GetFormBuilder()?e.html`<span style="color:red">Please select a form first</span>`:s.repeat(this.model.SelectedNode.GetSettings(),(e=>e.Label),(t=>e.html` <div style="margin-bottom: 10px"> ${t.Render()} </div> `))}}),i.customElement("rnaut-title-section")(class extends o.LitElementBase{constructor(...e){super(...e),this.value=""}render(){return e.html` <div id="post-body-content" style="margin:0"> <div id="titlediv"> <div id="titlewrap"> <input type="text" name="post_title" size="30" value="" id="title" spellcheck="true" placeholder="Add name" .value="${this.value}" autocomplete="off"> </div> <div class="inside"> </div> </div> `}}),i.customElement("rnawf-diagram-section")(class extends o.LitElementBase{render(){return e.html` <div style="width: 100%;height: 100%"> <rnaut-title-section .value="${this.model.Options.Name}" @change="${e=>this.model.Options.Name=e.target.value}" style="height: 38px;margin-bottom: 15px;"></rnaut-title-section> <div id="diagram" style="width:100%;height: calc(100% - 53px);position: relative"></div> </div> `}async firstUpdated(e){await this.AllUpdateComplete;let t=document.getElementById("diagram");null!=t&&(this.model.Diagram.RootContainer=t,this.model.Diagram.Render())}}),i.customElement("rnaut-workflow-builder")(class extends n.LitModel{render(){return e.html`<div style="display: flex;width:100%;height: 100%;padding: 10px;box-sizing: border-box" class="rnWorkFlowBuilder"> <div style="width: 100%;height: 100%;margin-right: 10px" class="rnSettingsContainer"> ${null!=this.model.SelectedNode?e.html`<rnawf-action-editor .model="${this.model}"></rnawf-action-editor>`:e.html`<rnawf-diagram-section style="width: 100%;height: 100%;" .model="${this.model}"></rnawf-diagram-section>`} </div> <rnawf-wfstatus .model="${this.model}"></rnawf-wfstatus> </div>`}GetParentStyles(){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach((function(t){babelHelpers.defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},super.GetParentStyles(),{width:"100%",height:"100%"})}});var L={};!function(e){Object.defineProperty(e,"__esModule",{value:!0});var t="trash",n=[],i="f1f8",o="M135.2 17.7L128 32H32C14.3 32 0 46.3 0 64S14.3 96 32 96H416c17.7 0 32-14.3 32-32s-14.3-32-32-32H320l-7.2-14.3C307.4 6.8 296.3 0 284.2 0H163.8c-12.1 0-23.2 6.8-28.6 17.7zM416 128H32L53.2 467c1.6 25.3 22.6 45 47.9 45H346.9c25.3 0 46.3-19.7 47.9-45L416 128z";e.definition={prefix:"fas",iconName:t,icon:[448,512,n,i,o]},e.faTrash=e.definition,e.prefix="fas",e.iconName=t,e.width=448,e.height=512,e.ligatures=n,e.unicode=i,e.svgPathData=o,e.aliases=n}(L);var N={};!function(e){Object.defineProperty(e,"__esModule",{value:!0});var t="pencil",n=[9999,61504,"pencil-alt"],i="f303",o="M421.7 220.3l-11.3 11.3-22.6 22.6-205 205c-6.6 6.6-14.8 11.5-23.8 14.1L30.8 511c-8.4 2.5-17.5 .2-23.7-6.1S-1.5 489.7 1 481.2L38.7 353.1c2.6-9 7.5-17.2 14.1-23.8l205-205 22.6-22.6 11.3-11.3 33.9 33.9 62.1 62.1 33.9 33.9zM96 353.9l-9.3 9.3c-.9 .9-1.6 2.1-2 3.4l-25.3 86 86-25.3c1.3-.4 2.5-1.1 3.4-2l9.3-9.3H112c-8.8 0-16-7.2-16-16V353.9zM453.3 19.3l39.4 39.4c25 25 25 65.5 0 90.5l-14.5 14.5-22.6 22.6-11.3 11.3-33.9-33.9-62.1-62.1L314.3 67.7l11.3-11.3 22.6-22.6 14.5-14.5c25-25 65.5-25 90.5 0z";e.definition={prefix:"fas",iconName:t,icon:[512,512,n,i,o]},e.faPencil=e.definition,e.prefix="fas",e.iconName=t,e.width=512,e.height=512,e.ligatures=n,e.unicode=i,e.svgPathData=o,e.aliases=n}(N);var F={};!function(e){Object.defineProperty(e,"__esModule",{value:!0});var t="plus",n=[10133,61543,"add"],i="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32V224H48c-17.7 0-32 14.3-32 32s14.3 32 32 32H192V432c0 17.7 14.3 32 32 32s32-14.3 32-32V288H400c17.7 0 32-14.3 32-32s-14.3-32-32-32H256V80z";e.definition={prefix:"fas",iconName:t,icon:[448,512,n,"2b",i]},e.faPlus=e.definition,e.prefix="fas",e.iconName=t,e.width=448,e.height=512,e.ligatures=n,e.unicode="2b",e.svgPathData=i,e.aliases=n}(F);var R={};!function(e){Object.defineProperty(e,"__esModule",{value:!0});var t="code-branch",n=[],i="f126",o="M80 104c13.3 0 24-10.7 24-24s-10.7-24-24-24S56 66.7 56 80s10.7 24 24 24zm80-24c0 32.8-19.7 61-48 73.3v87.8c18.8-10.9 40.7-17.1 64-17.1h96c35.3 0 64-28.7 64-64v-6.7C307.7 141 288 112.8 288 80c0-44.2 35.8-80 80-80s80 35.8 80 80c0 32.8-19.7 61-48 73.3V160c0 70.7-57.3 128-128 128H176c-35.3 0-64 28.7-64 64v6.7c28.3 12.3 48 40.5 48 73.3c0 44.2-35.8 80-80 80s-80-35.8-80-80c0-32.8 19.7-61 48-73.3V352 153.3C19.7 141 0 112.8 0 80C0 35.8 35.8 0 80 0s80 35.8 80 80zm232 0c0-13.3-10.7-24-24-24s-24 10.7-24 24s10.7 24 24 24s24-10.7 24-24zM80 456c13.3 0 24-10.7 24-24s-10.7-24-24-24s-24 10.7-24 24s10.7 24 24 24z";e.definition={prefix:"fas",iconName:t,icon:[448,512,n,i,o]},e.faCodeBranch=e.definition,e.prefix="fas",e.iconName=t,e.width=448,e.height=512,e.ligatures=n,e.unicode=i,e.svgPathData=o,e.aliases=n}(R),i.customElement("rnawf-diagram-condition")(class extends o.LitElementBase{render(){return e.html` <div id="aw_trigger_box" class="postbox no-drag" style="padding: 10px"> ${this.GetContent()} </div> `}GetContent(){return null==this.ConditionBuilder&&(this.ConditionBuilder=new h.ConditionBuilderModel(this.Node.Options.Condition,this.Node.RootNode.Model)),null==this.Node.RootNode.Model.GetFormBuilder()?"Please select a form first":0==this.Node.Options.Condition.ConditionGroups.length?e.html` <div style="display: flex;flex-direction: column;align-items: center;"> You haven't created any condition yet which means this step will always be executed <button @click=${()=>this.CreateGroup()} class='rnbtn rnbtn-primary' style="margin-top: 5px;display: inline-flex;align-items: center;"> <rn-fontawesome .icon=${F.faPlus} style="margin-right: 3px"></rn-fontawesome> Click here to add your first filter </button> </div> `:this.ConditionBuilder.render()}CreateGroup(){let e=(new d.ConditionGroupOptions).Merge({ConditionLines:[{}]});this.Node.Options.Condition.ConditionGroups.push(e),this.forceUpdate()}});class ${constructor(e=null,t=null){this.Parent=e,this.Options=t,this.Children=[]}get WorkFlow(){return this.RootNode.Model}Initialize(){for(let e of this.Options.Children)this.Children.push(a.EventManager.Publish("GetNode",{Parent:this,Options:e}));return this}GetDependencies(){return[]}get Level(){return null==this.Parent?1:this.Parent.Level+1}GetOptions(){let e=this.Options.ToObject();e.Children=[];for(let t of this.Children)e.Children.push(t.GetOptions());return e}get RootNode(){return null!=this.Parent?this.Parent.RootNode:this}get Diagram(){return this.RootNode.Model.Diagram}GetAllChildren(){let e=[];return this.Children.forEach((t=>{e.push(t),e.push(...t.GetAllChildren())})),e}GetAreaWidth(){let e=this.Width,t=0;for(let e of this.Children)t+=e.GetAreaWidth();return t+=this.Diagram.HorizontalMargin*(this.Children.length-1),e>t?e:t}get Height(){return this.Rect.height}get Width(){return this.Rect.width}Render(){this.Instance=e.renderInline(e.html` <div style="border: 1px solid black;border-radius: 5px;position: absolute;display: inline-flex;" class="diagramNode"> <div style="width: 20px;display: flex;align-items: center;justify-content: flex-end;flex-direction: column;margin:3px 0;"> ${r.rnIf(this.CanRemove()&&e.html`<rn-fontawesome class="diagramIcon" @click="${()=>this.Remove()}" .icon="${L.faTrash}"></rn-fontawesome>`)} </div> <div style="padding: 3px;height: 50px;min-width: 50px;display: flex;align-items: center;justify-content: center;"> ${this.InnerRender()} </div> <div style="width: 20px;display: flex;align-items: center;justify-content: space-between;flex-direction: column;margin:3px 0;"> <rn-fontawesome class="diagramIcon" @click="${()=>this.Open()}" .icon="${N.faPencil}"></rn-fontawesome> ${r.rnIf(this.GetAllowAddingNodes()&&e.html`<rn-fontawesome @click="${()=>this.Add()}" class="diagramIcon" .icon="${F.faPlus}"></rn-fontawesome>`)} </div> </div>`),this.Diagram.Canvas.appendChild(this.Instance),this.Rect=this.Instance.getBoundingClientRect(),this.Children.forEach((e=>e.Render()))}GetAllowAddingNodes(){return!0}AddChild(e){e.Parent=this,this.Children.push(e)}async Add(){if(null==this.RootNode.Model.GetFormBuilder())return void c.ToastService.SendErrorMessage("Please select a form first");let t=await l.Dialog.Show(e.html`<rnaut-action-picker-dialog .parent="${this}" .model="${this.RootNode.Model}"></rnaut-action-picker-dialog>`);null!=t&&(t.InitializeOptionsForFirstTime(),this.Children.length>0?(t.AddChild(this.Children[0]),this.Children=[],this.AddChild(t)):this.AddChild(t),this.Diagram.Render(),this.RootNode.Model.SetSelectedNode(t))}CanRemove(){return!0}Open(){this.RootNode.Model.SetSelectedNode(this)}GetAdditionalSettingSections(){return[{Label:"Condition",Icon:R.faCodeBranch,Settings:[],Content:e.html`<rnawf-diagram-condition .Node="${this}"></rnawf-diagram-condition>`}]}GetSettings(){return[]}async Remove(){await u.DeleteDialog.Show("Continue?","Do you want to remove this node?")&&(this.Parent.Children.splice(this.Parent.Children.indexOf(this),1),1==this.Children.length&&(this.Children.forEach((e=>e.Parent=this.Parent)),this.Parent.Children.push(this.Children[0])),this.Diagram.Render())}CreateEndPoints(){this.EndPoint=this.PlumberInstance.addEndpoint(this.Instance,{endpoint:"Blank"}),this.Children.forEach((e=>e.CreateEndPoints()))}get PlumberInstance(){return this.RootNode.Model.Diagram.PlumberInstance}CreateRelations(){let e=this.GetDependencies();for(let t of e){let e=t.Position,n=t.Position;this.Children.some((e=>e.Options.Id==t.Node.Options.Id))&&(e="Bottom",n="Top"),this.PlumberInstance.connect({source:this.Instance,target:t.Node.Instance,connector:"Flowchart",label:t.Label,endpoint:"Blank",overlays:[{type:"PlainArrow",options:{location:1,width:10,length:10}}]},{anchors:[e,n]})}for(let t of this.Children)e.some((e=>e.Node.Options.Id==t.Options.Id))||this.PlumberInstance.connect({source:this.Instance,target:t.Instance,endpoint:"Blank",connector:"Flowchart",type:"blank",overlays:[{type:"PlainArrow",options:{location:1,width:10,length:10}}]},{anchors:["Bottom","Top"]}),t.CreateRelations()}GetNodeById(e){if(this.Options.Id==e)return this;for(let t of this.Children)if(t=t.GetNodeById(e),null!=t)return t;return null}HasGrandParent(e){return null!=this.Parent&&null!=this.Parent.Parent&&(this.Parent.Parent==e||this.Parent.HasGrandParent(e))}InitializeOptionsForFirstTime(){}}class H extends ${constructor(e,t){super(null,t),this.Model=e}InnerRender(){return"Start"}CanRemove(){return!1}GetSettings(){return[new p.DropdownPropertyModel(null,"TriggerType","Initiate this workflow when").AddItem("Form submitted","form_submitted").AddItem("Entry updated","entry_updated").SetOptionsOverwrite(this.Model.Options)]}}function B(e){return(B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function V(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function z(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function U(e,t,n){return t&&z(e.prototype,t),n&&z(e,n),e}function Y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function X(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&q(e,t)}function W(e){return(W=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function q(e,t){return(q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function J(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?Z(e):t}function K(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=W(e);if(t){var o=W(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return J(this,n)}}function Q(e,t,n){return(Q="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=W(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function ee(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var i,o,s=[],r=!0,a=!1;try{for(n=n.call(e);!(r=(i=n.next()).done)&&(s.push(i.value),!t||s.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==n.return||n.return()}finally{if(a)throw o}}return s}(e,t)||ne(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function te(e){return function(e){if(Array.isArray(e))return ie(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||ne(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ne(e,t){if(e){if("string"==typeof e)return ie(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ie(e,t):void 0}}function ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function oe(e,t,n){return"*"===e||(e.length>0?-1!==e.indexOf(t):!n)}function se(e,t,n){var i,o=e=e||{},s=t=t||{};if(n)for(i=0;i<n.length;i++)o[n[i]]=s[n[i]];else for(i in s)o[i]=s[i];return e}function re(e){return"[object Number]"===Object.prototype.toString.call(e)}function ae(e){return"string"==typeof e}function le(e){return"boolean"==typeof e}function ce(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)}function ue(e){return"[object Function]"===Object.prototype.toString.call(e)}function he(e){if(ae(e))return""+e;if(le(e))return!!e;if(s=e,"[object Date]"===Object.prototype.toString.call(s))return new Date(e.getTime());if(ue(e))return e;if(Array.isArray(e)){for(var t=[],n=0;n<e.length;n++)t.push(he(e[n]));return t}if(ce(e)){var i={};for(var o in e)i[o]=he(e[o]);return i}return e;var s}function de(e,t,n,i){var o,s,r={},a={};for(n=n||[],i=i||[],s=0;s<n.length;s++)r[n[s]]=!0;for(s=0;s<i.length;s++)a[i[s]]=!0;var l=he(e);for(s in t)if(null==l[s]||a[s])l[s]=t[s];else if(r[s])(o=[]).push.apply(o,Array.isArray(l[s])?l[s]:[l[s]]),o.push(t[s]),l[s]=o;else if(ae(t[s])||le(t[s])||ue(t[s])||re(t[s]))l[s]=t[s];else if(Array.isArray(t[s]))o=[],Array.isArray(l[s])&&o.push.apply(o,l[s]),o.push.apply(o,t[s]),l[s]=o;else if(ce(t[s]))for(var c in ce(l[s])||(l[s]={}),t[s])l[s][c]=t[s][c];return l}function pe(e,t,n){for(var i=0;i<n.length;i++){var o=n[i][0][n[i][1]].apply(n[i][0],n[i][2]);if(o===t)return o}return e}function fe(e,t,n,i){return function e(o){if(null!=o){if(ae(o))return function(e){var n=e.match(/(\${.*?})/g);if(null!=n)for(var i=0;i<n.length;i++){var o=t[n[i].substring(2,n[i].length-1)]||"";null!=o&&(e=e.replace(n[i],o))}if(null!=(n=e.match(/({{.*?}})/g)))for(var s=0;s<n.length;s++){var r=t[n[s].substring(2,n[s].length-2)]||"";null!=r&&(e=e.replace(n[s],r))}return e}(o);if(!ue(o)||i||null!=n&&0!==(o.name||"").indexOf(n)){if(Array.isArray(o)){for(var s=[],r=0;r<o.length;r++)s.push(e(o[r]));return s}if(ce(o)){var a={};for(var l in o)a[l]=e(o[l]);return a}return o}return o(t)}}(e)}function ve(e,t){if(!e)return null;for(var n=0;n<e.length;n++)t(e[n])}function ge(e,t){if(e)for(var n=0;n<e.length;n++)if(t(e[n]))return n;return-1}function ye(e,t){var n=ge(e,t);return-1===n?null:e[n]}function me(e,t){var n=null;return e.forEach((function(e){t(e)&&(n=e)})),n}function _e(e,t){var n=ge(e,t);return n>-1&&e.splice(n,1),-1!==n}function xe(e){if(null!=Array.fromArray)return Array.from(e);var t=[];return Array.prototype.push.apply(t,e),t}function be(e,t){var n=e.indexOf(t);return n>-1&&e.splice(n,1),-1!==n}function ke(e,t,n,i){var o=e[t];return null==o&&(o=[],e[t]=o),o[i?"unshift":"push"](n),o}function Ce(e,t,n){return-1===e.indexOf(t)&&(n?e.unshift(t):e.push(t),!0)}for(var Ee,Se=[],Pe=0;Pe<256;Pe++)Se[Pe]=(Pe<16?"0":"")+Pe.toString(16);function we(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return Se[255&e]+Se[e>>8&255]+Se[e>>16&255]+Se[e>>24&255]+"-"+Se[255&t]+Se[t>>8&255]+"-"+Se[t>>16&15|64]+Se[t>>24&255]+"-"+Se[63&n|128]+Se[n>>8&255]+"-"+Se[n>>16&255]+Se[n>>24&255]+Se[255&i]+Se[i>>8&255]+Se[i>>16&255]+Se[i>>24&255]}function Ae(e,t,n){var i=e.x-t.x,o=e.y-t.y,s=Math.cos(n/360*Math.PI*2),r=Math.sin(n/360*Math.PI*2);return{x:i*s-o*r+t.x,y:o*s+i*r+t.y,cr:s,sr:r}}function Me(e){if(null==e)return null;for(var t=e.replace(/^\s\s*/,""),n=/\s/,i=t.length;n.test(t.charAt(--i)););return t.slice(0,i+1)}function De(e,t){for(var n=[],i=0;i<e.length;i++)n.push(t(e[i]));return n}function Te(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if("undefined"!=typeof console)try{var i=arguments[arguments.length-1];console.log(i)}catch(e){}}function Oe(e){return e<0?-1:e>0?1:0}function je(e,t,n){return function(){var i=null;try{null!=t&&(i=t.apply(this,arguments))}catch(e){Te("jsPlumb function failed : "+e)}if(null!=e&&(null==n||i!==n))try{i=e.apply(this,arguments)}catch(e){Te("wrapped function failed : "+e)}return i}}function Ie(e,t,n){return e.has(t)||e.set(t,n()),e.get(t)}function Ge(e,t){for(var n=e.__proto__;null!=n;){if(n instanceof t)return!0;n=n.__proto__}return!1}function Le(e,t,n){for(var i=(n=n||e.parentNode).querySelectorAll(t),o=0;o<i.length;o++)if(i[o]===e)return!0;return!1}function Ne(e,t){e.stopPropagation?e.stopPropagation():e.returnValue=!1,!t&&e.preventDefault&&e.preventDefault()}function Fe(e,t,n,i){if(i&&Le(e,t,n))return e;for(e=e.parentNode;null!=e&&e!==n;){if(Le(e,t))return e;e=e.parentNode}}function Re(e){return e.srcElement||e.target}function $e(e){return null!=e.className?void 0===e.className.baseVal?e.className:e.className.baseVal:""}function He(e,t,n){var i=null==t?[]:Array.isArray(t)?t:t.split(/\s+/),o=null==n?[]:Array.isArray(n)?n:n.split(/\s+/),s=$e(e).split(/\s+/),r=function(e,t){for(var n=0;n<t.length;n++)if(e)-1===s.indexOf(t[n])&&s.push(t[n]);else{var i=s.indexOf(t[n]);-1!==i&&s.splice(i,1)}};r(!0,i),r(!1,o),function(e,t,n){t=Me(t),void 0!==e.className.baseVal?e.className.baseVal=t:e.className=t;try{var i=e.classList;if(null!=i){for(;i.length>0;)i.remove(i.item(0));for(var o=0;o<n.length;o++)n[o]&&i.add(n[o])}}catch(e){Te("WARN: cannot set class list",e)}}(e,s.join(" "),s)}function Be(e){return!ae(e)&&!Array.isArray(e)&&null!=e.length&&null==e.documentElement&&null==e.nodeType}function Ve(e,t){var n=function(e,t){null!=e&&null!=t&&t.length>0&&(e.classList?ve(Me(t).split(/\s+/),(function(t){e.classList.add(t)})):He(e,t))};Be(e)?ve(e,(function(e){return n(e,t)})):n(e,t)}function ze(e,t){var n=function(e,t){null!=e&&null!=t&&t.length>0&&(e.classList?Me(t).split(/\s+/).forEach((function(t){e.classList.remove(t)})):He(e,null,t))};Be(e)?ve(e,(function(e){return n(e,t)})):n(e,t)}function Ue(e,t,n,i){return Ye(null,e,t,n,i)}function Ye(e,t,n,i,o){var s,r=null==e?document.createElement(t):document.createElementNS(e,t);for(s in n=n||{})r.style[s]=n[s];for(s in i&&(r.className=i),o=o||{})r.setAttribute(s,""+o[s]);return r}function Xe(e){var t=e.getBoundingClientRect(),n=document.body,i=document.documentElement,o=window.pageYOffset||i.scrollTop||n.scrollTop,s=window.pageXOffset||i.scrollLeft||n.scrollLeft,r=i.clientTop||n.clientTop||0,a=i.clientLeft||n.clientLeft||0,l=t.top+o-r,c=t.left+s-a;return{x:Math.round(c),y:Math.round(l)}}function We(e,t){var n=t.getContainer().getBoundingClientRect(),i=e.getBoundingClientRect(),o=t.currentZoom;return{x:(i.left-n.left)/o,y:(i.top-n.top)/o}}function qe(e,t){var n=e.getBoundingClientRect(),i=t.currentZoom;return{w:n.width/i,h:n.height/i}}function Ze(e){return e instanceof SVGElement?Ee.SVG:Ee.HTML}function Je(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.map((function(e){return"."+e})).join(",")}function Ke(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.map((function(e){return"["+e+"]"})).join(",")}!function(e){e.SVG="SVG",e.HTML="HTML"}(Ee||(Ee={}));var Qe="source",et="target",tt="block",nt="none",it="absolute",ot="fixed",st="data-jtk-group",rt="data-jtk-managed",at="data-jtk-not-draggable",lt="tabindex",ct="data-jtk-scope-",ut="checkCondition",ht="jtk-connector",dt="jtk-endpoint",pt="jtk-floating-endpoint",ft="jtk-group-collapsed",vt="jtk-group-expanded",gt="jtk-overlay",yt="connection",mt="internal.connection",_t="connection:move",xt="internal.endpoint:unregistered",bt="internal.connection:detached",kt="element:manage",Ct="group:member:added",Et="maxConnections",St="element:unmanage",Pt="zoom",wt="isDetachAllowed",At="beforeDrop",Mt="beforeDetach",Dt=Ke(rt),Tt={"stroke-linejoin":"stroke-linejoin","stroke-dashoffset":"stroke-dashoffset","stroke-linecap":"stroke-linecap"},Ot="stroke-dasharray",jt="svg",It="path",Gt="http://www.w3.org/2000/svg";function Lt(e,t){for(var n in t)e.setAttribute(n,""+t[n])}function Nt(e,t){return(t=t||{}).version="1.1",t.xmlns=Gt,Ye(Gt,e,null,null,t)}function Ft(e){return"position:absolute;left:"+e[0]+"px;top:"+e[1]+"px"}function Rt(e,t,n){if(t.setAttribute("fill",n.fill?n.fill:nt),t.setAttribute("stroke",n.stroke?n.stroke:nt),n.strokeWidth&&t.setAttribute("stroke-width",n.strokeWidth),n.dashstyle&&n.strokeWidth&&!n[Ot]){var i=-1===n.dashstyle.indexOf(",")?" ":",",o=n.dashstyle.split(i),s="";ve(o,(function(e){s+=Math.floor(e*n.strokeWidth)+i})),t.setAttribute(Ot,s)}else n[Ot]&&t.setAttribute(Ot,n[Ot]);for(var r in Tt)n[r]&&t.setAttribute(Tt[r],n[r])}function $t(e,t,n){e.childNodes.length>n?e.insertBefore(t,e.childNodes[n]):e.appendChild(t)}function Ht(e,t,n){var i=[e,t];return n&&i.push(n),i.join(":")}var Bt="data-jtk-container",Vt="data-jtk-enabled",zt="data-jtk-scope",Ut="endpoint",Yt="element",Xt="connection",Wt="click",qt="contextmenu",Zt="dblclick",Jt="dbltap",Kt="mousedown",Qt="mouseenter",en="mouseexit",tn="mousemove",nn="mouseup",on="mouseout",sn="mouseover",rn="tap",an="revert",ln="connection:drag",cn=Ht(Yt,Wt),un=Ht(Yt,Zt),hn=Ht(Yt,Jt),dn=Ht(Yt,on),pn=Ht(Yt,sn),fn=Ht(Yt,tn),vn=Ht(Yt,nn),gn=Ht(Yt,Kt),yn=Ht(Yt,qt),mn=Ht(Yt,rn),_n=Ht(Ut,Wt),xn=Ht(Ut,Zt);Ht(Ut,Jt);var bn=Ht(Ut,on),kn=Ht(Ut,sn),Cn=Ht(Ut,nn),En=Ht(Ut,Kt);Ht(Ut,rn);var Sn,Pn,wn=Ht(Xt,Wt),An=Ht(Xt,Zt),Mn=Ht(Xt,Jt),Dn=Ht(Xt,on),Tn=Ht(Xt,sn),On=Ht(Xt,nn),jn=Ht(Xt,Kt),In=Ht(Xt,qt),Gn=Ht(Xt,rn),Ln="position",Nn=Je(ht),Fn=Je(dt),Rn=Ke(st),$n=Ke("data-jtk-group-content"),Hn=Je(gt);!function(e){e.Circle="Circle",e.Ellipse="Ellipse",e.Triangle="Triangle",e.Diamond="Diamond",e.Rectangle="Rectangle",e.Square="Square"}(Sn||(Sn={})),function(e){e.Assign="Assign",e.AutoDefault="AutoDefault",e.Bottom="Bottom",e.BottomLeft="BottomLeft",e.BottomRight="BottomRight",e.Center="Center",e.Continuous="Continuous",e.ContinuousBottom="ContinuousBottom",e.ContinuousLeft="ContinuousLeft",e.ContinuousRight="ContinuousRight",e.ContinuousTop="ContinuousTop",e.ContinuousLeftRight="ContinuousLeftRight",e.ContinuousTopBottom="ContinuousTopBottom",e.Left="Left",e.Perimeter="Perimeter",e.Right="Right",e.Top="Top",e.TopLeft="TopLeft",e.TopRight="TopRight"}(Pn||(Pn={}));var Bn,Vn,zn=function(){function e(t){V(this,e),this.params=t,Y(this,"x1",void 0),Y(this,"x2",void 0),Y(this,"y1",void 0),Y(this,"y2",void 0),Y(this,"extents",{xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}),Y(this,"type",void 0),this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2}return U(e,[{key:"findClosestPointOnPath",value:function(e,t){return{d:1/0,x:null,y:null,l:null,x1:null,y1:null,x2:null,y2:null}}},{key:"lineIntersection",value:function(e,t,n,i){return[]}},{key:"boxIntersection",value:function(e,t,n,i){var o=[];return o.push.apply(o,this.lineIntersection(e,t,e+n,t)),o.push.apply(o,this.lineIntersection(e+n,t,e+n,t+i)),o.push.apply(o,this.lineIntersection(e+n,t+i,e,t+i)),o.push.apply(o,this.lineIntersection(e,t+i,e,t)),o}},{key:"boundingBoxIntersection",value:function(e){return this.boxIntersection(e.x,e.y,e.w,e.h)}}]),e}(),Un="undefined",Yn="default",Xn="true",Wn="false",qn="*";function Zn(e,t,n,i,o,s,r){return function(){var e=[];return e.push.apply(e,arguments),e.item=function(e){return this[e]},e}(function(e,t,n,i,o,s,r){return new Touch({target:e,identifier:we(),pageX:t,pageY:n,screenX:i,screenY:o,clientX:s||i,clientY:r||o})}(e,t,n,i,o,s,r))}function Jn(e,t,n){for(var i=(n=n||e.parentNode).querySelectorAll(t),o=0;o<i.length;o++)if(i[o]===e)return!0;return!1}function Kn(e){return e.srcElement||e.target}function Qn(e,t,n,i){if(i){var o=e.composedPath?e.composedPath():e.path;if(void 0!==o&&o.indexOf)return{path:o,end:o.indexOf(n)};var s={path:[],end:-1};return function e(t){s.path.push(t),t===n?s.end=s.path.length-1:null!=t.parentNode&&e(t.parentNode)}(t),s}return{path:[t],end:1}}var ei=1;function ti(){return"ontouchstart"in document.documentElement||null!=navigator.maxTouchPoints&&navigator.maxTouchPoints>0}function ni(){return"onmousedown"in document.documentElement}var ii=(Y(Bn={},Kt,"touchstart"),Y(Bn,nn,"touchend"),Y(Bn,tn,"touchmove"),Bn);function oi(e,t){if(null==e)return{x:0,y:0};var n=function(e,t){return e.item?e.item(t):e[t]}(ri(e),0);return{x:n[t+"X"],y:n[t+"Y"]}}function si(e){return oi(e,"page")}function ri(e){return e.touches&&e.touches.length>0?e.touches:e.changedTouches&&e.changedTouches.length>0?e.changedTouches:e.targetTouches&&e.targetTouches.length>0?e.targetTouches:[e]}function ai(e,t,n,i,o){if(ui(e,t,n),i.__tauid=n.__tauid,e.addEventListener)e.addEventListener(t,n,!1,o);else if(e.attachEvent){var s=t+n.__tauid;e["e"+s]=n,e[s]=function(){e["e"+s]&&e["e"+s](window.event)},e.attachEvent("on"+t,e[s])}}function li(e,t,n){var i=this;null!=n&&ci(e,(function(o){if(function(e,t,n){if(e.__ta&&e.__ta[t]&&delete e.__ta[t][n.__tauid],n.__taExtra){for(var i=0;i<n.__taExtra.length;i++)li(e,n.__taExtra[i][0],n.__taExtra[i][1]);n.__taExtra.length=0}n.__taUnstore&&n.__taUnstore()}(o,t,n),null!=n.__tauid)if(o.removeEventListener)o.removeEventListener(t,n,!1),ti()&&ii[t]&&o.removeEventListener(ii[t],n,!1);else if(i.detachEvent){var s=t+n.__tauid;o[s]&&o.detachEvent("on"+t,o[s]),o[s]=null,o["e"+s]=null}n.__taTouchProxy&&li(e,n.__taTouchProxy[1],n.__taTouchProxy[0])}))}function ci(e,t){if(null!=e)for(var n="string"==typeof e?document.querySelectorAll(e):null!=e.length?e:[e],i=0;i<n.length;i++)t(n[i])}function ui(e,t,n){var i=ei++;return e.__ta=e.__ta||{},e.__ta[t]=e.__ta[t]||{},e.__ta[t][i]=n,n.__tauid=i,i}var hi=/:not\(([^)]+)\)/;function di(e,t,n,i){if(null==e)return n;var o=e.split(","),s=[],r=[];ve(o,(function(e){var t=e.match(hi);null!=t?r.push(t[1]):s.push(e)})),r.length>0&&0===s.length&&s.push(qn);var a=function i(o){i.__tauid=n.__tauid;var a=Kn(o),l=!1,c=a,u=Qn(o,a,t,null!=e);if(-1!=u.end)for(var h=0;!l&&h<u.end;h++){c=u.path[h];for(var d=0;d<r.length;d++)if(Jn(c,r[d],t))return;for(var p=0;!l&&p<s.length;p++)if(Jn(c,s[p],t)){n.apply(c,[o,c]),l=!0;break}}};return function(e,t,n){e.__taExtra=e.__taExtra||[],e.__taExtra.push([t,n])}(n,i,a),a}var pi=function(e,t,n,i,o){if(ti()&&ii[t]){var s=di(i,e,n,ii[t]);ai(e,ii[t],s,n,o)}"focus"===t&&null==e.getAttribute(lt)&&e.setAttribute(lt,"1"),ai(e,t,di(i,e,n,t),n,o)},fi=(Y(Vn={},rn,{touches:1,taps:1}),Y(Vn,Jt,{touches:1,taps:2}),Y(Vn,qt,{touches:2,taps:1}),Vn);function vi(e,t,n,i){for(var o in n.__tamee[e])n.__tamee[e].hasOwnProperty(o)&&n.__tamee[e][o].apply(i,[t])}var gi=function(){function e(){V(this,e)}return U(e,null,[{key:"generate",value:function(e,t){return function(n,i,o,s){if(i==qt&&ni())pi(n,i,o,s);else{if(null==n.__taTapHandler){var r=n.__taTapHandler={tap:[],dbltap:[],down:!1,taps:0,downSelectors:[]},a=function(i){for(var o=Kn(i),a=Qn(i,o,n,null!=s),l=!1,h=0;h<a.end;h++){if(l)return;o=a.path[h];for(var d=0;d<r.downSelectors.length;d++)if(null==r.downSelectors[d]||Jn(o,r.downSelectors[d],n)){r.down=!0,setTimeout(c,e),setTimeout(u,t),l=!0;break}}},l=function(e){if(r.down){var t,i,o=Kn(e);r.taps++;var s=function(e){return ri(e).length}(e);for(var a in fi)if(fi.hasOwnProperty(a)){var l=fi[a];if(l.touches===s&&(1===l.taps||l.taps===r.taps))for(var c=0;c<r[a].length;c++){i=Qn(e,o,n,null!=r[a][c][1]);for(var u=0;u<i.end;u++)if(t=i.path[u],null==r[a][c][1]||Jn(t,r[a][c][1],n)){r[a][c][0].apply(t,[e,t]);break}}}}},c=function(){r.down=!1},u=function(){r.taps=0};n.__taTapHandler.downHandler=a,n.__taTapHandler.upHandler=l,pi(n,Kt,a),pi(n,nn,l)}n.__taTapHandler.downSelectors.push(s),n.__taTapHandler[i].push([o,s]),o.__taUnstore=function(){null!=n.__taTapHandler&&(_e(n.__taTapHandler.downSelectors,(function(e){return e===s})),function(e,t){var n,i=0;for(i=0,n=e.length;i<n&&e[i][0]!==t;i++);i<e.length&&e.splice(i,1)}(n.__taTapHandler[i],o),0===n.__taTapHandler.downSelectors.length&&(li(n,Kt,n.__taTapHandler.downHandler),li(n,nn,n.__taTapHandler.upHandler),delete n.__taTapHandler))}}}}}]),e}(),yi=function(){function e(){V(this,e)}return U(e,null,[{key:"generate",value:function(){var e=[];return function(t,n,i,o){if(!t.__tamee){t.__tamee={over:!1,mouseenter:[],mouseexit:[]};var s=function(n){var i=Kn(n);(null==o&&i==t&&!t.__tamee.over||Jn(i,o,t)&&(null==i.__tamee||!i.__tamee.over))&&(vi(Qt,n,t,i),i.__tamee=i.__tamee||{},i.__tamee.over=!0,e.push(i))},r=function(n){for(var i=Kn(n),o=0;o<e.length;o++)i!=e[o]||Jn(n.relatedTarget||n.toElement,"*",i)||(i.__tamee.over=!1,e.splice(o,1),vi(en,n,t,i))};ai(t,sn,di(o,t,s,sn),s),ai(t,on,di(o,t,r,on),r)}i.__taUnstore=function(){delete t.__tamee[n][i.__tauid]},ui(t,n,i),t.__tamee[n][i.__tauid]=i}}}]),e}(),mi=function(){function e(t){V(this,e),Y(this,"clickThreshold",void 0),Y(this,"dblClickThreshold",void 0),Y(this,"tapHandler",void 0),Y(this,"mouseEnterExitHandler",void 0),t=t||{},this.clickThreshold=t.clickThreshold||250,this.dblClickThreshold=t.dblClickThreshold||450,this.mouseEnterExitHandler=yi.generate(),this.tapHandler=gi.generate(this.clickThreshold,this.dblClickThreshold)}return U(e,[{key:"_doBind",value:function(e,t,n,i,o){if(null!=n){var s=e;t===rn||t===Jt||t===qt?this.tapHandler(s,t,n,i,o):t===Qt||t==en?this.mouseEnterExitHandler(s,t,n,i,o):pi(s,t,n,i,o)}}},{key:"on",value:function(e,t,n,i,o){var s=null==i?null:n,r=null==i?n:i;return this._doBind(e,t,r,s,o),this}},{key:"off",value:function(e,t,n){return li(e,t,n),this}},{key:"trigger",value:function(e,t,n,i,o){var s=ni()&&("undefined"==typeof MouseEvent||null==n||n.constructor===MouseEvent),r=ti()&&!ni()&&ii[t]?ii[t]:t,a=!(ti()&&!ni()&&ii[t]),l=si(n),c=oi(n,"screen"),u=function(e){return oi(e,"client")}(n);return ci(e,(function(e){var h;n=n||{screenX:c.x,screenY:c.y,clientX:u.x,clientY:u.y};var d,p={TouchEvent:function(t){var n=Zn(e,l.x,l.y,c.x,c.y,u.x,u.y);(t.initTouchEvent||t.initEvent)(r,!0,!0,window,null,c.x,c.y,u.x,u.y,!1,!1,!1,!1,n,n,n,1,0)},MouseEvents:function(t){t.initMouseEvent(r,!0,!0,window,null==o?1:o,c.x,c.y,u.x,u.y,!1,!1,!1,!1,1,e)}},f=!a&&!s&&ti()&&ii[t]?"TouchEvent":"MouseEvents";h=document.createEvent(f),p[f](h),d=h,i&&(d.payload=i),e.dispatchEvent(h)})),this}}]),e}(),_i=[null,[1,-1],[1,1],[-1,1],[-1,-1]],xi=[null,[-1,-1],[-1,1],[1,1],[1,-1]],bi=2*Math.PI;function ki(e,t){return t.x===e.x?t.y>e.y?1/0:-1/0:t.y===e.y?t.x>e.x?0:-0:(t.y-e.y)/(t.x-e.x)}function Ci(e,t){return Math.sqrt(Math.pow(t.y-e.y,2)+Math.pow(t.x-e.x,2))}function Ei(e,t){return t.x>e.x||t.x==e.x?t.y>e.y?2:1:t.y>e.y?3:4}function Si(e,t){var n=e.x,i=e.x+e.w,o=e.y,s=e.y+e.h,r=t.x,a=t.x+t.w,l=t.y,c=t.y+t.h;return n<=r&&r<=i&&o<=l&&l<=s||n<=a&&a<=i&&o<=l&&l<=s||n<=r&&r<=i&&o<=c&&c<=s||n<=a&&r<=i&&o<=c&&c<=s||r<=n&&n<=a&&l<=o&&o<=c||r<=i&&i<=a&&l<=o&&o<=c||r<=n&&n<=a&&l<=s&&s<=c||r<=i&&n<=a&&l<=s&&s<=c}function Pi(e,t,n){var i=ki(e,t),o=Ei(e,t),s=n>0?_i[o]:xi[o],r=Math.atan(i),a=Math.abs(n*Math.sin(r))*s[1],l=Math.abs(n*Math.cos(r))*s[0];return{x:e.x+l,y:e.y+a}}function wi(e,t,n){if(Le(t,n,e))return t;for(var i=t.parentNode;null!=i&&i!==e;){if(Le(i,n,e))return i;i=i.parentNode}}function Ai(e,t,n){var i=t.parentNode,o=e.getSize(i),s=e.getSize(t),r=n.x,a=r+s.w,l=n.y,c=l+s.h;return a>0&&r<o.w&&c>0&&l<o.h}var Mi,Di="start",Ti="beforeStart",Oi="drag",ji="stop",Ii="katavorio-draggable",Gi=function(){return!0},Li=function(){return!1},Ni="katavorio-delegated-draggable",Fi="katavorio-drag-no-select",Ri="katavorio-ghost-proxy",$i="katavorio-clone-drag";!function(e){e.absolutePosition="absolutePosition",e.transform="transform",e.xyAttributes="xyAttributes"}(Mi||(Mi={}));var Hi=new Map;Hi.set(Mi.absolutePosition,(function(e,t){e.style.left="".concat(t.x,"px"),e.style.top="".concat(t.y,"px")})),Hi.set(Mi.xyAttributes,(function(e,t){e.setAttribute("x","".concat(t.x)),e.setAttribute("y","".concat(t.y))}));var Bi=new Map;Bi.set(Mi.absolutePosition,(function(e){return{x:e.offsetLeft,y:e.offsetTop}})),Bi.set(Mi.xyAttributes,(function(e){return{x:parseFloat(e.getAttribute("x")),y:parseFloat(e.getAttribute("y"))}}));var Vi=new Map;Vi.set(Mi.absolutePosition,(function(e,t){e.style.width="".concat(t.w,"px"),e.style.height="".concat(t.h,"px")})),Vi.set(Mi.xyAttributes,(function(e,t){e.setAttribute("width","".concat(t.w)),e.setAttribute("height","".concat(t.h))}));var zi=new Map;zi.set(Mi.absolutePosition,(function(e){return{w:e.offsetWidth,h:e.offsetHeight}})),zi.set(Mi.xyAttributes,(function(e){return{w:parseFloat(e.getAttribute("width")),h:parseFloat(e.getAttribute("height"))}}));var Ui,Yi=[ji,Di,Oi,"drop","over","out",Ti],Xi=function(){},Wi=function(e,t){if(null!=e){e=ae(e)||null!=e.tagName||null==e.length?[e]:e;for(var n=0;n<e.length;n++)t.apply(e[n],[e[n]])}},qi=function(){function e(t,n){V(this,e),this.el=t,this.manager=n,Y(this,"_class",void 0),Y(this,"uuid",we()),Y(this,"enabled",!0),Y(this,"scopes",[]),Y(this,"eventManager",void 0),this.eventManager=n.eventManager}return U(e,[{key:"setEnabled",value:function(e){this.enabled=e}},{key:"isEnabled",value:function(){return this.enabled}},{key:"toggleEnabled",value:function(){this.enabled=!this.enabled}},{key:"addScope",value:function(e){var t={};for(var n in Wi(this.scopes,(function(e){t[e]=!0})),Wi(e?e.split(/\s+/):[],(function(e){t[e]=!0})),this.scopes.length=0,t)this.scopes.push(n)}},{key:"removeScope",value:function(e){var t={};for(var n in Wi(this.scopes,(function(e){t[e]=!0})),Wi(e?e.split(/\s+/):[],(function(e){delete t[e]})),this.scopes.length=0,t)this.scopes.push(n)}},{key:"toggleScope",value:function(e){var t={};for(var n in Wi(this.scopes,(function(e){t[e]=!0})),Wi(e?e.split(/\s+/):[],(function(e){t[e]?delete t[e]:t[e]=!0})),this.scopes.length=0,t)this.scopes.push(n)}}]),e}();!function(e){e.notNegative="notNegative",e.parent="parent",e.parentEnclosed="parentEnclosed"}(Ui||(Ui={}));var Zi=function(e){X(n,e);var t=K(n);function n(e,i,o){var s;if(V(this,n),Y(Z(s=t.call(this,e,o)),"_class",void 0),Y(Z(s),"rightButtonCanDrag",void 0),Y(Z(s),"consumeStartEvent",void 0),Y(Z(s),"clone",void 0),Y(Z(s),"scroll",void 0),Y(Z(s),"trackScroll",void 0),Y(Z(s),"_downAt",void 0),Y(Z(s),"_posAtDown",void 0),Y(Z(s),"_pagePosAtDown",void 0),Y(Z(s),"_pageDelta",{x:0,y:0}),Y(Z(s),"_moving",void 0),Y(Z(s),"_lastPosition",void 0),Y(Z(s),"_lastScrollValues",{x:0,y:0}),Y(Z(s),"_initialScroll",{x:0,y:0}),Y(Z(s),"_size",void 0),Y(Z(s),"_currentParentPosition",void 0),Y(Z(s),"_ghostParentPosition",void 0),Y(Z(s),"_dragEl",void 0),Y(Z(s),"_multipleDrop",void 0),Y(Z(s),"_ghostProxyOffsets",void 0),Y(Z(s),"_ghostDx",void 0),Y(Z(s),"_ghostDy",void 0),Y(Z(s),"_isConstrained",!1),Y(Z(s),"_ghostProxyParent",void 0),Y(Z(s),"_useGhostProxy",void 0),Y(Z(s),"_ghostProxyFunction",void 0),Y(Z(s),"_activeSelectorParams",void 0),Y(Z(s),"_availableSelectors",[]),Y(Z(s),"_canDrag",void 0),Y(Z(s),"_consumeFilteredEvents",void 0),Y(Z(s),"_parent",void 0),Y(Z(s),"_ignoreZoom",void 0),Y(Z(s),"_filters",{}),Y(Z(s),"_constrainRect",void 0),Y(Z(s),"_elementToDrag",void 0),Y(Z(s),"downListener",void 0),Y(Z(s),"moveListener",void 0),Y(Z(s),"upListener",void 0),Y(Z(s),"scrollTracker",void 0),Y(Z(s),"listeners",{start:[],drag:[],stop:[],over:[],out:[],beforeStart:[],revert:[]}),s._class=s.manager.css.draggable,Ve(s.el,s._class),s.downListener=s._downListener.bind(Z(s)),s.upListener=s._upListener.bind(Z(s)),s.moveListener=s._moveListener.bind(Z(s)),s.rightButtonCanDrag=!0===i.rightButtonCanDrag,s.consumeStartEvent=!1!==i.consumeStartEvent,s._dragEl=s.el,s.clone=!0===i.clone,s.scroll=!0===i.scroll,s.trackScroll=!1!==i.trackScroll,s._multipleDrop=!1!==i.multipleDrop,s._canDrag=i.canDrag||Gi,s._consumeFilteredEvents=i.consumeFilteredEvents,s._parent=i.parent,s._ignoreZoom=!0===i.ignoreZoom,s._ghostProxyParent=i.ghostProxyParent,s.trackScroll&&(s.scrollTracker=s._trackScroll.bind(Z(s)),document.addEventListener("scroll",s.scrollTracker)),!0===i.ghostProxy?s._useGhostProxy=Gi:i.ghostProxy&&"function"==typeof i.ghostProxy?s._useGhostProxy=i.ghostProxy:s._useGhostProxy=function(e,t){return!(!s._activeSelectorParams||!s._activeSelectorParams.useGhostProxy)&&s._activeSelectorParams.useGhostProxy(e,t)},i.makeGhostProxy?s._ghostProxyFunction=i.makeGhostProxy:s._ghostProxyFunction=function(e){return s._activeSelectorParams&&s._activeSelectorParams.makeGhostProxy?s._activeSelectorParams.makeGhostProxy(e):e.cloneNode(!0)},i.selector){var r=s.el.getAttribute(Ii);null==r&&(r=""+(new Date).getTime(),s.el.setAttribute("katavorio-draggable",r)),s._availableSelectors.push(i)}return s.eventManager.on(s.el,Kt,s.downListener),s}return U(n,[{key:"_trackScroll",value:function(e){if(this._moving){var t={x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop},n=t.x-this._lastScrollValues.x,i=t.y-this._lastScrollValues.y,o={x:n+this._lastPosition.x,y:i+this._lastPosition.y},s=o.x-this._downAt.x,r=o.y-this._downAt.y,a=this._ignoreZoom?1:this.manager.getZoom();this._dragEl&&this._dragEl.parentNode&&(s+=this._dragEl.parentNode.scrollLeft-this._initialScroll.x,r+=this._dragEl.parentNode.scrollTop-this._initialScroll.y),s/=a,r/=a,this.moveBy(s,r,e),this._lastPosition=o,this._lastScrollValues=t}}},{key:"on",value:function(e,t){this.listeners[e]&&this.listeners[e].push(t)}},{key:"off",value:function(e,t){if(this.listeners[e]){for(var n=[],i=0;i<this.listeners[e].length;i++)this.listeners[e][i]!==t&&n.push(this.listeners[e][i]);this.listeners[e]=n}}},{key:"_upListener",value:function(e){this._downAt&&(this._downAt=null,this.eventManager.off(document,tn,this.moveListener),this.eventManager.off(document,nn,this.upListener),ze(document.body,Fi),this.unmark(e),this.stop(e),this._moving=!1,this.clone?(this._dragEl&&this._dragEl.parentNode&&this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=null):this._activeSelectorParams&&this._activeSelectorParams.revertFunction&&!0===this._activeSelectorParams.revertFunction(this._dragEl,this.manager.getPosition(this._dragEl))&&(this.manager.setPosition(this._dragEl,this._posAtDown),this._dispatch(an,this._dragEl)))}},{key:"_downListener",value:function(e){if(!e.defaultPrevented&&((this.rightButtonCanDrag||3!==e.which&&2!==e.button)&&this.isEnabled()&&this._canDrag()))if(this._testFilter(e)&&function(e,t,n){return!Le(e.srcElement||e.target,n.getInputFilterSelector(),t)}(e,this.el,this.manager)){this._activeSelectorParams=null,this._elementToDrag=null,0===this._availableSelectors.length&&console.log("JSPLUMB: no available drag selectors");var t=e.target||e.srcElement,n=function(e,t,n){for(var i=null,o=t.getAttribute("katavorio-draggable"),s=null!=o?"[katavorio-draggable='"+o+"'] ":"",r=0;r<e.length;r++)if(null!=(i=wi(t,n,s+e[r].selector))){if(e[r].filter){var a=Le(n,e[r].filter,i);if(!0===e[r].filterExclude&&!a||a)return null}return[e[r],i]}return null}(this._availableSelectors,this.el,t);if(null!=n&&(this._activeSelectorParams=n[0],this._elementToDrag=n[1]),null==this._activeSelectorParams||null==this._elementToDrag)return;var i=this._activeSelectorParams.dragInit?this._activeSelectorParams.dragInit(this._elementToDrag,e):null;if(null!=i&&(this._elementToDrag=i),this.clone)if(this._dragEl=this._elementToDrag.cloneNode(!0),Ve(this._dragEl,$i),this._dragEl.setAttribute("id",null),this._dragEl.style.position="absolute",null!=this._parent){var o=this.manager.getPosition(this.el);this._dragEl.style.left=o.x+"px",this._dragEl.style.top=o.y+"px",this._parent.appendChild(this._dragEl)}else{var s=Xe(this._elementToDrag);this._dragEl.style.left=s.x+"px",this._dragEl.style.top=s.y+"px",document.body.appendChild(this._dragEl)}else this._dragEl=this._elementToDrag;this.consumeStartEvent&&Ne(e),this._downAt=si(e),this._dragEl&&this._dragEl.parentNode&&(this._initialScroll={x:this._dragEl.parentNode.scrollLeft,y:this._dragEl.parentNode.scrollTop}),this._posAtDown=this.manager.getPosition(this._dragEl),this._pagePosAtDown=Xe(this._dragEl),this._pageDelta={x:this._pagePosAtDown.x-this._posAtDown.x,y:this._pagePosAtDown.y-this._posAtDown.y},this._size=this.manager.getSize(this._dragEl),this.eventManager.on(document,tn,this.moveListener),this.eventManager.on(document,nn,this.upListener),Ve(document.body,Fi),this._dispatch(Ti,{el:this.el,pos:this._posAtDown,e:e,drag:this,size:this._size})}else this._consumeFilteredEvents&&Ne(e)}},{key:"_moveListener",value:function(e){if(this._downAt){if(!this._moving){var t=this._dispatch(Di,{el:this.el,pos:this._posAtDown,e:e,drag:this,size:this._size});if(!1!==t){if(!this._downAt)return;this.mark(t),this._moving=!0}else this.abort()}if(this._downAt){var n=si(e),i=n.x-this._downAt.x,o=n.y-this._downAt.y,s=this._ignoreZoom?1:this.manager.getZoom();this._lastPosition={x:n.x,y:n.y},this._lastScrollValues={x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop},this._dragEl&&this._dragEl.parentNode&&(i+=this._dragEl.parentNode.scrollLeft-this._initialScroll.x,o+=this._dragEl.parentNode.scrollTop-this._initialScroll.y),i/=s,o/=s,this.moveBy(i,o,e)}}}},{key:"getDragDelta",value:function(){return null!=this._posAtDown&&null!=this._downAt?{x:this._downAt.x-this._posAtDown.x,y:this._downAt.y-this._posAtDown.y}:{x:0,y:0}}},{key:"mark",value:function(e){var t;this._posAtDown=this.manager.getPosition(this._dragEl),this._pagePosAtDown=Xe(this._dragEl),this._pageDelta={x:this._pagePosAtDown.x-this._posAtDown.x,y:this._pagePosAtDown.y-this._posAtDown.y},this._size=this.manager.getSize(this._dragEl),Ve(this._dragEl,this.manager.css.drag),this._constrainRect={w:(t=this._dragEl).parentNode.offsetWidth+t.parentNode.scrollLeft,h:t.parentNode.offsetHeight+t.parentNode.scrollTop},this._ghostDx=0,this._ghostDy=0}},{key:"unmark",value:function(e){this._isConstrained&&this._useGhostProxy(this._elementToDrag,this._dragEl)?(this._ghostProxyOffsets={x:this._dragEl.offsetLeft-this._ghostDx,y:this._dragEl.offsetTop-this._ghostDy},this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=this._elementToDrag):this._ghostProxyOffsets=null,ze(this._dragEl,this.manager.css.drag),this._isConstrained=!1}},{key:"moveBy",value:function(e,t,n){var i=this.toGrid({x:this._posAtDown.x+e,y:this._posAtDown.y+t}),o=this._doConstrain(i,this._dragEl,this._constrainRect,this._size,n);if(null!=o){if(this._useGhostProxy(this.el,this._dragEl))if(i.x!==o.x||i.y!==o.y){if(!this._isConstrained){var s=this._ghostProxyFunction(this._elementToDrag);Ve(s,Ri),this._ghostProxyParent?(this._ghostProxyParent.appendChild(s),this._currentParentPosition=Xe(this._elementToDrag.parentNode),this._ghostParentPosition=Xe(this._ghostProxyParent),this._ghostDx=this._currentParentPosition.x-this._ghostParentPosition.x,this._ghostDy=this._currentParentPosition.y-this._ghostParentPosition.y):this._elementToDrag.parentNode.appendChild(s),this._dragEl=s,this._isConstrained=!0}o=i}else this._isConstrained&&(this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=this._elementToDrag,this._isConstrained=!1,this._currentParentPosition=null,this._ghostParentPosition=null,this._ghostDx=0,this._ghostDy=0);this.manager.setPosition(this._dragEl,{x:o.x+this._ghostDx,y:o.y+this._ghostDy}),this._dispatch(Oi,{el:this.el,pos:o,e:n,drag:this,size:this._size,originalPos:this._posAtDown})}}},{key:"abort",value:function(){null!=this._downAt&&this._upListener()}},{key:"getDragElement",value:function(e){return e?this._elementToDrag||this.el:this._dragEl||this.el}},{key:"stop",value:function(e,t){if(t||this._moving){var n=[],i=this.manager.getPosition(this._dragEl);n.push([this._dragEl,i,this,this._size]),this._dispatch(ji,{el:this._dragEl,pos:this._ghostProxyOffsets||i,finalPos:i,e:e,drag:this,selection:n,size:this._size,originalPos:{x:this._posAtDown.x,y:this._posAtDown.y}})}else this._moving||this._activeSelectorParams.dragAbort&&this._activeSelectorParams.dragAbort(this._elementToDrag)}},{key:"_dispatch",value:function(e,t){var n=null;if(this._activeSelectorParams&&this._activeSelectorParams[e])n=this._activeSelectorParams[e](t);else if(this.listeners[e])for(var i=0;i<this.listeners[e].length;i++)try{var o=this.listeners[e][i](t);null!=o&&(n=o)}catch(e){}return n}},{key:"resolveGrid",value:function(){var e={grid:null,thresholdX:5,thresholdY:5};return null!=this._activeSelectorParams&&null!=this._activeSelectorParams.grid&&(e.grid=this._activeSelectorParams.grid,null!=this._activeSelectorParams.snapThreshold&&(e.thresholdX=this._activeSelectorParams.snapThreshold,e.thresholdY=this._activeSelectorParams.snapThreshold)),e}},{key:"toGrid",value:function(e){var t=this.resolveGrid(),n=t.grid,i=t.thresholdX,o=t.thresholdY;return null==n?e:function(e,t,n,i){n=null==n?null==t.thresholdX?t.w/2:t.thresholdX:n,i=null==i?null==t.thresholdY?t.h/2:t.thresholdY:i;var o=Math.floor(e.x/t.w),s=t.w*o,r=s+t.w,a=Math.abs(e.x-s)<=n?s:Math.abs(r-e.x)<=n?r:e.x,l=Math.floor(e.y/t.h),c=t.h*l,u=c+t.h;return{x:a,y:Math.abs(e.y-c)<=i?c:Math.abs(u-e.y)<=i?u:e.y}}(e,n,n?n.w/2:i,n?n.h/2:o)}},{key:"setUseGhostProxy",value:function(e){this._useGhostProxy=e?Gi:Li}},{key:"_doConstrain",value:function(e,t,n,i,o){return null!=this._activeSelectorParams&&this._activeSelectorParams.constrainFunction&&"function"==typeof this._activeSelectorParams.constrainFunction?this._activeSelectorParams.constrainFunction(e,t,n,i,o):e}},{key:"_testFilter",value:function(e){for(var t in this._filters){var n=this._filters[t],i=n[0](e);if(n[1]&&(i=!i),!i)return!1}return!0}},{key:"addFilter",value:function(e,t){var n,i=this;if(e){var o="function"==typeof(n=e)?(n._katavorioId=we(),n._katavorioId):n;this._filters[o]=[function(t){var n,o=t.srcElement||t.target;return ae(e)?n=Le(o,e,i.el):"function"==typeof e&&(n=e(t,i.el)),n},!1!==t]}}},{key:"removeFilter",value:function(e){var t="function"==typeof e?e._katavorioId:e;delete this._filters[t]}},{key:"clearAllFilters",value:function(){this._filters={}}},{key:"addSelector",value:function(e,t){e.selector&&(t?this._availableSelectors.unshift(e):this._availableSelectors.push(e))}},{key:"destroy",value:function(){this.eventManager.off(this.el,Kt,this.downListener),this.eventManager.off(document,tn,this.moveListener),this.eventManager.off(document,nn,this.upListener),this.downListener=null,this.upListener=null,this.moveListener=null,null!=this.scrollTracker&&document.removeEventListener("scroll",this.scrollTracker)}}]),n}(qi),Ji=["input","textarea","select","button","option"].join(","),Ki=function(){function e(t){V(this,e),Y(this,"eventManager",void 0),Y(this,"zoom",1),Y(this,"css",{}),Y(this,"inputFilterSelector",void 0),Y(this,"positioningStrategy",void 0),Y(this,"_positionSetter",void 0),Y(this,"_positionGetter",void 0),Y(this,"_sizeSetter",void 0),Y(this,"_sizeGetter",void 0),t=t||{},this.inputFilterSelector=t.inputFilterSelector||Ji,this.eventManager=new mi,this.zoom=t.zoom||1,this.positioningStrategy=t.positioningStrategy||Mi.absolutePosition,this._positionGetter=Bi.get(this.positioningStrategy),this._positionSetter=Hi.get(this.positioningStrategy),this._sizeGetter=zi.get(this.positioningStrategy),this._sizeSetter=Vi.get(this.positioningStrategy);var n=t.css||{};se(this.css,n)}return U(e,[{key:"getPosition",value:function(e){return this._positionGetter(e)}},{key:"setPosition",value:function(e,t){this._positionSetter(e,t)}},{key:"getSize",value:function(e){return this._sizeGetter(e)}},{key:"getZoom",value:function(){return this.zoom}},{key:"setZoom",value:function(e){this.zoom=e}},{key:"_prepareParams",value:function(e){e=e||{};var t,n={events:{}};for(t in e)n[t]=e[t];for(t=0;t<Yi.length;t++)n.events[Yi[t]]=e[Yi[t]]||Xi;return n}},{key:"getInputFilterSelector",value:function(){return this.inputFilterSelector}},{key:"setInputFilterSelector",value:function(e){return this.inputFilterSelector=e,this}},{key:"draggable",value:function(e,t){if(null==e._katavorioDrag){var n=this._prepareParams(t),i=new Zi(e,n,this);return Ve(e,Ni),e._katavorioDrag=i,i}return e._katavorioDrag}},{key:"destroyDraggable",value:function(e){e._katavorioDrag&&(e._katavorioDrag.destroy(),delete e._katavorioDrag)}}]),e}(),Qi="jtk-drag-selected",eo=function(){function e(t){V(this,e),this.instance=t,Y(this,"_dragSelection",[]),Y(this,"_dragSizes",new Map),Y(this,"_dragElements",new Map),Y(this,"_dragElementStartPositions",new Map),Y(this,"_dragElementPositions",new Map),Y(this,"__activeSet",void 0)}return U(e,[{key:"_activeSet",get:function(){return null==this.__activeSet?this._dragSelection:this.__activeSet}},{key:"length",get:function(){return this._dragSelection.length}},{key:"filterActiveSet",value:function(e){var t=this;this.__activeSet=[],ve(this._dragSelection,(function(n){e(n)&&t.__activeSet.push(n)}))}},{key:"clear",value:function(){var e=this;this.reset(),ve(this._dragSelection,(function(t){return e.instance.removeClass(t.jel,Qi)})),this._dragSelection.length=0}},{key:"reset",value:function(){this._dragElementStartPositions.clear(),this._dragElementPositions.clear(),this._dragSizes.clear(),this._dragElements.clear(),this.__activeSet=null}},{key:"initialisePositions",value:function(){var e=this;ve(this._activeSet,(function(t){var n=e.instance.viewport.getPosition(t.id),i={x:parseInt(""+t.jel.offsetLeft,10),y:parseInt(""+t.jel.offsetTop,10)};e._dragElementStartPositions.set(t.id,i),e._dragElementPositions.set(t.id,i),e._dragSizes.set(t.id,{w:n.w,h:n.h})}))}},{key:"updatePositions",value:function(e,t,n){var i=this,o=e.x-t.x,s=e.y-t.y;ve(this._activeSet,(function(e){var t=i._dragElementStartPositions.get(e.id);if(t){var r=t.x+o,a=t.y+s,l=i._dragSizes.get(e.id),c={x:r,y:a,w:l.w,h:l.h};if(e.jel._jsPlumbParentGroup&&e.jel._jsPlumbParentGroup.constrain){var u={w:e.jel.parentNode.offsetWidth+e.jel.parentNode.scrollLeft,h:e.jel.parentNode.offsetHeight+e.jel.parentNode.scrollTop};c.x=Math.max(c.x,0),c.y=Math.max(c.y,0),c.x=Math.min(c.x,u.w-l.w),c.y=Math.min(c.y,u.h-l.h)}i._dragElementPositions.set(e.id,{x:r,y:a}),e.jel.style.left=c.x+"px",e.jel.style.top=c.y+"px",n(e.jel,e.id,l,c)}}))}},{key:"each",value:function(e){var t=this;ve(this._activeSet,(function(n){var i=t._dragSizes.get(n.id),o=t._dragElementPositions.get(n.id),s=t._dragElementStartPositions.get(n.id);e(n.jel,n.id,o,i,s)}))}},{key:"add",value:function(e,t){var n=e;t=t||this.instance.getId(n),-1===ge(this._dragSelection,(function(e){return e.id===t}))&&(this.instance.addClass(e,Qi),this._dragSelection.push({id:t,jel:n}))}},{key:"remove",value:function(e){var t=this,n=e;this._dragSelection=this._dragSelection.filter((function(e){var i=e.jel!==n;return i||t.instance.removeClass(e.jel,Qi),i}))}},{key:"toggle",value:function(e){var t=e;-1!==ge(this._dragSelection,(function(e){return e.jel===t}))?this.remove(t):this.add(e)}}]),e}(),to="jtk-drag-active",no="jtk-drag-hover",io=function(){function e(t,n,i){var o=this;V(this,e),this.instance=t,this.dragSelection=n,Y(this,"collicat",void 0),Y(this,"drag",void 0),Y(this,"_draggables",{}),Y(this,"_dlist",[]),Y(this,"_elementsWithEndpoints",{}),Y(this,"_draggablesForElements",{}),Y(this,"handlers",[]),Y(this,"_trackScroll",void 0),Y(this,"_filtersToAdd",[]),this.collicat=new Ki({zoom:this.instance.currentZoom,css:{noSelect:this.instance.dragSelectClass,delegatedDraggable:"jtk-delegated-draggable",draggable:"jtk-draggable",drag:"jtk-drag",selected:Qi,active:to,hover:no,ghostProxy:"jtk-ghost-proxy"}}),this.instance.bind(Pt,(function(e){o.collicat.setZoom(e)})),i=i||{},this._trackScroll=!1!==i.trackScroll}return U(e,[{key:"addHandler",value:function(e,t){var n=this,i=se({selector:e.selector},t||{});i.start=je(i.start,(function(t){return e.onStart(t)}),!1),i.drag=je(i.drag,(function(t){return e.onDrag(t)})),i.stop=je(i.stop,(function(t){return e.onStop(t)}));var o=(e.onBeforeStart||function(e){}).bind(e);if(i.beforeStart=je(i.beforeStart,(function(e){return o(e)})),i.dragInit=function(t,n){return e.onDragInit(t,n)},i.dragAbort=function(t){return e.onDragAbort(t)},e.useGhostProxy&&(i.useGhostProxy=e.useGhostProxy,i.makeGhostProxy=e.makeGhostProxy),null==i.constrainFunction&&null!=i.containment)switch(i.containment){case Ui.notNegative:i.constrainFunction=function(e,t,n,i){return{x:Math.max(0,Math.min(e.x)),y:Math.max(0,Math.min(e.y))}};break;case Ui.parent:var s=i.containmentPadding||5;i.constrainFunction=function(e,t,n,i){return{x:e.x<0?0:e.x>n.w-s?n.w-s:e.x,y:e.y<0?0:e.y>n.h-s?n.h-s:e.y}};break;case Ui.parentEnclosed:i.constrainFunction=function(e,t,n,i){return{x:e.x<0?0:e.x+i.w>n.w?n.w-i.w:e.x,y:e.y<0?0:e.y+i.h>n.h?n.h-i.h:e.y}}}null==this.drag?(i.trackScroll=this._trackScroll,this.drag=this.collicat.draggable(this.instance.getContainer(),i),ve(this._filtersToAdd,(function(e){return n.drag.addFilter(e[0],e[1])})),this.drag.on(an,(function(e){n.instance.revalidate(e)}))):this.drag.addSelector(i),this.handlers.push({handler:e,options:i}),e.init(this.drag)}},{key:"addSelector",value:function(e,t){this.drag&&this.drag.addSelector(e,t)}},{key:"addFilter",value:function(e,t){null==this.drag?this._filtersToAdd.push([e,!0===t]):this.drag.addFilter(e,t)}},{key:"removeFilter",value:function(e){null!=this.drag&&this.drag.removeFilter(e)}},{key:"setFilters",value:function(e){var t=this;ve(e,(function(e){t.drag.addFilter(e[0],e[1])}))}},{key:"reset",value:function(){var e=[];if(ve(this.handlers,(function(e){e.handler.reset()})),this.handlers.length=0,null!=this.drag){var t=this.drag._filters;for(var n in t)e.push([n,t[n][1]]);this.collicat.destroyDraggable(this.instance.getContainer())}return delete this.drag,e}},{key:"setOption",value:function(e,t){var n=ye(this.handlers,(function(t){return t.handler===e}));null!=n&&se(n.options,t||{})}}]),e}();function oo(e,t){return ae(t)?{id:t,active:!0}:{id:t.id,active:t.active}}var so,ro,ao,lo,co=function(){function e(t,n){V(this,e),this.instance=t,this._dragSelection=n,Y(this,"selector","> "+Dt+":not("+Je(gt)+")"),Y(this,"_dragOffset",null),Y(this,"_groupLocations",[]),Y(this,"_intersectingGroups",[]),Y(this,"_currentDragParentGroup",null),Y(this,"_dragGroupByElementIdMap",{}),Y(this,"_dragGroupMap",{}),Y(this,"_currentDragGroup",null),Y(this,"_currentDragGroupOffsets",new Map),Y(this,"_currentDragGroupSizes",new Map),Y(this,"_currentDragGroupOriginalPositions",new Map),Y(this,"_dragPayload",null),Y(this,"drag",void 0),Y(this,"originalPosition",void 0)}return U(e,[{key:"onDragInit",value:function(e){return null}},{key:"onDragAbort",value:function(e){return null}},{key:"getDropGroup",value:function(){var e=null;if(this._intersectingGroups.length>0){var t=this._intersectingGroups[0].groupLoc.group,n=this._intersectingGroups[0].intersectingElement,i=n._jsPlumbParentGroup;i!==t&&(null!=i&&i.overrideDrop(n,t)||(e=this._intersectingGroups[0]))}return e}},{key:"onStop",value:function(e){var t,n=this,i=e.drag.getDragElement(),o=this.getDropGroup(),s=[];function r(e,t,n,i,r){var a=n.x,l=n.y;if(e._jsPlumbParentGroup&&e._jsPlumbParentGroup.constrain){var c={w:e.parentNode.offsetWidth+e.parentNode.scrollLeft,h:e.parentNode.offsetHeight+e.parentNode.scrollTop};a=Math.max(a,0),l=Math.max(l,0),a=Math.min(a,c.w-i.w),l=Math.min(l,c.h-i.h),n.x=a,n.y=l}s.push({el:e,id:t,pos:n,originalPos:r,originalGroup:e._jsPlumbParentGroup,redrawResult:null,reverted:!1,dropGroup:null==o?void 0:o.groupLoc.group})}if(s.push({el:i,id:this.instance.getId(i),pos:e.finalPos,originalGroup:i._jsPlumbParentGroup,redrawResult:null,originalPos:e.originalPos,reverted:!1,dropGroup:null!=o?o.groupLoc.group:null}),this._dragSelection.each((function(t,n,i,o,s){t!==e.el&&r(t,n,{x:i.x,y:i.y},o,s)})),null===(t=this._currentDragGroup)||void 0===t||t.members.forEach((function(t){if(t.el!==e.el){var i=n._currentDragGroupOffsets.get(t.elId),o=n._currentDragGroupSizes.get(t.elId),s={x:e.finalPos.x+i[0].x,y:e.finalPos.y+i[0].y};r(t.el,t.elId,s,o,n._currentDragGroupOriginalPositions.get(t.elId))}})),ve(s,(function(e){var t=null!=e.originalGroup,i=t&&Ai(n.instance,e.el,e.pos),s={x:0,y:0};if(t&&!i){if(null==o){var r=n._pruneOrOrphan(e,!0,!0);null!=r.pos?e.pos=r.pos.pos:!r.pruned&&e.originalGroup.revert&&(e.pos=e.originalPos,e.reverted=!0)}}else t&&i&&(s=n._computeOffsetByParentGroup(e.originalGroup));null==o||i?e.dropGroup=null:n.instance.groupManager.addToGroup(o.groupLoc.group,!1,e.el),e.reverted&&n.instance.setPosition(e.el,e.pos),e.redrawResult=n.instance.setElementPosition(e.el,e.pos.x+s.x,e.pos.y+s.y),n.instance.removeClass(e.el,"jtk-dragged"),n.instance.select({source:e.el}).removeClass(n.instance.elementDraggingClass+" "+n.instance.sourceElementDraggingClass,!0),n.instance.select({target:e.el}).removeClass(n.instance.elementDraggingClass+" "+n.instance.targetElementDraggingClass,!0)})),null!=s[0].originalGroup){var a=i._jsPlumbParentGroup;if(a!==s[0].originalGroup){var l=e.drag.getDragElement(!0);if(s[0].originalGroup.ghost){var c=this.instance.getPosition(this.instance.getGroupContentArea(a)),u=this.instance.getPosition(this.instance.getGroupContentArea(s[0].originalGroup)),h={x:u.x+e.pos.x-c.x,y:u.y+e.pos.y-c.y};l.style.left=h.x+"px",l.style.top=h.y+"px",this.instance.revalidate(l)}}}this.instance.fire("drag:stop",{elements:s,e:e.e,el:i,payload:this._dragPayload}),this._cleanup()}},{key:"_cleanup",value:function(){var e=this;ve(this._groupLocations,(function(t){e.instance.removeClass(t.el,to),e.instance.removeClass(t.el,no)})),this._currentDragParentGroup=null,this._groupLocations.length=0,this.instance.hoverSuspended=!1,this._dragOffset=null,this._dragSelection.reset(),this._dragPayload=null,this._currentDragGroupOffsets.clear(),this._currentDragGroupSizes.clear(),this._currentDragGroupOriginalPositions.clear(),this._currentDragGroup=null}},{key:"reset",value:function(){}},{key:"init",value:function(e){this.drag=e}},{key:"onDrag",value:function(e){var t=this,n=e.drag.getDragElement(),i=this.instance.getId(n),o=e.pos,s=this.instance.viewport.getPosition(i),r={x:o.x,y:o.y};this._intersectingGroups.length=0,null!=this._dragOffset&&(r.x+=this._dragOffset.x,r.y+=this._dragOffset.y);var a=function(n,i,o){if(o){var s=new Set;ve(t._groupLocations,(function(n){!s.has(n.group.id)&&Si(i,n.r)?(n.group!==t._currentDragParentGroup&&t.instance.addClass(n.el,no),t._intersectingGroups.push({groupLoc:n,intersectingElement:e.drag.getDragElement(!0),d:0}),ve(t.instance.groupManager.getAncestors(n.group),(function(e){return s.add(e.id)}))):t.instance.removeClass(n.el,no)}))}t.instance.setElementPosition(n,i.x,i.y),t.instance.fire("drag:move",{el:n,e:e.e,pos:{x:i.x,y:i.y},originalPosition:t.originalPosition,payload:t._dragPayload})},l={x:r.x,y:r.y,w:s.w,h:s.h};a(n,l,!0),this._dragSelection.updatePositions(o,this.originalPosition,(function(e,t,n,i){a(e,i,!1)})),this._currentDragGroupOffsets.forEach((function(e,n){var i=t._currentDragGroupSizes.get(n),o={x:l.x+e[0].x,y:l.y+e[0].y,w:i.w,h:i.h};e[1].style.left=o.x+"px",e[1].style.top=o.y+"px",a(e[1],o,!1)}))}},{key:"_computeOffsetByParentGroup",value:function(e){var t=this.instance.getPosition(e.el),n=e.contentArea;if(n!==e.el){var i=this.instance.getPosition(n);t.x+=i.x,t.y+=i.y}if(e.el._jsPlumbParentGroup){var o=this._computeOffsetByParentGroup(e.el._jsPlumbParentGroup);t.x+=o.x,t.y+=o.y}return t}},{key:"onStart",value:function(e){var t=this,n=e.drag.getDragElement(),i=this.instance.getPosition(n);this.originalPosition={x:e.pos.x,y:e.pos.y},n._jsPlumbParentGroup&&(this._dragOffset=this._computeOffsetByParentGroup(n._jsPlumbParentGroup),this._currentDragParentGroup=n._jsPlumbParentGroup);var o=!0,s=n.getAttribute(at);if((!1===this.instance.elementsDraggable||null!=s&&s!==Wn)&&(o=!1),o){this._groupLocations.length=0,this._intersectingGroups.length=0,this.instance.hoverSuspended=!0;var r=e.drag.getDragElement(!0),a=r.querySelectorAll(Dt),l=function(e){for(var t=[],n=e._jsPlumbParentGroup;null!=n;)t.push(n.el),n=n.group;return t}(r),c=[];Array.prototype.push.apply(c,a),Array.prototype.push.apply(c,l),this._dragSelection.filterActiveSet((function(e){return-1===c.indexOf(e.jel)})),this._dragSelection.initialisePositions();var u=function(n,i,o){if(!n._isJsPlumbGroup||t.instance.allowNestedGroups){var s=!n._jsPlumbParentGroup,r=s||!0!==n._jsPlumbParentGroup.dropOverride,a=!s&&(n._jsPlumbParentGroup.ghost||!0!==n._jsPlumbParentGroup.constrain);(s||r&&a)&&(ve(t.instance.groupManager.getGroups(),(function(e){var i=n._jsPlumbGroup;if(!1!==e.droppable&&!1!==e.enabled&&n._jsPlumbGroup!==e&&!t.instance.groupManager.isDescendant(e,i)){var o=e.el,s=t.instance.getId(o),r=t.instance.viewport.getPosition(s),a={el:o,r:{x:r.x,y:r.y,w:r.w,h:r.h},group:e};t._groupLocations.push(a),e!==t._currentDragParentGroup&&t.instance.addClass(o,to)}})),t._groupLocations.sort((function(e,n){return t.instance.groupManager.isDescendant(e.group,n.group)?-1:t.instance.groupManager.isAncestor(n.group,e.group)?1:0})))}return t.instance.select({source:n}).addClass(t.instance.elementDraggingClass+" "+t.instance.sourceElementDraggingClass,!0),t.instance.select({target:n}).addClass(t.instance.elementDraggingClass+" "+t.instance.targetElementDraggingClass,!0),t.instance.fire("drag:start",{el:n,e:e.e,originalPosition:t.originalPosition,pos:t.originalPosition,dragGroup:i,dragGroupMemberSpec:o})},h=this.instance.getId(n);this._currentDragGroup=this._dragGroupByElementIdMap[h],this._currentDragGroup&&!function(e,t){var n=me(e.members,(function(e){return e.el===t}));return null!==n&&!0===n.active}(this._currentDragGroup,n)&&(this._currentDragGroup=null);var d=u(n);if(!1===d)return this._cleanup(),!1;this._dragPayload=d,null!=this._currentDragGroup&&(this._currentDragGroupOffsets.clear(),this._currentDragGroupSizes.clear(),this._currentDragGroup.members.forEach((function(e){var n=t.instance.viewport.getPosition(e.elId);t._currentDragGroupOffsets.set(e.elId,[{x:n.x-i.x,y:n.y-i.y},e.el]),t._currentDragGroupSizes.set(e.elId,n),t._currentDragGroupOriginalPositions.set(e.elId,{x:n.x,y:n.y}),u(e.el,t._currentDragGroup,e)})))}return o}},{key:"addToDragGroup",value:function(e){var t=this,n=oo(this.instance,e),i=this._dragGroupMap[n.id];null==i&&(i={id:n.id,members:new Set},this._dragGroupMap[n.id]=i);for(var o=arguments.length,s=new Array(o>1?o-1:0),r=1;r<o;r++)s[r-1]=arguments[r];this.removeFromDragGroup.apply(this,s),ve(s,(function(e){var o=t.instance.getId(e);i.members.add({elId:o,el:e,active:n.active}),t._dragGroupByElementIdMap[o]=i}))}},{key:"removeFromDragGroup",value:function(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];ve(n,(function(t){var n=e.instance.getId(t),i=e._dragGroupByElementIdMap[n];if(null!=i){var o=new Set;i.members.forEach((function(e){e.el!==t&&o.add(e)})),i.members=o,delete e._dragGroupByElementIdMap[n]}}))}},{key:"setDragGroupState",value:function(e){for(var t=this,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];var s=i.map((function(e){return t.instance.getId(e)}));ve(s,(function(n){var i=t._dragGroupByElementIdMap[n];if(null!=i){var o=me(i.members,(function(e){return e.elId===n}));null!=o&&(o.active=e)}}))}},{key:"clearDragGroup",value:function(e){var t=this,n=this._dragGroupMap[e];null!=n&&(n.members.forEach((function(e){delete t._dragGroupByElementIdMap[e.elId]})),n.members.clear())}},{key:"_pruneOrOrphan",value:function(e,t,n){var i=e.el,o={pruned:!1,pos:null};if(n||!Ai(this.instance,i,e.pos)){var s=i._jsPlumbParentGroup;s.prune?(i._isJsPlumbGroup?this.instance.removeGroup(i._jsPlumbGroup):s.remove(e.el,!0),o.pruned=!0):s.orphan&&(o.pos=this.instance.groupManager.orphan(e.el,t),i._isJsPlumbGroup?s.removeGroup(i._jsPlumbGroup):s.remove(e.el))}return o}}]),e}(),uo={},ho={},po={},fo={get:function(e,t,n){var i=uo[t];if(i)return new i(e,n);throw{message:"jsPlumb: unknown endpoint type '"+t+"'"}},clone:function(e){var t=po[e.type];return fo.get(e.endpoint,e.type,t.getParams(e))},compute:function(e,t,n,i){var o=ho[e.type];if(null!=o)return o(e,t,n,i);Te("jsPlumb: cannot find endpoint calculator for endpoint of type ",e.type)},registerHandler:function(e){po[e.type]=e,uo[e.type]=e.cls,ho[e.type]=e.compute}},vo=function(){function e(t,n){V(this,e),this.endpoint=t,Y(this,"typeId",void 0),Y(this,"x",void 0),Y(this,"y",void 0),Y(this,"w",void 0),Y(this,"h",void 0),Y(this,"computedValue",void 0),Y(this,"bounds",{xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}),Y(this,"classes",[]),Y(this,"instance",void 0),Y(this,"type",void 0),n=n||{},this.instance=t.instance,t.cssClass&&this.classes.push(t.cssClass),n.cssClass&&this.classes.push(n.cssClass)}return U(e,[{key:"addClass",value:function(e){this.classes.push(e),this.instance.addEndpointClass(this.endpoint,e)}},{key:"removeClass",value:function(e){this.classes=this.classes.filter((function(t){return t!==e})),this.instance.removeEndpointClass(this.endpoint,e)}},{key:"compute",value:function(e,t,n){this.computedValue=fo.compute(this,e,t,n),this.bounds.xmin=this.x,this.bounds.ymin=this.y,this.bounds.xmax=this.x+this.w,this.bounds.ymax=this.y+this.h}},{key:"setVisible",value:function(e){this.instance.setEndpointVisible(this.endpoint,e)}}]),e}();!function(e){e.top="top",e.left="left",e.right="right",e.bottom="bottom"}(lo||(lo={}));var go=lo.top,yo=lo.left,mo=lo.right,_o=lo.bottom,xo=[yo,mo],bo=[go,_o],ko=function(){function e(t,n,i){V(this,e),this.instance=t,this.element=n,Y(this,"isFloating",!0),Y(this,"isContinuous",void 0),Y(this,"isDynamic",void 0),Y(this,"locations",[]),Y(this,"currentLocation",0),Y(this,"locked",!1),Y(this,"cssClass",""),Y(this,"timestamp",null),Y(this,"type","Floating"),Y(this,"id",we()),Y(this,"orientation",[0,0]),Y(this,"size",void 0),this.size=t.viewport.getPosition(i),this.locations.push({x:.5,y:.5,ox:this.orientation[0],oy:this.orientation[1],offx:0,offy:0,iox:this.orientation[0],ioy:this.orientation[1],cls:""})}return U(e,[{key:"_updateOrientationInRouter",value:function(){this.instance.router.setAnchorOrientation(this,[this.locations[0].ox,this.locations[0].oy])}},{key:"over",value:function(e){this.orientation=this.instance.router.getEndpointOrientation(e),this.locations[0].ox=this.orientation[0],this.locations[0].oy=this.orientation[1],this._updateOrientationInRouter()}},{key:"out",value:function(){this.orientation=null,this.locations[0].ox=this.locations[0].iox,this.locations[0].oy=this.locations[0].ioy,this._updateOrientationInRouter()}}]),e}(),Co=(Y(so={},go,_o),Y(so,mo,yo),Y(so,yo,mo),Y(so,_o,go),so),Eo=(Y(ro={},go,mo),Y(ro,mo,_o),Y(ro,yo,go),Y(ro,_o,yo),ro),So=(Y(ao={},go,yo),Y(ao,mo,go),Y(ao,yo,_o),Y(ao,_o,mo),ao);function Po(e){return 0===e.faces.length?go:e.faces[0]}function wo(e,t){return-1!==e.faces.indexOf(t)}function Ao(e,t){return null==e.lockedAxis?null==e.lockedFace?!0===wo(e,t):e.lockedFace===t:-1!==e.lockedAxis.indexOf(t)}function Mo(e,t){if(wo(e,t))return t;if(wo(e,Co[t]))return Co[t];var n=function(e,t){return(e.clockwise?Eo:So)[t]}(e,t);if(wo(e,n))return n;var i=function(e,t){return(e.clockwise?So:Eo)[t]}(e,t);return wo(e,i)?i:t}var Do={x:.5,y:0,ox:0,oy:-1,offx:0,offy:0},To={x:.5,y:1,ox:0,oy:1,offx:0,offy:0},Oo={x:0,y:.5,ox:-1,oy:0,offx:0,offy:0},jo={x:1,y:.5,ox:1,oy:0,offx:0,offy:0},Io={Top:[Do],Bottom:[To],Left:[Oo],Right:[jo],TopLeft:[{x:0,y:0,ox:0,oy:-1,offx:0,offy:0}],TopRight:[{x:1,y:0,ox:1,oy:-1,offx:0,offy:0}],BottomLeft:[{x:0,y:1,ox:0,oy:1,offx:0,offy:0}],BottomRight:[{x:1,y:1,ox:0,oy:1,offx:0,offy:0}],Center:[{x:.5,y:.5,ox:0,oy:0,offx:0,offy:0}],AutoDefault:[Do,Oo,To,jo]},Go={Continuous:{faces:[go,yo,_o,mo]},ContinuousTop:{faces:[go]},ContinuousRight:{faces:[mo]},ContinuousBottom:{faces:[_o]},ContinuousLeft:{faces:[yo]},ContinuousLeftRight:{faces:[yo,mo]},ContinuousTopBottom:{faces:[go,_o]}};function Lo(e,t){if(t=t||{},e===Pn.Perimeter)return function(e){var t=(e=e||{}).anchorCount||60,n=e.shape;if(!n)throw new Error("no shape supplied to Perimeter Anchor type");if(!zo.has(n))throw new Error("Shape ["+n+"] is unknown by Perimeter Anchor type");var i=zo.get(n)(t);e.rotation&&(i=function(e,t){for(var n=[],i=t/180*Math.PI,o=0;o<e.length;o++){var s=e[o].x-.5,r=e[o].y-.5;n.push({x:s*Math.cos(i)-r*Math.sin(i)+.5,y:s*Math.sin(i)+r*Math.cos(i)+.5,ox:e[o].ox,oy:e[o].oy,offx:0,offy:0,iox:0,ioy:0,cls:""})}return n}(i,e.rotation));return se(No(Pn.Perimeter,i,e),{shape:n})}(t);var n=Io[e];if(null!=n)return No(e,De(n,(function(e){return se({iox:e.ox,ioy:e.oy},e)})),t);if(null!=(n=Go[e]))return function(e,t,n){var i={type:e,locations:[],currentLocation:0,locked:!1,id:we(),cssClass:n.cssClass||"",isFloating:!1,isContinuous:!0,timestamp:null,faces:n.faces||t,lockedFace:null,lockedAxis:null,clockwise:!(!1===n.clockwise),__currentFace:null};return Object.defineProperty(i,Fo,{get:function(){return this.__currentFace},set:function(e){this.__currentFace=Mo(this,e)}}),i}(e,n.faces,t);throw{message:"jsPlumb: unknown anchor type '"+e+"'"}}function No(e,t,n){return{type:e,locations:t,currentLocation:0,locked:!1,id:we(),isFloating:!1,isContinuous:!1,isDynamic:t.length>1,timestamp:null,cssClass:n.cssClass||""}}var Fo="currentFace";function Ro(e){return e.length<7&&e.every(re)||7===e.length&&e.slice(0,5).every(re)&&ae(e[6])}function $o(e){if(ae(e))return Lo(e,null);if(Array.isArray(e)){if(Ro(e)){var t=e;return No(null,[{x:t[0],y:t[1],ox:t[2],oy:t[3],offx:null==t[4]?0:t[4],offy:null==t[5]?0:t[5],iox:t[2],ioy:t[3],cls:t[6]||""}],{cssClass:t[6]||""})}return No("Dynamic",De(e,(function(e){if(ae(e)){var t=Io[e];return null!=t?se({iox:t[0].ox,ioy:t[0].oy,cls:""},t[0]):null}if(Ro(e))return{x:e[0],y:e[1],ox:e[2],oy:e[3],offx:null==e[4]?0:e[4],offy:null==e[5]?0:e[5],iox:e[2],ioy:e[3],cls:e[6]||""}})).filter((function(e){return null!=e})),{})}var n=e;return Lo(n.type,n.options)}function Ho(e){for(var t=.5,n=2*Math.PI/e,i=[],o=0,s=0;s<e;s++){var r=t+t*Math.sin(o),a=t+t*Math.cos(o);i.push({x:r,y:a,ox:0,oy:0,offx:0,offy:0,iox:0,ioy:0,cls:""}),o+=n}return i}function Bo(e,t){for(var n=[],i=0;i<e.length;i++)n.push([e[i][0],e[i][1],e[i][2],e[i][3],1/e.length,e[i][4],e[i][5]]);return function(e,t){for(var n=t/e.length,i=[],o=function(e,o,s,r,a,l,c){for(var u=(s-e)/(n=t*a),h=(r-o)/n,d=0;d<n;d++)i.push({x:e+u*d,y:o+h*d,ox:null==l?0:l,oy:null==c?0:c,offx:0,offy:0,iox:0,ioy:0,cls:""})},s=0;s<e.length;s++)o.apply(null,e[s]);return i}(n,t)}function Vo(e){return Bo([[0,0,1,0,0,-1],[1,0,1,1,1,0],[1,1,0,1,0,1],[0,1,0,0,-1,0]],e)}var zo=new Map;zo.set(Sn.Circle,Ho),zo.set(Sn.Ellipse,Ho),zo.set(Sn.Rectangle,Vo),zo.set(Sn.Square,Vo),zo.set(Sn.Diamond,(function(e){return Bo([[.5,0,1,.5],[1,.5,.5,1],[.5,1,0,.5],[0,.5,.5,0]],e)})),zo.set(Sn.Triangle,(function(e){return Bo([[.5,0,1,1],[1,1,0,1],[0,1,.5,0]],e)}));var Uo=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];V(this,e),this.selector=t,this.def=n,this.exclude=i,Y(this,"id",void 0),Y(this,"redrop",void 0),this.id=we(),this.redrop=n.def.redrop||Yo}return U(e,[{key:"setEnabled",value:function(e){this.def.enabled=e}},{key:"isEnabled",value:function(){return!1!==this.def.enabled}}]),e}(),Yo="strict";function Xo(e,t,n,i,o,s){var r=function(e,t,n){return new ko(e,t,n)}(s,i,o),a={paintStyle:e.getPaintStyle(),preparedAnchor:r,element:i,scope:e.scope,cssClass:[pt,e.cssClass].join(" ")};null!=t&&(Ge(t,vo)?a.existingEndpoint=t:a.endpoint=t);var l=s._internal_newEndpoint(a);return s._paintEndpoint(l,{}),l}function Wo(e,t,n,i,o){for(var s=e.target||e.srcElement,r=!1,a=i.getSelector(t,n),l=0;l<a.length;l++)if(a[l]===s){r=!0;break}return o?!r:r}var qo=Je(to,no),Zo="sourceSelectorEndpoint",Jo=function(){function e(t){V(this,e),this.instance=t,Y(this,"jpc",void 0),Y(this,"existingJpc",void 0),Y(this,"_originalAnchorSpec",void 0),Y(this,"ep",void 0),Y(this,"endpointRepresentation",void 0),Y(this,"canvasElement",void 0),Y(this,"_activeDefinition",void 0),Y(this,"placeholderInfo",{id:null,element:null}),Y(this,"floatingIndex",void 0),Y(this,"floatingId",void 0),Y(this,"floatingElement",void 0),Y(this,"floatingEndpoint",void 0),Y(this,"floatingAnchor",void 0),Y(this,"_stopped",void 0),Y(this,"inPlaceCopy",void 0),Y(this,"endpointDropTargets",[]),Y(this,"currentDropTarget",null),Y(this,"payload",void 0),Y(this,"floatingConnections",{}),Y(this,"_forceReattach",void 0),Y(this,"_forceDetach",void 0),Y(this,"mousedownHandler",void 0),Y(this,"mouseupHandler",void 0),Y(this,"selector",Je(dt));var n=t.getContainer();this.mousedownHandler=this._mousedownHandler.bind(this),this.mouseupHandler=this._mouseupHandler.bind(this),t.on(n,Kt,Dt,this.mousedownHandler),t.on(n,nn,[Dt,Je(dt)].join(","),this.mouseupHandler)}return U(e,[{key:"_resolveDragParent",value:function(e,t){var n=this.instance.getContainer(),i=Fe(t,Dt,n,!0);if(null!=e.parentSelector){var o=Fe(t,e.parentSelector,n,!0);return null!=o&&(i=Fe(o.parentNode,Dt,n,!1)),o||i}return i}},{key:"_mousedownHandler",value:function(e){var t,n;if(3!==e.which&&2!==e.button){var i=e.target||e.srcElement;if((null==(n=this._getSourceDefinition(e))||null!=(t=this._resolveDragParent(n.def.def,i))&&t.getAttribute(Vt)!==Wn)&&n){var o,s=e.currentTarget;if(i.getAttribute(Vt)!==Wn){if(Ne(e),this._activeDefinition=n,null!=(o=n.def.def).canAcceptNewConnection&&!o.canAcceptNewConnection(t,e))return!1;var r=mr(e,t,this.instance.currentZoom),a={element:t};if(se(a,o),a.isTemporarySource=!0,o.scope)a.scope=o.scope;else{var l=i.getAttribute(zt);null!=l&&(a.scope=l)}if(null!=(a=de(a,o.parameterExtractor?o.parameterExtractor(t,i,e):{})).maxConnections&&a.maxConnections>=0)if(this.instance.select({source:t}).length>=a.maxConnections)return Ne(e),o.onMaxConnections&&o.onMaxConnections({element:t,maxConnections:a.maxConnections},e),e.stopImmediatePropagation&&e.stopImmediatePropagation(),!1;if(o.anchorPositionFinder){var c=o.anchorPositionFinder(t,r,o,e);null!=c&&(a.anchor=c)}this._originalAnchorSpec=a.anchor||(this.instance.areDefaultAnchorsSet()?this.instance.defaults.anchors[0]:this.instance.defaults.anchor);var u=this.instance.router.prepareAnchor(this._originalAnchorSpec),h=[r.x,r.y,0,0];if(u.locations.length>0)h[2]=u.locations[0].ox,h[3]=u.locations[0].oy;else if(u.isContinuous){var d=r.x<.5?r.x:1-r.x,p=r.y<.5?r.y:1-r.y;h[2]=d<p?r.x<.5?-1:1:0,h[3]=p<d?r.y<.5?-1:1:0}a.anchor=h,a.deleteOnEmpty=!0,this.ep=this.instance._internal_newEndpoint(a);var f={};if(o.extract){for(var v in o.extract){var g=i.getAttribute(v);g&&(f[o.extract[v]]=g)}this.ep.mergeParameters(f)}if(a.uniqueEndpoint){var y=this.ep.elementId,m=this.instance.getManagedData(y,Zo,n.id);null==m?(this.instance.setManagedData(y,Zo,n.id,this.ep),this.ep.deleteOnEmpty=!1):this.ep.finalEndpoint=m}s._jsPlumbOrphanedEndpoints=s._jsPlumbOrphanedEndpoints||[],s._jsPlumbOrphanedEndpoints.push(this.ep),this.instance.trigger(this.ep.endpoint.canvas,Kt,e,f)}}}}},{key:"_mouseupHandler",value:function(e){var t=e.currentTarget||e.srcElement;t._jsPlumbOrphanedEndpoints&&(!function(e,t){e=null==e.length||"string"==typeof e?[e]:e;for(var n=0;n<e.length;n++)t(e[n])}(t._jsPlumbOrphanedEndpoints,this.instance._maybePruneEndpoint.bind(this.instance)),t._jsPlumbOrphanedEndpoints.length=0),this._activeDefinition=null}},{key:"onDragInit",value:function(e){var t=We(e,this.instance),n=qe(e,this.instance);return this._makeDraggablePlaceholder(t,n),this.placeholderInfo.element.jtk=e.jtk,this.placeholderInfo.element}},{key:"onDragAbort",value:function(e){this._cleanupDraggablePlaceholder()}},{key:"_makeDraggablePlaceholder",value:function(e,t){this.placeholderInfo=this.placeholderInfo||{};var n=Ue("div",{position:"absolute"});this.instance._appendElementToContainer(n);var i=this.instance.getId(n);return this.instance.setPosition(n,e),n.style.width=t.w+"px",n.style.height=t.h+"px",this.instance.manage(n),this.placeholderInfo.id=i,this.placeholderInfo.element=n,n}},{key:"_cleanupDraggablePlaceholder",value:function(){this.placeholderInfo.element&&(this.instance.unmanage(this.placeholderInfo.element,!0),delete this.placeholderInfo.element,delete this.placeholderInfo.id)}},{key:"reset",value:function(){var e=this.instance.getContainer();this.instance.off(e,nn,this.mouseupHandler),this.instance.off(e,Kt,this.mousedownHandler)}},{key:"init",value:function(e){}},{key:"startNewConnectionDrag",value:function(e,t){this.jpc=this.instance._newConnection({sourceEndpoint:this.ep,targetEndpoint:this.floatingEndpoint,source:this.ep.element,target:this.placeholderInfo.element,paintStyle:this.ep.connectorStyle,hoverPaintStyle:this.ep.connectorHoverStyle,connector:this.ep.connector,overlays:this.ep.connectorOverlays,type:this.ep.edgeType,cssClass:this.ep.connectorClass,hoverClass:this.ep.connectorHoverClass,scope:e,data:t}),this.jpc.pending=!0,this.jpc.addClass(this.instance.draggingClass),this.ep.addClass(this.instance.draggingClass),this.instance.fire(ln,this.jpc)}},{key:"startExistingConnectionDrag",value:function(){this.existingJpc=!0,this.instance.setHover(this.jpc,!1);var e=this.jpc.endpoints[0].id===this.ep.id?0:1;this.ep.detachFromConnection(this.jpc,null,!0),this.floatingEndpoint.addConnection(this.jpc),this.instance.fire(ln,this.jpc),this.instance.sourceOrTargetChanged(this.jpc.endpoints[e].elementId,this.placeholderInfo.id,this.jpc,this.placeholderInfo.element,e),this.jpc.suspendedEndpoint=this.jpc.endpoints[e],this.jpc.suspendedElement=this.jpc.endpoints[e].element,this.jpc.suspendedElementId=this.jpc.endpoints[e].elementId,this.jpc.suspendedElementType=0===e?Qe:et,this.instance.setHover(this.jpc.suspendedEndpoint,!1),this.floatingEndpoint.referenceEndpoint=this.jpc.suspendedEndpoint,this.floatingEndpoint.mergeParameters(this.jpc.suspendedEndpoint.parameters),this.jpc.endpoints[e]=this.floatingEndpoint,this.jpc.addClass(this.instance.draggingClass),this.floatingId=this.placeholderInfo.id,this.floatingIndex=e,this.instance._refreshEndpoint(this.ep)}},{key:"_shouldStartDrag",value:function(){var e=!0;this.ep.enabled||(e=!1),null!=this.jpc||this.ep.isSource||this.ep.isTemporarySource||(e=!1),!this.ep.isSource||!this.ep.isFull()||null!=this.jpc&&this.ep.dragAllowedWhenFull||(e=!1),null==this.jpc||this.jpc.isDetachable(this.ep)||(this.ep.isFull()?e=!1:this.jpc=null);var t={},n=this.instance.checkCondition(null==this.jpc?"beforeDrag":"beforeStartDetach",{endpoint:this.ep,source:this.ep.element,sourceId:this.ep.elementId,connection:this.jpc});return!1===n?e=!1:"object"===B(n)?se(t=n,this.payload||{}):t=this.payload||{},[e,t]}},{key:"_createFloatingEndpoint",value:function(e){var t=this.ep.endpoint;null!=this.ep.edgeType&&(t=this.instance._deriveEndpointAndAnchorSpec(this.ep.edgeType).endpoints[1]);this.floatingEndpoint=Xo(this.ep,t,0,this.placeholderInfo.element,this.placeholderInfo.id,this.instance),this.floatingAnchor=this.floatingEndpoint._anchor,this.floatingEndpoint.deleteOnEmpty=!0,this.floatingElement=this.floatingEndpoint.endpoint.canvas,this.floatingId=this.instance.getId(this.floatingElement)}},{key:"_populateTargets",value:function(e,t){var n,i,o=this,s=this.jpc&&this.jpc.endpoints[0]===this.ep;if(ve(this.instance.getContainer().querySelectorAll([".",dt,"[",ct,this.ep.scope,"]:not(.",pt,")"].join("")),(function(t){if(!(null==o.jpc&&t===e||t===o.floatingElement||null==o.jpc&&t.jtk.endpoint.isFull())&&(s&&t.jtk.endpoint.isSource||!s&&t.jtk.endpoint.isTarget)){var i=We(t,o.instance),r=qe(t,o.instance);n={x:i.x,y:i.y,w:r.w,h:r.h},o.endpointDropTargets.push({el:t,targetEl:t,r:n,endpoint:t.jtk.endpoint,def:null}),o.instance.addClass(t,to)}})),s){var r=ye(this.instance.sourceSelectors,(function(e){return e.isEnabled()&&(null==e.def.def.scope||e.def.def.scope===o.ep.scope)}));if(null!=r)ve(this._findTargetZones(r),(function(e){if(e.getAttribute(Vt)!==Wn){var t=e.getAttribute(zt);if(null!=t&&t!==o.ep.scope)return;var n={r:null,el:e};n.targetEl=Fe(e,Dt,o.instance.getContainer(),!0);var i=We(n.el,o.instance),s=qe(n.el,o.instance);n.r={x:i.x,y:i.y,w:s.w,h:s.h},null!=r.def.def.rank&&(n.rank=r.def.def.rank),n.def=r.def,o.endpointDropTargets.push(n),o.instance.addClass(n.targetEl,to)}}))}else{(function(e,t){var n=[];if(e)for(var i=0;i<e.length;i++)t(e[i])&&n.push(i);return n})(i=this.instance.targetSelectors,(function(e){return e.isEnabled()})).map((function(e){return i[e]})).forEach((function(e){ve(o._findTargetZones(e),(function(n){if(n.getAttribute(Vt)!==Wn){var i=n.getAttribute(zt);if(null!=i&&i!==o.ep.scope)return;var s={r:null,el:n};if(null!=e.def.def.parentSelector&&(s.targetEl=Fe(n,e.def.def.parentSelector,o.instance.getContainer(),!0)),null==s.targetEl&&(s.targetEl=Fe(n,Dt,o.instance.getContainer(),!0)),(!1===e.def.def.allowLoopback||o._activeDefinition&&!1===o._activeDefinition.def.def.allowLoopback)&&s.targetEl===o.ep.element)return;if(null!=e.def.def.canAcceptNewConnection&&!e.def.def.canAcceptNewConnection(s.targetEl,t))return;var r=e.def.def.maxConnections;if(null!=r&&-1!==r&&o.instance.select({target:s.targetEl}).length>=r)return;var a=We(n,o.instance),l=qe(n,o.instance);s.r={x:a.x,y:a.y,w:l.w,h:l.h},s.def=e.def,null!=e.def.def.rank&&(s.rank=e.def.def.rank),o.endpointDropTargets.push(s),o.instance.addClass(s.targetEl,to)}}))}))}this.endpointDropTargets.sort((function(e,t){if(e.targetEl._isJsPlumbGroup&&!t.targetEl._isJsPlumbGroup)return 1;if(!e.targetEl._isJsPlumbGroup&&t.targetEl._isJsPlumbGroup)return-1;if(e.targetEl._isJsPlumbGroup&&t.targetEl._isJsPlumbGroup){if(o.instance.groupManager.isAncestor(e.targetEl._jsPlumbGroup,t.targetEl._jsPlumbGroup))return-1;if(o.instance.groupManager.isAncestor(t.targetEl._jsPlumbGroup,e.targetEl._jsPlumbGroup))return 1}else{if(null==e.rank||null==t.rank)return 0;if(e.rank>t.rank)return-1;if(e.rank<t.rank)return 1}}))}},{key:"_findTargetZones",value:function(e){var t;if("any"===e.redrop){var n=this.instance.targetSelectors.map((function(e){return e.selector}));n.push.apply(n,te(this.instance.sourceSelectors.map((function(e){return e.selector})))),n.push(Dt),t=n.join(",")}else if(e.redrop===Yo)t=e.selector;else if("anySource"===e.redrop)t=this.instance.sourceSelectors.map((function(e){return e.selector})).join(",");else if("anyTarget"===e.redrop)t=this.instance.targetSelectors.map((function(e){return e.selector})).join(",");else if("anySourceOrTarget"===e.redrop){var i=this.instance.targetSelectors.map((function(e){return e.selector}));i.push.apply(i,te(this.instance.sourceSelectors.map((function(e){return e.selector})))),t=i.join(",")}return this.instance.getContainer().querySelectorAll(t)}},{key:"onStart",value:function(e){this.endpointDropTargets.length=0,this.currentDropTarget=null,this._stopped=!1;var t=e.drag.getDragElement();if(this.ep=t.jtk.endpoint,!this.ep)return!1;this.endpointRepresentation=this.ep.endpoint,this.canvasElement=this.endpointRepresentation.canvas,this.jpc=this.ep.connectorSelector();var n=ee(this._shouldStartDrag(),2),i=n[0],o=n[1];if(!1===i)return this._stopped=!0,!1;this.instance.setHover(this.ep,!1),this.instance.isConnectionBeingDragged=!0,this.jpc&&!this.ep.isFull()&&this.ep.isSource&&(this.jpc=null),this._createFloatingEndpoint(this.canvasElement),this._populateTargets(this.canvasElement,e.e),null==this.jpc?this.startNewConnectionDrag(this.ep.scope,o):this.startExistingConnectionDrag(),this._registerFloatingConnection(this.placeholderInfo,this.jpc),this.instance.currentlyDragging=!0}},{key:"onBeforeStart",value:function(e){this.payload=e.e.payload||{}}},{key:"onDrag",value:function(e){if(this._stopped)return!0;if(this.placeholderInfo.element){var t=qe(this.floatingElement,this.instance);this.instance.setElementPosition(this.placeholderInfo.element,e.pos.x,e.pos.y);for(var n,i,o={x:e.pos.x,y:e.pos.y,w:t.w,h:t.h},s=0;s<this.endpointDropTargets.length;s++)if(Si(o,this.endpointDropTargets[s].r)){n=this.endpointDropTargets[s];break}if(n!==this.currentDropTarget&&null!=this.currentDropTarget&&(i=this._getFloatingAnchorIndex(),this.instance.removeClass(this.currentDropTarget.el,no),this.currentDropTarget.endpoint&&(this.currentDropTarget.endpoint.endpoint.removeClass(this.instance.endpointDropAllowedClass),this.currentDropTarget.endpoint.endpoint.removeClass(this.instance.endpointDropForbiddenClass)),this.floatingAnchor.out()),null!=n)if(this.instance.addClass(n.el,no),i=this._getFloatingAnchorIndex(),null!=n.endpoint)if(n.endpoint.isSource&&0===i||n.endpoint.isTarget&&0!==i||this.jpc.suspendedEndpoint&&n.endpoint.referenceEndpoint&&n.endpoint.referenceEndpoint.id===this.jpc.suspendedEndpoint.id)this.instance.checkCondition("checkDropAllowed",{sourceEndpoint:this.jpc.endpoints[i],targetEndpoint:n.endpoint.endpoint,connection:this.jpc})?(n.endpoint.endpoint.addClass(this.instance.endpointDropAllowedClass),n.endpoint.endpoint.removeClass(this.instance.endpointDropForbiddenClass)):(n.endpoint.endpoint.removeClass(this.instance.endpointDropAllowedClass),n.endpoint.endpoint.addClass(this.instance.endpointDropForbiddenClass)),this.floatingAnchor.over(n.endpoint),this.instance._paintConnection(this.jpc);else n=null;this.currentDropTarget=n}}},{key:"_maybeCleanup",value:function(e){e._mtNew&&0===e.connections.length?this.instance.deleteEndpoint(e):delete e._mtNew}},{key:"_reattachOrDiscard",value:function(e){var t=null!=this.jpc.suspendedEndpoint,n=this._getFloatingAnchorIndex();return t&&this._shouldReattach()?(0===n?(this.jpc.source=this.jpc.suspendedElement,this.jpc.sourceId=this.jpc.suspendedElementId):(this.jpc.target=this.jpc.suspendedElement,this.jpc.targetId=this.jpc.suspendedElementId),this._doForceReattach(n),!0):(this._discard(n,e),!1)}},{key:"onStop",value:function(e){var t=this,n=e.e;this.instance.isConnectionBeingDragged=!1,this.instance.currentlyDragging=!1;var i=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.join(" ")}(no,to);if(ve(this.instance.getContainer().querySelectorAll(qo),(function(e){t.instance.removeClass(e,i)})),this.jpc&&null!=this.jpc.endpoints){var o,s=null!=this.jpc.suspendedEndpoint,r=this._getFloatingAnchorIndex(),a=this.jpc.suspendedEndpoint;if(null!=this.currentDropTarget)if(null==(o=this._getDropEndpoint(e,this.jpc)))this._reattachOrDiscard(e.e);else if(a&&a.id===o.id)this._doForceReattach(r);else if(o.enabled)if(o.isFull())o.fire(Et,{endpoint:this,connection:this.jpc,maxConnections:this.instance.defaults.maxConnections},n),this._reattachOrDiscard(e.e);else{0===r?(this.jpc.source=o.element,this.jpc.sourceId=o.elementId):(this.jpc.target=o.element,this.jpc.targetId=o.elementId);var l=!0;s&&this.jpc.suspendedEndpoint.id!==o.id&&(this.jpc.isDetachAllowed(this.jpc)&&this.jpc.endpoints[r].isDetachAllowed(this.jpc)&&this.jpc.suspendedEndpoint.isDetachAllowed(this.jpc)&&this.instance.checkCondition("beforeDetach",this.jpc)||(l=!1)),(l=l&&o.isDropAllowed(this.jpc.sourceId,this.jpc.targetId,this.jpc.scope,this.jpc,o))?this._drop(o,r,n,l):this._reattachOrDiscard(e.e)}else this._reattachOrDiscard(e.e);else this._reattachOrDiscard(e.e);this.instance._refreshEndpoint(this.ep),this.ep.removeClass(this.instance.draggingClass),this._cleanupDraggablePlaceholder(),this.jpc.removeClass(this.instance.draggingClass),delete this.jpc.suspendedEndpoint,delete this.jpc.suspendedElement,delete this.jpc.suspendedElementType,delete this.jpc.suspendedElementId,delete this.jpc.suspendedIndex,delete this.floatingId,delete this.floatingIndex,delete this.floatingElement,delete this.floatingEndpoint,delete this.floatingAnchor,delete this.jpc.pending,null!=o&&this._maybeCleanup(o)}}},{key:"_getSourceDefinition",value:function(e){for(var t,n=this.instance.getContainer(),i=0;i<this.instance.sourceSelectors.length;i++){if((t=this.instance.sourceSelectors[i]).isEnabled())if(!1!==Wo(e,n,t.selector,this.instance,t.exclude))return t}}},{key:"_getDropEndpoint",value:function(e,t){var n;if(null==this.currentDropTarget.endpoint){var i=this.currentDropTarget.def,o=e.e.target||e.e.srcElement;if(null==i)return null;var s=this.currentDropTarget.targetEl,r=mr(e.e,s,this.instance.currentZoom),a=this.instance._deriveEndpointAndAnchorSpec(t.getType().join(" "),!0),l=a.endpoints?se(e,{endpoint:i.def.endpoint||a.endpoints[1],cssClass:i.def.cssClass||"",source:!0===i.def.source,target:!0===i.def.target}):e,c=this.instance.validAnchorsSpec(a.anchors)?a.anchors:this.instance.areDefaultAnchorsSet()?this.instance.defaults.anchors:null,u=i.def.anchor,h=i.def.anchorPositionFinder?i.def.anchorPositionFinder(s,r,i.def,e.e):null,d=null!=h?h:null!=u?u:null!=c&&null!=c[1]?c[1]:null;if(null!=d&&(l=se(l,{anchor:d})),null!=i.def.portId&&(l.portId=i.def.portId),(l=de(l,i.def.parameterExtractor?i.def.parameterExtractor(this.currentDropTarget.el,o,e.e):{})).element=s,(n=this.instance._internal_newEndpoint(l))._mtNew=!0,n.deleteOnEmpty=!0,i.def.parameters&&n.mergeParameters(i.def.parameters),i.def.extract){var p={};for(var f in i.def.extract){var v=this.currentDropTarget.el.getAttribute(f);v&&(p[i.def.extract[f]]=v)}n.mergeParameters(p)}}else n=this.currentDropTarget.endpoint;return n&&(n.removeClass(this.instance.endpointDropAllowedClass),n.removeClass(this.instance.endpointDropForbiddenClass)),n}},{key:"_doForceReattach",value:function(e){this.floatingEndpoint.detachFromConnection(this.jpc,null,!0),this.jpc.endpoints[e]=this.jpc.suspendedEndpoint,this.instance.setHover(this.jpc,!1),this.jpc._forceDetach=!0,this.jpc.suspendedEndpoint.addConnection(this.jpc),this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.suspendedEndpoint.elementId,this.jpc,this.jpc.suspendedEndpoint.element,e),this.instance.deleteEndpoint(this.floatingEndpoint),this.instance.repaint(this.jpc.source),delete this.jpc._forceDetach}},{key:"_shouldReattach",value:function(){if(this.jpc.isReattach()||this.jpc._forceReattach)return!0;var e=this.jpc.suspendedEndpoint,t=this.jpc.suspendedElementType==Qe?1:0,n=this.jpc.endpoints[t];return!pe(!0,!1,[[e,wt,[this.jpc]],[n,wt,[this.jpc]],[this.jpc,wt,[this.jpc]],[this.instance,ut,[Mt,this.jpc]]])}},{key:"_discard",value:function(e,t){this.jpc.pending?this.instance.fire("connection:abort",this.jpc,t):(0===e?(this.jpc.source=this.jpc.suspendedEndpoint.element,this.jpc.sourceId=this.jpc.suspendedEndpoint.elementId):(this.jpc.target=this.jpc.suspendedEndpoint.element,this.jpc.targetId=this.jpc.suspendedEndpoint.elementId),this.jpc.endpoints[e]=this.jpc.suspendedEndpoint),this.floatingEndpoint&&this.floatingEndpoint.detachFromConnection(this.jpc),this.instance.deleteConnection(this.jpc,{originalEvent:t,force:!0})}},{key:"_drop",value:function(e,t,n,i){if(this.jpc.endpoints[t].detachFromConnection(this.jpc),this.jpc.suspendedEndpoint&&this.jpc.suspendedEndpoint.detachFromConnection(this.jpc),this.jpc.endpoints[t]=e,e.addConnection(this.jpc),this.jpc.suspendedEndpoint){var o=this.jpc.suspendedEndpoint.elementId;this.instance.fireMoveEvent({index:t,originalSourceId:0===t?o:this.jpc.sourceId,newSourceId:0===t?e.elementId:this.jpc.sourceId,originalTargetId:1===t?o:this.jpc.targetId,newTargetId:1===t?e.elementId:this.jpc.targetId,originalEndpoint:this.jpc.suspendedEndpoint,connection:this.jpc,newEndpoint:e},n)}(1===t?this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.targetId,this.jpc,this.jpc.target,1):this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.sourceId,this.jpc,this.jpc.source,0),this.jpc.endpoints[0].finalEndpoint)&&(this.jpc.endpoints[0].detachFromConnection(this.jpc),this.jpc.endpoints[0]=this.jpc.endpoints[0].finalEndpoint,this.jpc.endpoints[0].addConnection(this.jpc));ce(i)&&this.jpc.mergeData(i),this._originalAnchorSpec&&(this.jpc.endpoints[0].setAnchor(this._originalAnchorSpec),this._originalAnchorSpec=null),this.instance._finaliseConnection(this.jpc,null,n),this.instance.setHover(this.jpc,!1),this.instance.revalidate(this.jpc.endpoints[0].element)}},{key:"_registerFloatingConnection",value:function(e,t){this.floatingConnections[e.id]=t}},{key:"_getFloatingAnchorIndex",value:function(){return null==this.floatingIndex?1:this.floatingIndex}}]),e}(),Ko=function(e){X(n,e);var t=K(n);function n(e,i){var o;return V(this,n),(o=t.call(this,e,i)).instance=e,o.dragSelection=i,Y(Z(o),"selector",[">",Rn,Dt].join(" ")),Y(Z(o),"doRevalidate",void 0),o.doRevalidate=o._revalidate.bind(Z(o)),o}return U(n,[{key:"reset",value:function(){this.drag.off(an,this.doRevalidate)}},{key:"_revalidate",value:function(e){this.instance.revalidate(e)}},{key:"init",value:function(e){this.drag=e,e.on(an,this.doRevalidate)}},{key:"useGhostProxy",value:function(e,t){var n=t._jsPlumbParentGroup;return null!=n&&!0===n.ghost}},{key:"makeGhostProxy",value:function(e){var t=e,n=t.cloneNode(!0);return n._jsPlumbParentGroup=t._jsPlumbParentGroup,n}}]),n}(co),Qo=function(){function e(t,n){V(this,e),this.instance=t,this.overlay=n,Y(this,"htmlElementOverlay",void 0),this.htmlElementOverlay=n}return U(e,null,[{key:"getElement",value:function(e,t,n){if(null==e.canvas){if(n&&t){e.canvas=n(t);var i=e.instance.overlayClass+" "+(e.cssClass?e.cssClass:"");e.instance.addClass(e.canvas,i)}else e.canvas=Ue("div",{},e.instance.overlayClass+" "+(e.cssClass?e.cssClass:""));for(var o in e.instance.setAttribute(e.canvas,"jtk-overlay-id",e.id),e.attributes)e.instance.setAttribute(e.canvas,o,e.attributes[o]);e.canvas.style.position=it,e.instance._appendElement(e.canvas,e.instance.getContainer()),e.instance.getId(e.canvas);var s="translate(-50%, -50%)";e.canvas.style.webkitTransform=s,e.canvas.style.mozTransform=s,e.canvas.style.msTransform=s,e.canvas.style.oTransform=s,e.canvas.style.transform=s,e.isVisible()||(e.canvas.style.display=nt),e.canvas.jtk={overlay:e}}return e.canvas}},{key:"destroy",value:function(e){e.canvas&&e.canvas.parentNode&&e.canvas.parentNode.removeChild(e.canvas),delete e.canvas,delete e.cachedDimensions}},{key:"_getDimensions",value:function(e,t){return(null==e.cachedDimensions||t)&&(e.cachedDimensions={w:1,h:1}),e.cachedDimensions}}]),e}(),es=function(){function e(){V(this,e),Y(this,"_listeners",{}),Y(this,"eventsSuspended",!1),Y(this,"tick",!1),Y(this,"eventsToDieOn",{ready:!0}),Y(this,"queue",[])}return U(e,[{key:"fire",value:function(e,t,n){var i=null;if(this.tick)this.queue.unshift(arguments);else{if(this.tick=!0,!this.eventsSuspended&&this._listeners[e]){var o=this._listeners[e].length,s=0,r=!1;if(!this.shouldFireEvent||this.shouldFireEvent(e,t,n))for(;!r&&s<o&&!1!==i;){if(this.eventsToDieOn[e])this._listeners[e][s](t,n);else try{i=this._listeners[e][s](t,n)}catch(t){Te("jsPlumb: fire failed for event "+e+" : "+(t.message||t))}s++,null!=this._listeners&&null!=this._listeners[e]||(r=!0)}}this.tick=!1,this._drain()}return i}},{key:"_drain",value:function(){var e=this.queue.pop();e&&this.fire.apply(this,e)}},{key:"unbind",value:function(e,t){if(0===arguments.length)this._listeners={};else if(1===arguments.length){if("string"==typeof e)delete this._listeners[e];else if(e.__jsPlumb){var n;for(var i in e.__jsPlumb)n=e.__jsPlumb[i],be(this._listeners[n]||[],e)}}else 2===arguments.length&&be(this._listeners[e]||[],t);return this}},{key:"getListener",value:function(e){return this._listeners[e]||[]}},{key:"isSuspendEvents",value:function(){return this.eventsSuspended}},{key:"setSuspendEvents",value:function(e){this.eventsSuspended=e}},{key:"bind",value:function(e,t,n){var i=this,o=function(e){ke(i._listeners,e,t,n),t.__jsPlumb=t.__jsPlumb||{},t.__jsPlumb[we()]=e};if("string"==typeof e)o(e);else if(null!=e.length)for(var s=0;s<e.length;s++)o(e[s]);return this}},{key:"silently",value:function(e){this.setSuspendEvents(!0);try{e()}catch(e){Te("Cannot execute silent function "+e)}this.setSuspendEvents(!1)}}]),e}();function ts(e){var t=null;return(t=ae(e)?{type:e,options:{}}:e).options.id=t.options.id||we(),t}!function(e){X(n,e);var t=K(n);function n(){return V(this,n),t.apply(this,arguments)}U(n,[{key:"shouldFireEvent",value:function(e,t,n){return!0}}])}(es);var ns=function(e){X(n,e);var t=K(n);function n(e,i,o){var s;for(var r in V(this,n),(s=t.call(this)).instance=e,s.component=i,Y(Z(s),"id",void 0),Y(Z(s),"type",void 0),Y(Z(s),"cssClass",void 0),Y(Z(s),"visible",!0),Y(Z(s),"location",void 0),Y(Z(s),"events",void 0),Y(Z(s),"attributes",void 0),o=o||{},s.id=o.id||we(),s.cssClass=o.cssClass||"",s.setLocation(o.location),s.events=o.events||{},s.attributes=o.attributes||{},s.events)s.bind(r,s.events[r]);return s}return U(n,[{key:"setLocation",value:function(e){var t=null==this.location?.5:this.location;if(null!=e)try{var n="string"==typeof e?parseFloat(e):e;isNaN(n)||(t=n)}catch(e){}this.location=t}},{key:"shouldFireEvent",value:function(e,t,n){return!0}},{key:"setVisible",value:function(e){this.visible=e,this.instance.setOverlayVisible(this,e)}},{key:"isVisible",value:function(){return this.visible}}]),n}(es),is={},os=function(e,t,n,i){var o=is[t];if(o)return new o(e,n,i);throw{message:"jsPlumb: unknown overlay type '"+t+"'"}},ss=function(e,t){is[e]=t},rs=function(e){X(n,e);var t=K(n);function n(e,i,o){var s;return V(this,n),(s=t.call(this,e,i,o)).instance=e,s.component=i,Y(Z(s),"label",void 0),Y(Z(s),"labelText",void 0),Y(Z(s),"type",n.type),Y(Z(s),"cachedDimensions",void 0),o=o||{label:""},s.setLabel(o.label),s}return U(n,[{key:"getLabel",value:function(){return ue(this.label)?this.label(this):this.labelText}},{key:"setLabel",value:function(e){this.label=e,this.labelText=null,this.instance.updateLabel(this)}},{key:"getDimensions",value:function(){return{w:1,h:1}}},{key:"updateFrom",value:function(e){null!=e.label&&this.setLabel(e.label),null!=e.location&&(this.setLocation(e.location),this.instance.updateLabel(this))}}]),n}(ns);function as(e){return e.type===rs.type}function ls(e){return null==e?null:e.split(" ").filter((function(e){return null!=e&&e.length>0}))}function cs(e,t,n){for(var i in t)e[i]=n}Y(rs,"type","Label"),ss(rs.type,rs);var us="__default",hs="__label",ds="overlay",ps="remove";function fs(e,t){if(e.getDefaultType){var n=e.getTypeDescriptor(),i={},o=e.getDefaultType(),s=se({},o);cs(i,o,us),e._types.forEach((function(t){if(t!==us){var o=e.instance.getType(t,n);if(null!=o){var r=new Set(["connector","anchor","anchors"]);if("override"===o.mergeStrategy)for(var a in o)r.add(a);s=de(s,o,["cssClass"],(l=[],r.forEach((function(e){l.push(e)})),l)),cs(i,o,t)}}var l})),t&&(s=fe(s,t,"_")),e.applyType(s,i)}}function vs(e,t){var n=e.instance.getType(t,e.getTypeDescriptor());null!=n&&n.cssClass&&e.removeClass(n.cssClass)}function gs(e){if(e.paintStyle&&e.hoverPaintStyle){var t={};se(t,e.paintStyle),se(t,e.hoverPaintStyle),e.hoverPaintStyle=t}}var ys=function(e){X(n,e);var t=K(n);function n(e,i){var o;if(V(this,n),(o=t.call(this)).instance=e,Y(Z(o),"defaultLabelLocation",.5),Y(Z(o),"overlays",{}),Y(Z(o),"overlayPositions",{}),Y(Z(o),"overlayPlacements",{}),Y(Z(o),"clone",void 0),Y(Z(o),"deleted",void 0),Y(Z(o),"segment",void 0),Y(Z(o),"x",void 0),Y(Z(o),"y",void 0),Y(Z(o),"w",void 0),Y(Z(o),"h",void 0),Y(Z(o),"id",void 0),Y(Z(o),"visible",!0),Y(Z(o),"typeId",void 0),Y(Z(o),"params",{}),Y(Z(o),"paintStyle",void 0),Y(Z(o),"hoverPaintStyle",void 0),Y(Z(o),"paintStyleInUse",void 0),Y(Z(o),"_hover",!1),Y(Z(o),"lastPaintedAt",void 0),Y(Z(o),"data",void 0),Y(Z(o),"_defaultType",void 0),Y(Z(o),"events",void 0),Y(Z(o),"parameters",void 0),Y(Z(o),"_types",void 0),Y(Z(o),"_typeCache",void 0),Y(Z(o),"cssClass",void 0),Y(Z(o),"hoverClass",void 0),Y(Z(o),"beforeDetach",void 0),Y(Z(o),"beforeDrop",void 0),i=i||{},o.cssClass=i.cssClass||"",o.hoverClass=i.hoverClass||e.defaults.hoverClass,o.beforeDetach=i.beforeDetach,o.beforeDrop=i.beforeDrop,o._types=new Set,o._typeCache={},o.parameters=he(i.parameters||{}),o.id=i.id||o.getIdPrefix()+(new Date).getTime(),o._defaultType={parameters:o.parameters,scope:i.scope||o.instance.defaultScope,overlays:{}},i.events)for(var s in i.events)o.bind(s,i.events[s]);o.clone=function(){var t=Object.create(o.constructor.prototype);return o.constructor.apply(t,[e,i]),t},o.overlays={},o.overlayPositions={};var r=i.overlays||[],a={},l=o.getDefaultOverlayKey();if(l){var c=o.instance.defaults[l];c&&r.push.apply(r,te(c));for(var u=0;u<r.length;u++){var h=ts(r[u]);a[h.options.id]=h}}return o._defaultType.overlays=a,i.label&&(o.getDefaultType().overlays.__label={type:rs.type,options:{label:i.label,location:i.labelLocation||o.defaultLabelLocation,id:hs,cssClass:"jtk-default-label"}}),o}return U(n,[{key:"isDetachAllowed",value:function(e){var t=!0;if(this.beforeDetach)try{t=this.beforeDetach(e)}catch(e){Te("jsPlumb: beforeDetach callback failed",e)}return t}},{key:"isDropAllowed",value:function(e,t,n,i,o){var s,r={sourceId:e,targetId:t,scope:n,connection:i,dropEndpoint:o};if(this.beforeDrop)try{s=this.beforeDrop(r)}catch(e){Te("jsPlumb: beforeDrop callback failed",e)}else s=this.instance.checkCondition(At,r);return s}},{key:"getDefaultType",value:function(){return this._defaultType}},{key:"appendToDefaultType",value:function(e){for(var t in e)this._defaultType[t]=e[t]}},{key:"getId",value:function(){return this.id}},{key:"cacheTypeItem",value:function(e,t,n){this._typeCache[n]=this._typeCache[n]||{},this._typeCache[n][e]=t}},{key:"getCachedTypeItem",value:function(e,t){return this._typeCache[t]?this._typeCache[t][e]:null}},{key:"setType",value:function(e,t){this.clearTypes(),(ls(e)||[]).forEach(this._types.add,this._types),fs(this,t)}},{key:"getType",value:function(){return Array.from(this._types.keys())}},{key:"reapplyTypes",value:function(e){fs(this,e)}},{key:"hasType",value:function(e){return this._types.has(e)}},{key:"addType",value:function(e,t){var n=ls(e),i=!1;if(null!=n){for(var o=0,s=n.length;o<s;o++)this._types.has(n[o])||(this._types.add(n[o]),i=!0);i&&fs(this,t)}}},{key:"removeType",value:function(e,t){var n,i=this,o=ls(e),s=!1;if(null!=o){for(var r=0,a=o.length;r<a;r++)n=o[r],s=!!i._types.has(n)&&(vs(i,n),i._types.delete(n),!0)||s;s&&fs(this,t)}}},{key:"clearTypes",value:function(e){var t=this;this._types.forEach((function(e){vs(t,e)})),this._types.clear(),fs(this,e)}},{key:"toggleType",value:function(e,t){var n=ls(e);if(null!=n){for(var i=0,o=n.length;i<o;i++)this._types.has(n[i])?(vs(this,n[i]),this._types.delete(n[i])):this._types.add(n[i]);fs(this,t)}}},{key:"applyType",value:function(e,t){if(this.setPaintStyle(e.paintStyle),this.setHoverPaintStyle(e.hoverPaintStyle),this.mergeParameters(e.parameters),this.paintStyleInUse=this.getPaintStyle(),e.overlays){var n,i={};for(n in e.overlays){var o=this.overlays[e.overlays[n].options.id];if(o)o.updateFrom(e.overlays[n].options),i[e.overlays[n].options.id]=!0,this.instance.reattachOverlay(o,this);else{var s=this.getCachedTypeItem(ds,e.overlays[n].options.id);null!=s?(this.instance.reattachOverlay(s,this),s.setVisible(!0),s.updateFrom(e.overlays[n].options),this.overlays[s.id]=s):s=this.addOverlay(e.overlays[n]),i[s.id]=!0}}for(n in this.overlays)null==i[this.overlays[n].id]&&this.removeOverlay(this.overlays[n].id,!0)}}},{key:"setPaintStyle",value:function(e){this.paintStyle=e,this.paintStyleInUse=this.paintStyle,gs(this)}},{key:"getPaintStyle",value:function(){return this.paintStyle}},{key:"setHoverPaintStyle",value:function(e){this.hoverPaintStyle=e,gs(this)}},{key:"getHoverPaintStyle",value:function(){return this.hoverPaintStyle}},{key:"destroy",value:function(){for(var e in this.overlays)this.instance.destroyOverlay(this.overlays[e]);this.overlays={},this.overlayPositions={},this.unbind(),this.clone=null}},{key:"isHover",value:function(){return this._hover}},{key:"mergeParameters",value:function(e){null!=e&&se(this.parameters,e)}},{key:"setVisible",value:function(e){this.visible=e,e?this.showOverlays():this.hideOverlays()}},{key:"isVisible",value:function(){return this.visible}},{key:"setAbsoluteOverlayPosition",value:function(e,t){this.overlayPositions[e.id]=t}},{key:"getAbsoluteOverlayPosition",value:function(e){return this.overlayPositions?this.overlayPositions[e.id]:null}},{key:"_clazzManip",value:function(e,t){for(var n in this.overlays)"add"===e?this.instance.addOverlayClass(this.overlays[n],t):e===ps&&this.instance.removeOverlayClass(this.overlays[n],t)}},{key:"addClass",value:function(e,t){var n=(this.cssClass||"").split(" ");n.push(e),this.cssClass=n.join(" "),this._clazzManip("add",e)}},{key:"removeClass",value:function(e,t){var n=(this.cssClass||"").split(" ");this.cssClass=n.filter((function(t){return t!==e})).join(" "),this._clazzManip(ps,e)}},{key:"getClass",value:function(){return this.cssClass}},{key:"shouldFireEvent",value:function(e,t,n){return!0}},{key:"getData",value:function(){return this.data}},{key:"setData",value:function(e){this.data=e||{}}},{key:"mergeData",value:function(e){this.data=se(this.data,e)}},{key:"addOverlay",value:function(e){var t=function(e,t){var n=null;if(ae(t))n=os(e.instance,t,e,{});else if(null!=t.type&&null!=t.options){var i=t,o=se({},i.options);n=os(e.instance,i.type,e,o)}else n=t;return n.id=n.id||we(),e.cacheTypeItem(ds,n,n.id),e.overlays[n.id]=n,n}(this,e);if(this.getData&&t.type===rs.type&&!ae(e)){var n=this.getData(),i=e.options;if(n){var o=n[i.labelLocationAttribute||"labelLocation"];o&&(t.location=o)}}return t}},{key:"getOverlay",value:function(e){return this.overlays[e]}},{key:"getOverlays",value:function(){return this.overlays}},{key:"hideOverlay",value:function(e){var t=this.getOverlay(e);t&&t.setVisible(!1)}},{key:"hideOverlays",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var i in t=t||[],this.overlays)0!==t.length&&-1===t.indexOf(i)||this.overlays[i].setVisible(!1)}},{key:"showOverlay",value:function(e){var t=this.getOverlay(e);t&&t.setVisible(!0)}},{key:"showOverlays",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var i in t=t||[],this.overlays)0!==t.length&&-1===t.indexOf(i)||this.overlays[i].setVisible(!0)}},{key:"removeAllOverlays",value:function(){for(var e in this.overlays)this.instance.destroyOverlay(this.overlays[e]);this.overlays={},this.overlayPositions=null,this.overlayPlacements={}}},{key:"removeOverlay",value:function(e,t){var n=this.overlays[e];n&&(n.setVisible(!1),t||this.instance.destroyOverlay(n),delete this.overlays[e],this.overlayPositions&&delete this.overlayPositions[e],this.overlayPlacements&&delete this.overlayPlacements[e])}},{key:"removeOverlays",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var i=0,o=t.length;i<o;i++)this.removeOverlay(arguments[i])}},{key:"getLabel",value:function(){var e=this.getLabelOverlay();return null!=e?e.getLabel():null}},{key:"getLabelOverlay",value:function(){return this.getOverlay(hs)}},{key:"setLabel",value:function(e){var t,n,i,o=this.getLabelOverlay();if(o)if(ae(e)||ue(e))o.setLabel(e);else{var s=e;s.label&&o.setLabel(s.label),s.location&&(o.location=s.location)}else{var r=ae(e)||ue(e)?{label:e}:e;t=this,i=se({cssClass:(n=r).cssClass,id:hs,component:t},n),o=new rs(t.instance,t,i),this.overlays.__label=o}}}]),n}(es),ms=["connectorStyle","connectorHoverStyle","connectorOverlays","connector","connectionType","connectorClass","connectorHoverClass"],_s=function(e){X(n,e);var t=K(n);function n(e,i){var o;V(this,n),(o=t.call(this,e,i)).instance=e,Y(Z(o),"connections",[]),Y(Z(o),"endpoint",void 0),Y(Z(o),"element",void 0),Y(Z(o),"elementId",void 0),Y(Z(o),"dragAllowedWhenFull",!0),Y(Z(o),"timestamp",void 0),Y(Z(o),"portId",void 0),Y(Z(o),"maxConnections",void 0),Y(Z(o),"proxiedBy",void 0),Y(Z(o),"connectorClass",void 0),Y(Z(o),"connectorHoverClass",void 0),Y(Z(o),"finalEndpoint",void 0),Y(Z(o),"enabled",!0),Y(Z(o),"isSource",void 0),Y(Z(o),"isTarget",void 0),Y(Z(o),"isTemporarySource",void 0),Y(Z(o),"connectionCost",1),Y(Z(o),"connectionsDirected",void 0),Y(Z(o),"connectionsDetachable",void 0),Y(Z(o),"reattachConnections",void 0),Y(Z(o),"currentAnchorClass",void 0),Y(Z(o),"referenceEndpoint",void 0),Y(Z(o),"edgeType",void 0),Y(Z(o),"connector",void 0),Y(Z(o),"connectorOverlays",void 0),Y(Z(o),"connectorStyle",void 0),Y(Z(o),"connectorHoverStyle",void 0),Y(Z(o),"deleteOnEmpty",void 0),Y(Z(o),"uuid",void 0),Y(Z(o),"scope",void 0),Y(Z(o),"_anchor",void 0),Y(Z(o),"defaultLabelLocation",[.5,.5]),o.appendToDefaultType({edgeType:i.edgeType,maxConnections:null==i.maxConnections?o.instance.defaults.maxConnections:i.maxConnections,paintStyle:i.paintStyle||o.instance.defaults.endpointStyle,hoverPaintStyle:i.hoverPaintStyle||o.instance.defaults.endpointHoverStyle,connectorStyle:i.connectorStyle,connectorHoverStyle:i.connectorHoverStyle,connectorClass:i.connectorClass,connectorHoverClass:i.connectorHoverClass,connectorOverlays:i.connectorOverlays,connector:i.connector}),o.enabled=!(!1===i.enabled),o.visible=!0,o.element=i.element,o.uuid=i.uuid,o.portId=i.portId,o.elementId=i.elementId,o.connectionCost=null==i.connectionCost?1:i.connectionCost,o.connectionsDirected=i.connectionsDirected,o.currentAnchorClass="",o.events={},o.connectorOverlays=i.connectorOverlays,o.connectorStyle=i.connectorStyle,o.connectorHoverStyle=i.connectorHoverStyle,o.connector=i.connector,o.edgeType=i.edgeType,o.connectorClass=i.connectorClass,o.connectorHoverClass=i.connectorHoverClass,o.deleteOnEmpty=!0===i.deleteOnEmpty,o.isSource=i.source||!1,o.isTemporarySource=i.isTemporarySource||!1,o.isTarget=i.target||!1,o.connections=i.connections||[],o.scope=i.scope||e.defaultScope,o.timestamp=null,o.reattachConnections=i.reattachConnections||e.defaults.reattachConnections,o.connectionsDetachable=e.defaults.connectionsDetachable,!1===i.connectionsDetachable&&(o.connectionsDetachable=!1),o.dragAllowedWhenFull=!1!==i.dragAllowedWhenFull,i.onMaxConnections&&o.bind(Et,i.onMaxConnections);var s=i.endpoint||i.existingEndpoint||e.defaults.endpoint;if(o.setEndpoint(s),null!=i.preparedAnchor)o.setPreparedAnchor(i.preparedAnchor);else{var r=i.anchor?i.anchor:i.anchors?i.anchors:e.defaults.anchor||Pn.Top;o.setAnchor(r)}var a=[Yn,i.type||""].join(" ");return o.addType(a,i.data),o}return U(n,[{key:"getIdPrefix",value:function(){return"_jsplumb_e"}},{key:"getTypeDescriptor",value:function(){return"endpoint"}},{key:"getXY",value:function(){return{x:this.endpoint.x,y:this.endpoint.y}}},{key:"getDefaultOverlayKey",value:function(){return"endpointOverlays"}},{key:"_updateAnchorClass",value:function(){var e=this._anchor&&this._anchor.cssClass;if(null!=e&&e.length>0){var t=this.instance.endpointAnchorClassPrefix+"-"+this.currentAnchorClass;this.currentAnchorClass=e;var n=this.instance.endpointAnchorClassPrefix+(this.currentAnchorClass?"-"+this.currentAnchorClass:"");t!==n&&(this.removeClass(t),this.addClass(n),this.instance.removeClass(this.element,t),this.instance.addClass(this.element,n))}}},{key:"setPreparedAnchor",value:function(e){return this.instance.router.setAnchor(this,e),this._updateAnchorClass(),this}},{key:"_anchorLocationChanged",value:function(e){this.fire("anchor:changed",{endpoint:this,anchor:e}),this._updateAnchorClass()}},{key:"setAnchor",value:function(e){var t=this.instance.router.prepareAnchor(e);return this.setPreparedAnchor(t),this}},{key:"addConnection",value:function(e){this.connections.push(e),this.instance._refreshEndpoint(this)}},{key:"detachFromConnection",value:function(e,t,n){(t=null==t?this.connections.indexOf(e):t)>=0&&(this.connections.splice(t,1),this.instance._refreshEndpoint(this)),!n&&this.deleteOnEmpty&&0===this.connections.length&&this.instance.deleteEndpoint(this)}},{key:"deleteEveryConnection",value:function(e){for(var t=this.connections.length,n=0;n<t;n++)this.instance.deleteConnection(this.connections[0],e)}},{key:"detachFrom",value:function(e){for(var t=[],n=0;n<this.connections.length;n++)this.connections[n].endpoints[1]!==e&&this.connections[n].endpoints[0]!==e||t.push(this.connections[n]);for(var i=0,o=t.length;i<o;i++)this.instance.deleteConnection(t[0]);return this}},{key:"setVisible",value:function(e,t,i){if(Q(W(n.prototype),"setVisible",this).call(this,e),this.endpoint.setVisible(e),e?this.showOverlays():this.hideOverlays(),!t)for(var o=0;o<this.connections.length;o++)if(this.connections[o].setVisible(e),!i){var s=this===this.connections[o].endpoints[0]?1:0;1===this.connections[o].endpoints[s].connections.length&&this.connections[o].endpoints[s].setVisible(e,!0,!0)}}},{key:"applyType",value:function(e,t){Q(W(n.prototype),"applyType",this).call(this,e,t),this.setPaintStyle(e.endpointStyle||e.paintStyle),this.setHoverPaintStyle(e.endpointHoverStyle||e.hoverPaintStyle),this.connectorStyle=e.connectorStyle,this.connectorHoverStyle=e.connectorHoverStyle,this.connector=e.connector,this.connectorOverlays=e.connectorOverlays,this.edgeType=e.edgeType,null!=e.maxConnections&&(this.maxConnections=e.maxConnections),e.scope&&(this.scope=e.scope),se(e,ms),this.instance.applyEndpointType(this,e)}},{key:"destroy",value:function(){Q(W(n.prototype),"destroy",this).call(this),this.deleted=!0,null!=this.endpoint&&this.instance.destroyEndpoint(this)}},{key:"isFull",value:function(){return 0===this.maxConnections||!(this.isFloating()||this.maxConnections<0||this.connections.length<this.maxConnections)}},{key:"isFloating",value:function(){return this.instance.router.isFloating(this)}},{key:"isConnectedTo",value:function(e){var t=!1;if(e)for(var n=0;n<this.connections.length;n++)if(this.connections[n].endpoints[1]===e||this.connections[n].endpoints[0]===e){t=!0;break}return t}},{key:"setDragAllowedWhenFull",value:function(e){this.dragAllowedWhenFull=e}},{key:"getUuid",value:function(){return this.uuid}},{key:"connectorSelector",value:function(){return this.connections[0]}},{key:"prepareEndpoint",value:function(e,t){var n,i={cssClass:this.cssClass,endpoint:this};if(Ge(e,vo)){var o=e;(n=fo.clone(o)).classes=i.cssClass.split(" ")}else if(ae(e))n=fo.get(this,e,i);else{var s=e;se(i,s.options||{}),n=fo.get(this,s.type,i)}return n.typeId=t,n}},{key:"setEndpoint",value:function(e){var t=this.prepareEndpoint(e);this.setPreparedEndpoint(t)}},{key:"setPreparedEndpoint",value:function(e){null!=this.endpoint&&this.instance.destroyEndpoint(this),this.endpoint=e}},{key:"addClass",value:function(e,t){Q(W(n.prototype),"addClass",this).call(this,e,t),null!=this.endpoint&&this.endpoint.addClass(e)}},{key:"removeClass",value:function(e,t){Q(W(n.prototype),"removeClass",this).call(this,e,t),null!=this.endpoint&&this.endpoint.removeClass(e)}}]),n}(ys),xs="anchors",bs="connector";function ks(e,t,n,i,o,s,r){var a;if(t)e.endpoints[n]=t,t.addConnection(e);else{var l=r||e.endpointSpec||e.endpointsSpec[n]||e.instance.defaults.endpoints[n]||e.instance.defaults.endpoint,c=e.endpointStyles[n]||e.endpointStyle||e.instance.defaults.endpointStyles[n]||e.instance.defaults.endpointStyle;null==c.fill&&null!=e.paintStyle&&(c.fill=e.paintStyle.stroke),null==c.outlineStroke&&null!=e.paintStyle&&(c.outlineStroke=e.paintStyle.outlineStroke),null==c.outlineWidth&&null!=e.paintStyle&&(c.outlineWidth=e.paintStyle.outlineWidth);var u=e.endpointHoverStyles[n]||e.endpointHoverStyle||e.endpointHoverStyle||e.instance.defaults.endpointHoverStyles[n]||e.instance.defaults.endpointHoverStyle;null!=e.hoverPaintStyle&&(null==u&&(u={}),null==u.fill&&(u.fill=e.hoverPaintStyle.stroke));var h=e.uuids?e.uuids[n]:null;i=null!=i?i:null!=e.instance.defaults.anchors?e.instance.defaults.anchors[n]:e.instance.defaults.anchor,a=e.instance._internal_newEndpoint({paintStyle:c,hoverPaintStyle:u,endpoint:l,connections:[e],uuid:h,element:o,scope:e.scope,anchor:i,reattachConnections:e.reattach||e.instance.defaults.reattachConnections,connectionsDetachable:e.detachable||e.instance.defaults.connectionsDetachable}),e.instance._refreshEndpoint(a),null==t&&(a.deleteOnEmpty=!0),e.endpoints[n]=a}return a}var Cs=function(e){X(n,e);var t=K(n);function n(e,i){var o;V(this,n),(o=t.call(this,e,i)).instance=e,Y(Z(o),"connector",void 0),Y(Z(o),"defaultLabelLocation",.5),Y(Z(o),"scope",void 0),Y(Z(o),"typeId","_jsplumb_connection"),Y(Z(o),"previousConnection",void 0),Y(Z(o),"sourceId",void 0),Y(Z(o),"targetId",void 0),Y(Z(o),"source",void 0),Y(Z(o),"target",void 0),Y(Z(o),"detachable",!0),Y(Z(o),"reattach",!1),Y(Z(o),"uuids",void 0),Y(Z(o),"cost",1),Y(Z(o),"directed",void 0),Y(Z(o),"endpoints",[null,null]),Y(Z(o),"endpointStyles",void 0),Y(Z(o),"endpointSpec",void 0),Y(Z(o),"endpointsSpec",void 0),Y(Z(o),"endpointStyle",{}),Y(Z(o),"endpointHoverStyle",{}),Y(Z(o),"endpointHoverStyles",void 0),Y(Z(o),"suspendedEndpoint",void 0),Y(Z(o),"suspendedIndex",void 0),Y(Z(o),"suspendedElement",void 0),Y(Z(o),"suspendedElementId",void 0),Y(Z(o),"suspendedElementType",void 0),Y(Z(o),"_forceReattach",void 0),Y(Z(o),"_forceDetach",void 0),Y(Z(o),"proxies",[]),Y(Z(o),"pending",!1),o.id=i.id,o.previousConnection=i.previousConnection,o.source=i.source,o.target=i.target,i.sourceEndpoint?(o.source=i.sourceEndpoint.element,o.sourceId=i.sourceEndpoint.elementId):o.sourceId=e.getId(o.source),i.targetEndpoint?(o.target=i.targetEndpoint.element,o.targetId=i.targetEndpoint.elementId):o.targetId=e.getId(o.target),o.scope=i.scope;var s=i.anchors?i.anchors[0]:i.anchor,r=i.anchors?i.anchors[1]:i.anchor;e.manage(o.source),e.manage(o.target),o.visible=!0,o.params={cssClass:i.cssClass,hoverClass:i.hoverClass,"pointer-events":i["pointer-events"],overlays:i.overlays},o.lastPaintedAt=null,i.type&&(i.endpoints=i.endpoints||o.instance._deriveEndpointAndAnchorSpec(i.type).endpoints),o.endpointSpec=i.endpoint,o.endpointsSpec=i.endpoints||[null,null],o.endpointStyle=i.endpointStyle,o.endpointHoverStyle=i.endpointHoverStyle,o.endpointStyles=i.endpointStyles||[null,null],o.endpointHoverStyles=i.endpointHoverStyles||[null,null],o.paintStyle=i.paintStyle,o.hoverPaintStyle=i.hoverPaintStyle,o.uuids=i.uuids,o.makeEndpoint(!0,o.source,o.sourceId,s,i.sourceEndpoint),o.makeEndpoint(!1,o.target,o.targetId,r,i.targetEndpoint),o.scope||(o.scope=o.endpoints[0].scope),null!=i.deleteEndpointsOnEmpty&&(o.endpoints[0].deleteOnEmpty=i.deleteEndpointsOnEmpty,o.endpoints[1].deleteOnEmpty=i.deleteEndpointsOnEmpty);var a=o.instance.defaults.connectionsDetachable;!1===i.detachable&&(a=!1),!1===o.endpoints[0].connectionsDetachable&&(a=!1),!1===o.endpoints[1].connectionsDetachable&&(a=!1),o.endpointsSpec=i.endpoints||[null,null],o.endpointSpec=i.endpoint||null;var l=i.reattach||o.endpoints[0].reattachConnections||o.endpoints[1].reattachConnections||o.instance.defaults.reattachConnections,c=se({},o.endpoints[0].connectorStyle||o.endpoints[1].connectorStyle||i.paintStyle||o.instance.defaults.paintStyle);if(o.appendToDefaultType({detachable:a,reattach:l,paintStyle:c,hoverPaintStyle:se({},o.endpoints[0].connectorHoverStyle||o.endpoints[1].connectorHoverStyle||i.hoverPaintStyle||o.instance.defaults.hoverPaintStyle)}),i.outlineWidth&&(c.outlineWidth=i.outlineWidth),i.outlineColor&&(c.outlineStroke=i.outlineColor),i.lineWidth&&(c.strokeWidth=i.lineWidth),i.color&&(c.stroke=i.color),!o.instance._suspendDrawing){var u=o.instance._suspendedAt||we();o.instance._paintEndpoint(o.endpoints[0],{timestamp:u}),o.instance._paintEndpoint(o.endpoints[1],{timestamp:u})}o.cost=i.cost||o.endpoints[0].connectionCost,o.directed=i.directed,null==i.directed&&(o.directed=o.endpoints[0].connectionsDirected);var h=se({},o.endpoints[1].parameters);se(h,o.endpoints[0].parameters),se(h,o.parameters),o.parameters=h,o.paintStyleInUse=o.getPaintStyle()||{},o._setConnector(o.endpoints[0].connector||o.endpoints[1].connector||i.connector||o.instance.defaults.connector,!0);var d=null!=i.data&&ce(i.data)?i.data:{};o.setData(d);var p=[Yn,o.endpoints[0].edgeType,o.endpoints[1].edgeType,i.type].join(" ");return/[^\s]/.test(p)&&o.addType(p,i.data),o}return U(n,[{key:"getIdPrefix",value:function(){return"_jsPlumb_c"}},{key:"getDefaultOverlayKey",value:function(){return"connectionOverlays"}},{key:"getXY",value:function(){return{x:this.connector.x,y:this.connector.y}}},{key:"makeEndpoint",value:function(e,t,n,i,o){return n=n||this.instance.getId(t),ks(this,o,e?0:1,i,t)}},{key:"getTypeDescriptor",value:function(){return n.type}},{key:"isDetachable",value:function(e){return!1!==this.detachable&&(null!=e?!0===e.connectionsDetachable:!0===this.detachable)}},{key:"setDetachable",value:function(e){this.detachable=!0===e}},{key:"isReattach",value:function(){return!0===this.reattach||!0===this.endpoints[0].reattachConnections||!0===this.endpoints[1].reattachConnections}},{key:"setReattach",value:function(e){this.reattach=!0===e}},{key:"applyType",value:function(e,t){var i=null;null!=e.connector&&(null==(i=this.getCachedTypeItem(bs,t.connector))&&(i=this.prepareConnector(e.connector,t.connector),this.cacheTypeItem(bs,i,t.connector)),this.setPreparedConnector(i)),Q(W(n.prototype),"applyType",this).call(this,e,t),null!=e.detachable&&this.setDetachable(e.detachable),null!=e.reattach&&this.setReattach(e.reattach),e.scope&&(this.scope=e.scope);var o=null;e.anchor?null==(o=this.getCachedTypeItem(xs,t.anchor))&&(o=[$o(e.anchor),$o(e.anchor)],this.cacheTypeItem(xs,o,t.anchor)):e.anchors&&null==(o=this.getCachedTypeItem(xs,t.anchors))&&(o=[$o(e.anchors[0]),$o(e.anchors[1])],this.cacheTypeItem(xs,o,t.anchors)),null!=o&&(this.instance.router.setConnectionAnchors(this,o),this.instance.router.isDynamicAnchor(this.endpoints[1])&&this.instance.repaint(this.endpoints[1].element)),this.instance.applyConnectorType(this.connector,e)}},{key:"addClass",value:function(e,t){Q(W(n.prototype),"addClass",this).call(this,e),t&&(this.endpoints[0].addClass(e),this.endpoints[1].addClass(e),this.suspendedEndpoint&&this.suspendedEndpoint.addClass(e)),this.connector&&this.instance.addConnectorClass(this.connector,e)}},{key:"removeClass",value:function(e,t){Q(W(n.prototype),"removeClass",this).call(this,e),t&&(this.endpoints[0].removeClass(e),this.endpoints[1].removeClass(e),this.suspendedEndpoint&&this.suspendedEndpoint.removeClass(e)),this.connector&&this.instance.removeConnectorClass(this.connector,e)}},{key:"setVisible",value:function(e){Q(W(n.prototype),"setVisible",this).call(this,e),this.connector&&this.instance.setConnectorVisible(this.connector,e),this.instance._paintConnection(this)}},{key:"destroy",value:function(){Q(W(n.prototype),"destroy",this).call(this),this.endpoints=null,this.endpointStyles=null,this.source=null,this.target=null,this.instance.destroyConnector(this),this.connector=null,this.deleted=!0}},{key:"getUuids",value:function(){return[this.endpoints[0].getUuid(),this.endpoints[1].getUuid()]}},{key:"prepareConnector",value:function(e,t){var n,i={cssClass:this.params.cssClass,hoverClass:this.params.hoverClass,"pointer-events":this.params["pointer-events"]};if(ae(e))n=this.instance._makeConnector(this,e,i);else{var o=e;n=this.instance._makeConnector(this,o.type,de(o.options||{},i))}return null!=t&&(n.typeId=t),n}},{key:"setPreparedConnector",value:function(e,t,n,i){if(this.connector!==e){var o,s="";if(null!=this.connector&&(o=this.connector,s=this.instance.getConnectorClass(this.connector),this.instance.destroyConnector(this)),this.connector=e,i&&this.cacheTypeItem(bs,e,i),this.addClass(s),null!=o){var r=this.getOverlays();for(var a in r)this.instance.reattachOverlay(r[a],this)}t||this.instance._paintConnection(this)}}},{key:"_setConnector",value:function(e,t,n,i){var o=this.prepareConnector(e,i);this.setPreparedConnector(o,t,n,i)}},{key:"replaceEndpoint",value:function(e,t){var n=this.endpoints[e],i=(n.elementId,this.instance.getEndpoints(n.element)),o=i.indexOf(n),s=ks(this,null,e,null,n.element,0,t);this.endpoints[e]=s,i.splice(o,1,s),n.detachFromConnection(this),this.instance.deleteEndpoint(n),this.instance.fire("endpoint:replaced",{previous:n,current:s})}}]),n}(ys);function Es(e){if(null==e.path){var t=se({"jtk-overlay-id":e.id},e.attributes);e.path=Nt(It,t);var n=e.instance.overlayClass+" "+(e.cssClass?e.cssClass:"");e.instance.addClass(e.path,n),e.path.jtk={overlay:e}}var i=e.path.parentNode;if(null==i){if(e.component instanceof Cs){var o=e.component.connector;i=null!=o?o.canvas:null}else if(e.component instanceof _s){var s=e.component.endpoint;i=null!=s?s.canvas:s}null!=i&&$t(i,e.path,1)}return e.path}Y(Cs,"type","connection"),function(e){X(n,e);var t=K(n);function n(){var e;V(this,n);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return Y(Z(e=t.call.apply(t,[this].concat(o))),"path",void 0),e}}(ns);var Ss=function(){function e(){V(this,e)}return U(e,null,[{key:"paint",value:function(e,t,n,i){if(null!=n){var o=[e.x,e.y],s=[e.w,e.h];if(null!=i&&(i.xmin<0&&(o[0]+=i.xmin),i.ymin<0&&(o[1]+=i.ymin),s[0]=i.xmax+(i.xmin<0?-i.xmin:0),s[1]=i.ymax+(i.ymin<0?-i.ymin:0)),isFinite(s[0])&&isFinite(s[1])){var r={width:""+(s[0]||0),height:""+(s[1]||0)};t.containerType===Ee.HTML?Lt(e.canvas,se(r,{style:Ft([o[0],o[1]])})):Lt(e.canvas,se(r,{x:o[0],y:o[1]}))}}}}]),e}();function Ps(e,t,n,i){!function(e,t){if(null!=t.canvas)return t.canvas;var n=Nt(jt,{style:"",width:"0",height:"0","pointer-events":nt,position:it});t.canvas=n,e._appendElement(t.canvas,e.getContainer()),null!=t.cssClass&&e.addClass(n,t.cssClass),e.addClass(n,e.connectorClass),n.jtk=n.jtk||{},n.jtk.connector=t}(e,t),Ss.paint(t,e,n,i);var o=[0,0];if(i.xmin<0&&(o[0]=-i.xmin),i.ymin<0&&(o[1]=-i.ymin),t.segments.length>0){var s={d:e.getPathData(t),transform:"translate("+o[0]+","+o[1]+")","pointer-events":"visibleStroke"},r=null;if(n.outlineStroke){var a=n.outlineWidth||1,l=n.strokeWidth+2*a;(r=se({},n)).stroke=n.outlineStroke,r.strokeWidth=l,null==t.bgPath?(t.bgPath=Nt(It,s),e.addClass(t.bgPath,e.connectorOutlineClass),$t(t.canvas,t.bgPath,0)):Lt(t.bgPath,s),Rt(t.canvas,t.bgPath,r)}var c=t;null==c.path?(c.path=Nt(It,s),$t(c.canvas,c.path,n.outlineStroke?1:0)):(c.path.parentNode!==c.canvas&&$t(c.canvas,c.path,n.outlineStroke?1:0),Lt(t.path,s)),Rt(t.canvas,t.path,n)}}var ws=function(){function e(){V(this,e)}return U(e,null,[{key:"getEndpointElement",value:function(e){if(null!=e.canvas)return e.canvas;var t=Nt(jt,{style:"",width:"0",height:"0","pointer-events":"all",position:it});e.canvas=t;var n=e.classes.join(" ");e.instance.addClass(t,n);for(var i=e.endpoint.scope.split(/\s/),o=0;o<i.length;o++)e.instance.setAttribute(t,ct+i[o],Xn);return e.instance._appendElementToContainer(t),null!=e.cssClass&&e.instance.addClass(t,e.cssClass),e.instance.addClass(t,e.instance.endpointClass),t.jtk=t.jtk||{},t.jtk.endpoint=e.endpoint,t.style.display=!1!==e.endpoint.visible?tt:nt,t}},{key:"paint",value:function(e,t,n){if(!0!==e.endpoint.deleted){this.getEndpointElement(e),Ss.paint(e,e.instance,n);var i=se({},n);i.outlineStroke&&(i.stroke=i.outlineStroke),null==e.node?(e.node=t.makeNode(e,i),e.canvas.appendChild(e.node)):null!=t.updateNode&&t.updateNode(e,e.node),Rt(e.canvas,e.node,i)}}}]),e}(),As=function(){function e(t,n){V(this,e),this.connection=t,Y(this,"type",void 0),Y(this,"edited",!1),Y(this,"stub",void 0),Y(this,"sourceStub",void 0),Y(this,"targetStub",void 0),Y(this,"maxStub",void 0),Y(this,"typeId",void 0),Y(this,"gap",void 0),Y(this,"sourceGap",void 0),Y(this,"targetGap",void 0),Y(this,"segments",[]),Y(this,"totalLength",0),Y(this,"segmentProportions",[]),Y(this,"segmentProportionalLengths",[]),Y(this,"paintInfo",null),Y(this,"strokeWidth",void 0),Y(this,"x",void 0),Y(this,"y",void 0),Y(this,"w",void 0),Y(this,"h",void 0),Y(this,"segment",void 0),Y(this,"bounds",{xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}),Y(this,"cssClass",void 0),Y(this,"hoverClass",void 0),Y(this,"geometry",void 0),this.stub=n.stub||this.getDefaultStubs(),this.sourceStub=Array.isArray(this.stub)?this.stub[0]:this.stub,this.targetStub=Array.isArray(this.stub)?this.stub[1]:this.stub,this.gap=n.gap||0,this.sourceGap=Array.isArray(this.gap)?this.gap[0]:this.gap,this.targetGap=Array.isArray(this.gap)?this.gap[1]:this.gap,this.maxStub=Math.max(this.sourceStub,this.targetStub),this.cssClass=n.cssClass||"",this.hoverClass=n.hoverClass||""}return U(e,[{key:"getTypeDescriptor",value:function(){return"connector"}},{key:"getIdPrefix",value:function(){return"_jsplumb_connector"}},{key:"setGeometry",value:function(e,t){this.geometry=e,this.edited=null!=e&&!t}},{key:"exportGeometry",value:function(){return this.geometry}},{key:"importGeometry",value:function(e){return this.geometry=e,!0}},{key:"resetGeometry",value:function(){this.geometry=null,this.edited=!1}},{key:"transformAnchorPlacement",value:function(e,t,n){return{x:e.x,y:e.y,ox:e.ox,oy:e.oy,curX:e.curX+t,curY:e.curY+n}}},{key:"resetBounds",value:function(){this.bounds={xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}}},{key:"findSegmentForPoint",value:function(e,t){for(var n={d:1/0,s:null,x:null,y:null,l:null,x1:null,y1:null,x2:null,y2:null,index:null,connectorLocation:null},i=0;i<this.segments.length;i++){var o=this.segments[i].findClosestPointOnPath(e,t);o.d<n.d&&(n.d=o.d,n.l=o.l,n.x=o.x,n.y=o.y,n.s=this.segments[i],n.x1=o.x1,n.x2=o.x2,n.y1=o.y1,n.y2=o.y2,n.index=i,n.connectorLocation=this.segmentProportions[i][0]+o.l*(this.segmentProportions[i][1]-this.segmentProportions[i][0]))}return n}},{key:"lineIntersection",value:function(e,t,n,i){for(var o=[],s=0;s<this.segments.length;s++)o.push.apply(o,this.segments[s].lineIntersection(e,t,n,i));return o}},{key:"boxIntersection",value:function(e,t,n,i){for(var o=[],s=0;s<this.segments.length;s++)o.push.apply(o,this.segments[s].boxIntersection(e,t,n,i));return o}},{key:"boundingBoxIntersection",value:function(e){for(var t=[],n=0;n<this.segments.length;n++)t.push.apply(t,this.segments[n].boundingBoxIntersection(e));return t}},{key:"_updateSegmentProportions",value:function(){for(var e=0,t=0;t<this.segments.length;t++){var n=this.segments[t].getLength();this.segmentProportionalLengths[t]=n/this.totalLength,this.segmentProportions[t]=[e,e+=n/this.totalLength]}}},{key:"_findSegmentForLocation",value:function(e,t){var n,i,o;if(t&&(e=e>0?e/this.totalLength:(this.totalLength+e)/this.totalLength),1===e)n=this.segments.length-1,o=1;else if(0===e)o=0,n=0;else if(e>=.5){for(n=0,o=0,i=this.segmentProportions.length-1;i>-1;i--)if(this.segmentProportions[i][1]>=e&&this.segmentProportions[i][0]<=e){n=i,o=(e-this.segmentProportions[i][0])/this.segmentProportionalLengths[i];break}}else for(n=this.segmentProportions.length-1,o=1,i=0;i<this.segmentProportions.length;i++)if(this.segmentProportions[i][1]>=e){n=i,o=(e-this.segmentProportions[i][0])/this.segmentProportionalLengths[i];break}return{segment:this.segments[n],proportion:o,index:n}}},{key:"_addSegment",value:function(e,t){if(t.x1!==t.x2||t.y1!==t.y2){var n=new e(t);this.segments.push(n),this.totalLength+=n.getLength(),this.updateBounds(n)}}},{key:"_clearSegments",value:function(){this.totalLength=0,this.segments.length=0,this.segmentProportions.length=0,this.segmentProportionalLengths.length=0}},{key:"getLength",value:function(){return this.totalLength}},{key:"_prepareCompute",value:function(e){this.strokeWidth=e.strokeWidth;var t=e.sourcePos.curX,n=e.targetPos.curX,i=e.sourcePos.curY,o=e.targetPos.curY,s=Ei({x:t,y:i},{x:n,y:o}),r=n<t,a=o<i,l=[e.sourcePos.ox,e.sourcePos.oy],c=[e.targetPos.ox,e.targetPos.oy],u=r?n:t,h=a?o:i,d=Math.abs(n-t),p=Math.abs(o-i),f=0===l[0]&&0===l[1],v=0===c[0]&&0===c[1];if(f||v){var g=d>p?0:1,y=[1,0][g],m=0===g?t:i,_=0===g?n:o;f&&(l[g]=m>_?-1:1,l[y]=0),v&&(c[g]=m>_?1:-1,c[y]=0)}var x=r?d+this.sourceGap*l[0]:this.sourceGap*l[0],b=a?p+this.sourceGap*l[1]:this.sourceGap*l[1],k=r?this.targetGap*c[0]:d+this.targetGap*c[0],C=a?this.targetGap*c[1]:p+this.targetGap*c[1],E=l[0]*c[0]+l[1]*c[1],S={sx:x,sy:b,tx:k,ty:C,xSpan:Math.abs(k-x),ySpan:Math.abs(C-b),mx:(x+k)/2,my:(b+C)/2,so:l,to:c,x:u,y:h,w:d,h:p,segment:s,startStubX:x+l[0]*this.sourceStub,startStubY:b+l[1]*this.sourceStub,endStubX:k+c[0]*this.targetStub,endStubY:C+c[1]*this.targetStub,isXGreaterThanStubTimes2:Math.abs(x-k)>this.sourceStub+this.targetStub,isYGreaterThanStubTimes2:Math.abs(b-C)>this.sourceStub+this.targetStub,opposite:-1===E,perpendicular:0===E,orthogonal:1===E,sourceAxis:0===l[0]?"y":"x",points:[u,h,d,p,x,b,k,C],stubs:[this.sourceStub,this.targetStub]};return S.anchorOrientation=S.opposite?"opposite":S.orthogonal?"orthogonal":"perpendicular",S}},{key:"updateBounds",value:function(e){var t=e.extents;this.bounds.xmin=Math.min(this.bounds.xmin,t.xmin),this.bounds.xmax=Math.max(this.bounds.xmax,t.xmax),this.bounds.ymin=Math.min(this.bounds.ymin,t.ymin),this.bounds.ymax=Math.max(this.bounds.ymax,t.ymax)}},{key:"dumpSegmentsToConsole",value:function(){Te("SEGMENTS:");for(var e=0;e<this.segments.length;e++)Te(this.segments[e].type,""+this.segments[e].getLength(),""+this.segmentProportions[e])}},{key:"pointOnPath",value:function(e,t){var n=this._findSegmentForLocation(e,t);return n.segment&&n.segment.pointOnPath(n.proportion,!1)||{x:0,y:0}}},{key:"gradientAtPoint",value:function(e,t){var n=this._findSegmentForLocation(e,t);return n.segment&&n.segment.gradientAtPoint(n.proportion,!1)||0}},{key:"pointAlongPathFrom",value:function(e,t,n){var i=this._findSegmentForLocation(e,n);return i.segment&&i.segment.pointAlongPathFrom(i.proportion,t,!1)||{x:0,y:0}}},{key:"compute",value:function(e){this.paintInfo=this._prepareCompute(e),this._clearSegments(),this._compute(this.paintInfo,e),this.x=this.paintInfo.points[0],this.y=this.paintInfo.points[1],this.w=this.paintInfo.points[2],this.h=this.paintInfo.points[3],this.segment=this.paintInfo.segment,this._updateSegmentProportions()}},{key:"setAnchorOrientation",value:function(e,t){}}]),e}(),Ms=function(e){X(n,e);var t=K(n);function n(e,i,o){var s;return V(this,n),(s=t.call(this,e,i,o)).instance=e,s.component=i,Y(Z(s),"width",void 0),Y(Z(s),"length",void 0),Y(Z(s),"foldback",void 0),Y(Z(s),"direction",void 0),Y(Z(s),"location",.5),Y(Z(s),"paintStyle",void 0),Y(Z(s),"type",n.type),Y(Z(s),"cachedDimensions",void 0),o=o||{},s.width=o.width||20,s.length=o.length||20,s.direction=(o.direction||1)<0?-1:1,s.foldback=o.foldback||.623,s.paintStyle=o.paintStyle||{strokeWidth:1},s.location=null==o.location?s.location:Array.isArray(o.location)?o.location[0]:o.location,s}return U(n,[{key:"draw",value:function(e,t,n){if(e instanceof As){var i,o,s,r=e;if(this.location>1||this.location<0){var a=this.location<0?1:0;o=Pi(i=r.pointAlongPathFrom(a,this.location,!1),r.pointAlongPathFrom(a,this.location-this.direction*this.length/2,!1),this.length)}else if(1===this.location){if(o=Pi(i=r.pointOnPath(this.location),r.pointAlongPathFrom(this.location,-this.length),this.length),-1===this.direction){var l=o;o=i,i=l}}else if(0===this.location){if(i=Pi(o=r.pointOnPath(this.location),r.pointAlongPathFrom(this.location,this.length),this.length),-1===this.direction){var c=o;o=i,i=c}}else o=Pi(i=r.pointAlongPathFrom(this.location,this.direction*this.length/2),r.pointOnPath(this.location),this.length);var u={hxy:i,tail:s=function(e,t,n){var i=ki(e,t),o=Math.atan(-1/i),s=n/2*Math.sin(o),r=n/2*Math.cos(o);return[{x:t.x+r,y:t.y+s},{x:t.x-r,y:t.y-s}]}(i,o,this.width),cxy:Pi(i,o,this.foldback*this.length)},h=this.paintStyle.stroke||t.stroke,d=this.paintStyle.fill||t.stroke;return{component:e,d:u,"stroke-width":this.paintStyle.strokeWidth||t.strokeWidth,stroke:h,fill:d,xmin:Math.min(i.x,s[0].x,s[1].x),xmax:Math.max(i.x,s[0].x,s[1].x),ymin:Math.min(i.y,s[0].y,s[1].y),ymax:Math.max(i.y,s[0].y,s[1].y)}}}},{key:"updateFrom",value:function(e){}}]),n}(ns);function Ds(e){return e.type===Ms.type}Y(Ms,"type","Arrow"),ss(Ms.type,Ms);var Ts=function(e){X(n,e);var t=K(n);function n(e,i,o){var s;return V(this,n),(s=t.call(this,e,i,o)).instance=e,Y(Z(s),"type",n.type),s.length=s.length/2,s.foldback=2,s}return n}(Ms);function Os(e){return e.type===Ts.type}Y(Ts,"type","Diamond"),ss(Ts.type,Ts);var js=function(e){X(n,e);var t=K(n);function n(e,i,o){var s;return V(this,n),(s=t.call(this,e,i,o)).instance=e,Y(Z(s),"type",n.type),s.foldback=1,s}return n}(Ms);function Is(e){return e.type===js.type}Y(js,"type","PlainArrow"),ss("PlainArrow",js);var Gs=function(e){X(n,e);var t=K(n);function n(e,i,o){var s;return V(this,n),(s=t.call(this,e,i,o)).instance=e,s.component=i,Y(Z(s),"create",void 0),Y(Z(s),"type",n.type),s.create=o.create,s}return U(n,[{key:"updateFrom",value:function(e){}}]),n}(ns);function Ls(e){return e.type===Gs.type}Y(Gs,"type","Custom"),ss(Gs.type,Gs);var Ns=function(e){X(n,e);var t=K(n);function n(e,i){var o;return V(this,n),Y(Z(o=t.call(this,e,i)),"radius",void 0),Y(Z(o),"defaultOffset",void 0),Y(Z(o),"defaultInnerRadius",void 0),Y(Z(o),"type",n.type),i=i||{},o.radius=i.radius||5,o.defaultOffset=.5*o.radius,o.defaultInnerRadius=o.radius/3,o}return n}(vo);Y(Ns,"type","Dot");var Fs={type:Ns.type,cls:Ns,compute:function(e,t,n,i){var o=t.curX-e.radius,s=t.curY-e.radius,r=2*e.radius,a=2*e.radius;if(i&&i.stroke){var l=i.strokeWidth||1;o-=l,s-=l,r+=2*l,a+=2*l}return e.x=o,e.y=s,e.w=r,e.h=a,[o,s,r,a,e.radius]},getParams:function(e){return{radius:e.radius}}},Rs=function e(t,n){V(this,e),this.instance=t,this.el=n,Y(this,"group",void 0)},$s=function(e){X(n,e);var t=K(n);function n(e,i,o){var s;V(this,n),(s=t.call(this,e,i)).instance=e,Y(Z(s),"children",[]),Y(Z(s),"collapsed",!1),Y(Z(s),"droppable",void 0),Y(Z(s),"enabled",void 0),Y(Z(s),"orphan",void 0),Y(Z(s),"constrain",void 0),Y(Z(s),"proxied",void 0),Y(Z(s),"ghost",void 0),Y(Z(s),"revert",void 0),Y(Z(s),"prune",void 0),Y(Z(s),"dropOverride",void 0),Y(Z(s),"anchor",void 0),Y(Z(s),"endpoint",void 0),Y(Z(s),"connections",{source:[],target:[],internal:[]}),Y(Z(s),"manager",void 0),Y(Z(s),"id",void 0),Y(Z(s),"elId",void 0);var r=s.el;return r._isJsPlumbGroup=!0,r._jsPlumbGroup=Z(s),s.elId=e.getId(i),s.orphan=!0===o.orphan,s.revert=!0!==s.orphan&&!1!==o.revert,s.droppable=!1!==o.droppable,s.ghost=!0===o.ghost,s.enabled=!1!==o.enabled,s.prune=!0!==s.orphan&&!0===o.prune,s.constrain=s.ghost||!0===o.constrain,s.proxied=!1!==o.proxied,s.id=o.id||we(),s.dropOverride=!0===o.dropOverride,s.anchor=o.anchor,s.endpoint=o.endpoint,s.anchor=o.anchor,e.setAttribute(i,st,""),s}return U(n,[{key:"contentArea",get:function(){return this.instance.getGroupContentArea(this)}},{key:"overrideDrop",value:function(e,t){return this.dropOverride&&(this.revert||this.prune||this.orphan)}},{key:"getAnchor",value:function(e,t){return this.anchor||"Continuous"}},{key:"getEndpoint",value:function(e,t){return this.endpoint||{type:Ns.type,options:{radius:10}}}},{key:"add",value:function(e,t){var n=this.instance.getGroupContentArea(this),i=e;if(null!=i._jsPlumbParentGroup){if(i._jsPlumbParentGroup===this)return;i._jsPlumbParentGroup.remove(e,!0,t,!1)}i._jsPlumbParentGroup=this,this.children.push(new Rs(this.instance,e)),this.instance._appendElement(i,n),this.manager._updateConnectionsForGroup(this)}},{key:"resolveNode",value:function(e){return null==e?null:ye(this.children,(function(t){return t.el===e}))}},{key:"remove",value:function(e,t,n,i,o){var s=this.resolveNode(e);null!=s&&this._doRemove(s,t,n,i,o)}},{key:"_doRemove",value:function(e,t,n,i,o){var s=e.el;if(delete s._jsPlumbParentGroup,_e(this.children,(function(t){return t===e})),t)try{this.instance.getGroupContentArea(this).removeChild(s)}catch(e){Te("Could not remove element from Group "+e)}if(!n){var r={group:this,el:s};o&&(r.targetGroup=o),this.instance.fire("group:member:removed",r)}i||this.manager._updateConnectionsForGroup(this)}},{key:"removeAll",value:function(e,t){for(var n=0,i=this.children.length;n<i;n++){var o=this.children[0];this._doRemove(o,e,t,!0),this.instance.unmanage(o.el,!0)}this.children.length=0,this.manager._updateConnectionsForGroup(this)}},{key:"orphanAll",value:function(){for(var e={},t=0;t<this.children.length;t++){var n=this.manager.orphan(this.children[t].el,!1);e[n.id]=n.pos}return this.children.length=0,e}},{key:"addGroup",value:function(e){if(this.instance.allowNestedGroups&&e!==this){if(this.instance.groupManager.isAncestor(this,e))return!1;null!=e.group&&e.group.removeGroup(e);var t=this.instance.getId(e.el);this.instance.getManagedElements()[t].group=this.elId;var n=this.instance.getOffsetRelativeToRoot(e.el),i=this.collapsed?this.instance.getOffsetRelativeToRoot(this.el):this.instance.getOffsetRelativeToRoot(this.instance.getGroupContentArea(this));e.el._jsPlumbParentGroup=this,this.children.push(e),this.instance._appendElementToGroup(this,e.el),e.group=this;var o={x:n.x-i.x,y:n.y-i.y};return this.instance.setPosition(e.el,o),this.instance.fire("group:nested:added",{parent:this,child:e}),!0}return!1}},{key:"removeGroup",value:function(e){if(e.group===this){var t=e.el,n=this.instance.getGroupContentArea(this);n===t.parentNode&&n.removeChild(e.el);var i=this.instance.getId(e.el),o=this.instance.getManagedElements()[i];o&&delete o.group,this.children=this.children.filter((function(t){return t.id!==e.id})),delete e.group,delete t._jsPlumbParentGroup,this.instance.fire("group:nested:removed",{parent:this,child:e})}}},{key:"getGroups",value:function(){return this.children.filter((function(e){return e.constructor===n}))}},{key:"getNodes",value:function(){return this.children.filter((function(e){return e.constructor===Rs}))}},{key:"collapseParent",get:function(){var e=null;if(null==this.group)return null;for(var t=this.group;null!=t;)t.collapsed&&(e=t),t=t.group;return e}}]),n}(Rs),Hs=function(){function e(t){var n=this;V(this,e),this.instance=t,Y(this,"groupMap",{}),Y(this,"_connectionSourceMap",{}),Y(this,"_connectionTargetMap",{}),t.bind(mt,(function(e){var t=n.getGroupFor(e.source),i=n.getGroupFor(e.target);null!=t&&null!=i&&t===i?(n._connectionSourceMap[e.connection.id]=t,n._connectionTargetMap[e.connection.id]=t,Ce(t.connections.internal,e.connection)):(null!=t&&(e.target._jsPlumbGroup===t?Ce(t.connections.internal,e.connection):Ce(t.connections.source,e.connection),n._connectionSourceMap[e.connection.id]=t),null!=i&&(e.source._jsPlumbGroup===i?Ce(i.connections.internal,e.connection):Ce(i.connections.target,e.connection),n._connectionTargetMap[e.connection.id]=i))})),t.bind(bt,(function(e){n._cleanupDetachedConnection(e.connection)})),t.bind(_t,(function(e){var t=e.originalEndpoint.element,i=n.getGroupFor(t),o=e.connection.endpoints[e.index].element,s=n.getGroupFor(o),r=0===e.index?n._connectionSourceMap:n._connectionTargetMap,a=0===e.index?n._connectionTargetMap:n._connectionSourceMap;null!=s?(r[e.connection.id]=s,e.connection.source===e.connection.target&&(a[e.connection.id]=s)):(delete r[e.connection.id],e.connection.source===e.connection.target&&delete a[e.connection.id]),null!=i&&n._updateConnectionsForGroup(i),null!=s&&n._updateConnectionsForGroup(s)}))}return U(e,[{key:"_cleanupDetachedConnection",value:function(e){e.proxies.length=0;var t,n=this._connectionSourceMap[e.id];null!=n&&(t=function(t){return t.id===e.id},_e(n.connections.source,t),_e(n.connections.target,t),_e(n.connections.internal,t),delete this._connectionSourceMap[e.id]),null!=(n=this._connectionTargetMap[e.id])&&(t=function(t){return t.id===e.id},_e(n.connections.source,t),_e(n.connections.target,t),_e(n.connections.internal,t),delete this._connectionTargetMap[e.id])}},{key:"addGroup",value:function(e){var t=e.el;if(null!=this.groupMap[e.id])throw new Error("cannot create Group ["+e.id+"]; a Group with that ID exists");if(null!=t._isJsPlumbGroup)throw new Error("cannot create Group ["+e.id+"]; the given element is already a Group");var n=new $s(this.instance,e.el,e);return this.groupMap[n.id]=n,e.collapsed&&this.collapseGroup(n),this.instance.manage(n.el),this.instance.addClass(n.el,vt),n.manager=this,this._updateConnectionsForGroup(n),this.instance.fire("group:added",{group:n}),n}},{key:"getGroup",value:function(e){var t=e;if(ae(e)&&null==(t=this.groupMap[e]))throw new Error("No such group ["+e+"]");return t}},{key:"getGroupFor",value:function(e){for(var t=e,n=this.instance.getContainer(),i=!1,o=null;!i;)null==t||t===n?i=!0:t._jsPlumbParentGroup?(o=t._jsPlumbParentGroup,i=!0):t=t.parentNode;return o}},{key:"getGroups",value:function(){var e=[];for(var t in this.groupMap)e.push(this.groupMap[t]);return e}},{key:"removeGroup",value:function(e,t,n,i){var o=this,s=this.getGroup(e);this.expandGroup(s,!0);var r={};return ve(s.children,(function(e){var t=o.instance.getManagedElements()[o.instance.getId(e.el)];t&&delete t.group})),t?(ve(s.getGroups(),(function(e){return o.removeGroup(e,t,n)})),s.removeAll(n,i)):(s.group&&ve(s.children,(function(e){return s.group.add(e.el)})),r=s.orphanAll()),s.group&&s.group.removeGroup(s),this.instance.unmanage(s.el,!0),delete this.groupMap[s.id],this.instance.fire("group:removed",{group:s}),r}},{key:"removeAllGroups",value:function(e,t,n){for(var i in this.groupMap)this.removeGroup(this.groupMap[i],e,t,n)}},{key:"forEach",value:function(e){for(var t in this.groupMap)e(this.groupMap[t])}},{key:"orphan",value:function(e,t){var n=e;if(n._jsPlumbParentGroup){var i=n._jsPlumbParentGroup,o=this.instance.getId(n),s=this.instance.getOffset(e);return!0!==t&&i.group?this.instance._appendElementToGroup(i.group,e):this.instance._appendElementToContainer(e),this.instance.setPosition(e,s),delete n._jsPlumbParentGroup,{id:o,pos:s}}}},{key:"_updateConnectionsForGroup",value:function(e){var t=this;e.connections.source.length=0,e.connections.target.length=0,e.connections.internal.length=0;var n=e.children.slice().map((function(e){return e.el})),i=[];if(ve(n,(function(e){Array.prototype.push.apply(i,t.instance.getSelector(e,Dt))})),Array.prototype.push.apply(n,i),n.length>0){var o,s,r=this.instance.getConnections({source:n,scope:qn},!0),a=this.instance.getConnections({target:n,scope:qn},!0),l={},c=function(n){for(var i=0;i<n.length;i++)l[n[i].id]||(l[n[i].id]=!0,o=t.getGroupFor(n[i].source),s=t.getGroupFor(n[i].target),n[i].source===e.el&&s===e||n[i].target===e.el&&o===e?e.connections.internal.push(n[i]):o===e?(s!==e?e.connections.source.push(n[i]):e.connections.internal.push(n[i]),t._connectionSourceMap[n[i].id]=e):s===e&&(e.connections.target.push(n[i]),t._connectionTargetMap[n[i].id]=e))};c(r),c(a)}}},{key:"_collapseConnection",value:function(e,t,n){var i=e.endpoints[0===t?1:0].element;if(i._jsPlumbParentGroup&&!i._jsPlumbParentGroup.proxied&&i._jsPlumbParentGroup.collapsed)return!1;var o=e.endpoints[0].element._jsPlumbParentGroup,s=null!=o?o.collapseParent||o:null,r=e.endpoints[1].element._jsPlumbParentGroup,a=null!=r?r.collapseParent||r:null;if(null==s||null==a||s.id!==a.id){var l=n.el;return this.instance.getId(l),this.instance.proxyConnection(e,t,l,(function(e,t){return n.getEndpoint(e,t)}),(function(e,t){return n.getAnchor(e,t)})),!0}return!1}},{key:"_expandConnection",value:function(e,t,n){this.instance.unproxyConnection(e,t)}},{key:"isElementDescendant",value:function(e,t){for(var n=this.instance.getContainer();;){if(null==e||e===n)return!1;if(e===t)return!0;e=e.parentNode}}},{key:"collapseGroup",value:function(e){var t=this,n=this.getGroup(e);if(null!=n&&!n.collapsed){var i=n.el;if(null==n.collapseParent){if(this.instance.setGroupVisible(n,!1),n.collapsed=!0,this.instance.removeClass(i,vt),this.instance.addClass(i,ft),n.proxied){var o=new Set,s=function(e,i){for(var s=0;s<e.length;s++){var r=e[s];!0===t._collapseConnection(r,i,n)&&o.add(r.id)}};s(n.connections.source,0),s(n.connections.target,1),ve(n.getGroups(),(function(e){t.cascadeCollapse(n,e,o)}))}this.instance.revalidate(i),this.repaintGroup(n),this.instance.fire("group:collapse",{group:n})}else n.collapsed=!0,this.instance.removeClass(i,vt),this.instance.addClass(i,ft)}}},{key:"cascadeCollapse",value:function(e,t,n){var i=this;if(e.proxied){var o=function(t,o){for(var s=0;s<t.length;s++){var r=t[s];n.has(r.id)||!0===i._collapseConnection(r,o,e)&&n.add(r.id)}};o(t.connections.source,0),o(t.connections.target,1)}ve(t.getGroups(),(function(t){i.cascadeCollapse(e,t,n)}))}},{key:"expandGroup",value:function(e,t){var n=this,i=this.getGroup(e);if(null!=i){var o=i.el;if(null==i.collapseParent){if(this.instance.setGroupVisible(i,!0),i.collapsed=!1,this.instance.addClass(o,vt),this.instance.removeClass(o,ft),i.proxied){var s=function(e,t){for(var o=0;o<e.length;o++){var s=e[o];n._expandConnection(s,t,i)}};s(i.connections.source,0),s(i.connections.target,1);ve(i.getGroups(),(function e(t,i){if(i||t.collapsed){var o=function(e,i){for(var o=0;o<e.length;o++){var s=e[o];n._collapseConnection(s,i,t.collapseParent||t)}};o(t.connections.source,0),o(t.connections.target,1),ve(t.connections.internal,(function(e){return e.setVisible(!1)})),ve(t.getGroups(),(function(t){return e(t,!0)}))}else n.expandGroup(t,!0)}))}this.instance.revalidate(o),this.repaintGroup(i),t||this.instance.fire("group:expand",{group:i})}else i.collapsed=!1,this.instance.addClass(o,vt),this.instance.removeClass(o,ft)}}},{key:"toggleGroup",value:function(e){null!=(e=this.getGroup(e))&&(e.collapsed?this.expandGroup(e):this.collapseGroup(e))}},{key:"repaintGroup",value:function(e){for(var t=this.getGroup(e).children,n=0;n<t.length;n++)this.instance.revalidate(t[n].el)}},{key:"addToGroup",value:function(e,t){var n=this,i=this.getGroup(e);if(i){for(var o=i.el,s=function(e){var s=e,r=null!=s._isJsPlumbGroup,a=s._jsPlumbGroup,l=s._jsPlumbParentGroup;if(l!==i){var c=n.instance.manage(e),u=n.instance.getOffset(e),h=i.collapsed?n.instance.getOffsetRelativeToRoot(o):n.instance.getOffset(n.instance.getGroupContentArea(i));c.group=i.elId,null!=l&&(l.remove(e,!1,t,!1,i),n._updateConnectionsForGroup(l)),r?i.addGroup(a):i.add(e,t);var d=function(e,t){var o=0===t?1:0;e.each((function(e){e.setVisible(!1),e.endpoints[o].element._jsPlumbGroup===i?(e.endpoints[o].setVisible(!1),n._expandConnection(e,o,i)):(e.endpoints[t].setVisible(!1),n._collapseConnection(e,t,i))}))};i.collapsed&&(d(n.instance.select({source:e}),0),d(n.instance.select({target:e}),1)),n.instance.getId(e);var p={x:u.x-h.x,y:u.y-h.y};if(n.instance.setPosition(e,p),n._updateConnectionsForGroup(i),n.instance.revalidate(e),!t){var f={group:i,el:e,pos:p};l&&(f.sourceGroup=l),n.instance.fire(Ct,f)}}},r=arguments.length,a=new Array(r>2?r-2:0),l=2;l<r;l++)a[l-2]=arguments[l];ve(a,s)}}},{key:"removeFromGroup",value:function(e,t){var n=this,i=this.getGroup(e);if(i){for(var o=function(e){if(i.collapsed){var o=function(t,o){for(var s=0;s<t.length;s++){var r=t[s];if(r.proxies)for(var a=0;a<r.proxies.length;a++)if(null!=r.proxies[a]){var l=r.proxies[a].originalEp.element;(l===e||n.isElementDescendant(l,e))&&n._expandConnection(r,o,i)}}};o(i.connections.source.slice(),0),o(i.connections.target.slice(),1)}i.remove(e,null,t);var s=n.instance.getManagedElements()[n.instance.getId(e)];s&&delete s.group},s=arguments.length,r=new Array(s>2?s-2:0),a=2;a<s;a++)r[a-2]=arguments[a];ve(r,o)}}},{key:"getAncestors",value:function(e){for(var t=[],n=e.group;null!=n;)t.push(n),n=n.group;return t}},{key:"isAncestor",value:function(e,t){return null!=e&&null!=t&&-1!==this.getAncestors(e).indexOf(t)}},{key:"getDescendants",value:function(e){var t=[];return function e(n){var i=n.getGroups();t.push.apply(t,te(i)),ve(i,e)}(e),t}},{key:"isDescendant",value:function(e,t){return null!=e&&null!=t&&-1!==this.getDescendants(t).indexOf(e)}},{key:"reset",value:function(){this._connectionSourceMap={},this._connectionTargetMap={},this.groupMap={}}}]),e}(),Bs=function(){function e(t,n){V(this,e),this.instance=t,this.entries=n}return U(e,[{key:"length",get:function(){return this.entries.length}},{key:"each",value:function(e){return ve(this.entries,(function(t){return e(t)})),this}},{key:"get",value:function(e){return this.entries[e]}},{key:"addClass",value:function(e,t){return this.each((function(n){return n.addClass(e,t)})),this}},{key:"removeClass",value:function(e,t){return this.each((function(n){return n.removeClass(e,t)})),this}},{key:"removeAllOverlays",value:function(){return this.each((function(e){return e.removeAllOverlays()})),this}},{key:"setLabel",value:function(e){return this.each((function(t){return t.setLabel(e)})),this}},{key:"clear",value:function(){return this.entries.length=0,this}},{key:"map",value:function(e){var t=[];return this.each((function(n){return t.push(e(n))})),t}},{key:"addOverlay",value:function(e){return this.each((function(t){return t.addOverlay(e)})),this}},{key:"removeOverlay",value:function(e){return this.each((function(t){return t.removeOverlay(e)})),this}},{key:"removeOverlays",value:function(){return this.each((function(e){return e.removeOverlays()})),this}},{key:"showOverlay",value:function(e){return this.each((function(t){return t.showOverlay(e)})),this}},{key:"hideOverlay",value:function(e){return this.each((function(t){return t.hideOverlay(e)})),this}},{key:"setPaintStyle",value:function(e){return this.each((function(t){return t.setPaintStyle(e)})),this}},{key:"setHoverPaintStyle",value:function(e){return this.each((function(t){return t.setHoverPaintStyle(e)})),this}},{key:"setSuspendEvents",value:function(e){return this.each((function(t){return t.setSuspendEvents(e)})),this}},{key:"setParameter",value:function(e,t){return this.each((function(n){return n.parameters[e]=t})),this}},{key:"setParameters",value:function(e){return this.each((function(t){return t.parameters=e})),this}},{key:"setVisible",value:function(e){return this.each((function(t){return t.setVisible(e)})),this}},{key:"addType",value:function(e){return this.each((function(t){return t.addType(e)})),this}},{key:"toggleType",value:function(e){return this.each((function(t){return t.toggleType(e)})),this}},{key:"removeType",value:function(e){return this.each((function(t){return t.removeType(e)})),this}},{key:"bind",value:function(e,t){return this.each((function(n){return n.bind(e,t)})),this}},{key:"unbind",value:function(e,t){return this.each((function(n){return n.unbind(e,t)})),this}},{key:"setHover",value:function(e){var t=this;return this.each((function(n){return t.instance.setHover(n,e)})),this}}]),e}(),Vs=function(e){X(n,e);var t=K(n);function n(){return V(this,n),t.apply(this,arguments)}return U(n,[{key:"setEnabled",value:function(e){return this.each((function(t){return t.enabled=e})),this}},{key:"setAnchor",value:function(e){return this.each((function(t){return t.setAnchor(e)})),this}},{key:"deleteEveryConnection",value:function(){return this.each((function(e){return e.deleteEveryConnection()})),this}},{key:"deleteAll",value:function(){var e=this;return this.each((function(t){return e.instance.deleteEndpoint(t)})),this.clear(),this}}]),n}(Bs),zs=function(e){X(n,e);var t=K(n);function n(){return V(this,n),t.apply(this,arguments)}return U(n,[{key:"setDetachable",value:function(e){return this.each((function(t){return t.setDetachable(e)})),this}},{key:"setReattach",value:function(e){return this.each((function(t){return t.setReattach(e)})),this}},{key:"setConnector",value:function(e){return this.each((function(t){return t._setConnector(e)})),this}},{key:"deleteAll",value:function(){var e=this;this.each((function(t){return e.instance.deleteConnection(t)})),this.clear()}},{key:"repaint",value:function(){var e=this;return this.each((function(t){return e.instance._paintConnection(t)})),this}}]),n}(Bs),Us=function e(){V(this,e),Y(this,"affectedElements",new Set)};function Ys(){return{x:0,y:0,w:0,h:0,r:0,c:{x:0,y:0},x2:0,y2:0,t:{x:0,y:0,c:{x:0,y:0},w:0,h:0,r:0,x2:0,y2:0,cr:0,sr:0},dirty:!0}}var Xs=function(e,t){var n=0;return t[1]>e[1]?n=-1:t[1]<e[1]&&(n=1),n},Ws=function(e,t){return-1*Xs(e,t)};function qs(e,t,n,i){!function(e,t,n,i){if(0===t.length)t.push(e);else{for(var o=i?-1:1,s=0,r=t.length,a=Math.floor((s+r)/2);r>s;)n(e,t[a])*o<0?r=a:s=a+1,a=Math.floor((s+r)/2);t.splice(a,0,e)}}([e,t],n,Xs,i)}function Zs(e,t){var n=ge(t,(function(t){return t[0]===e}));n>-1&&t.splice(n,1)}var Js,Ks=function(e){X(n,e);var t=K(n);function n(e){var i;return V(this,n),(i=t.call(this)).instance=e,Y(Z(i),"_currentTransaction",null),Y(Z(i),"_sortedElements",{xmin:[],xmax:[],ymin:[],ymax:[]}),Y(Z(i),"_elementMap",new Map),Y(Z(i),"_transformedElementMap",new Map),Y(Z(i),"_bounds",{minx:0,maxx:0,miny:0,maxy:0}),i}return U(n,[{key:"_updateBounds",value:function(e,t,n){null!=t&&(Zs(e,this._sortedElements.xmin),Zs(e,this._sortedElements.xmax),Zs(e,this._sortedElements.ymin),Zs(e,this._sortedElements.ymax),qs(e,t.t.x,this._sortedElements.xmin,!1),qs(e,t.t.x+t.t.w,this._sortedElements.xmax,!0),qs(e,t.t.y,this._sortedElements.ymin,!1),qs(e,t.t.y+t.t.h,this._sortedElements.ymax,!0),!0!==n&&this._recalculateBounds())}},{key:"_recalculateBounds",value:function(){this._bounds.minx=this._sortedElements.xmin.length>0?this._sortedElements.xmin[0][1]:0,this._bounds.maxx=this._sortedElements.xmax.length>0?this._sortedElements.xmax[0][1]:0,this._bounds.miny=this._sortedElements.ymin.length>0?this._sortedElements.ymin[0][1]:0,this._bounds.maxy=this._sortedElements.ymax.length>0?this._sortedElements.ymax[0][1]:0}},{key:"recomputeBounds",value:function(){var e=this;this._sortedElements.xmin.length=0,this._sortedElements.xmax.length=0,this._sortedElements.ymin.length=0,this._sortedElements.ymax.length=0,this._elementMap.forEach((function(t,n){e._sortedElements.xmin.push([n,t.t.x]),e._sortedElements.xmax.push([n,t.t.x+t.t.w]),e._sortedElements.ymin.push([n,t.t.y]),e._sortedElements.ymax.push([n,t.t.y+t.t.h])})),this._sortedElements.xmin.sort(Xs),this._sortedElements.ymin.sort(Xs),this._sortedElements.xmax.sort(Ws),this._sortedElements.ymax.sort(Ws),this._recalculateBounds()}},{key:"_finaliseUpdate",value:function(e,t,n){var i,o,s,r,a,l,c,u,h,d,p,f,v,g,y,m,_,x,b;t.t=(i=t.x,o=t.y,s=t.w,r=t.h,a=t.r,l=i+s/2,c=o+r/2,u=Math.cos(a/360*Math.PI*2),h=Math.sin(a/360*Math.PI*2),p=(d=function(e,t){return{x:l+Math.round((e-l)*u-(t-c)*h),y:c+Math.round((t-c)*u-(e-l)*h)}})(i,o),f=d(i+s,o),v=d(i+s,o+r),g=d(i,o+r),y=d(i+s/2,o+r/2),m=Math.min(p.x,f.x,v.x,g.x),_=Math.max(p.x,f.x,v.x,g.x),x=Math.min(p.y,f.y,v.y,g.y),b=Math.max(p.y,f.y,v.y,g.y),{x:m,y:x,w:_-m,h:b-x,c:y,r:a,x2:_,y2:b,cr:u,sr:h}),this._transformedElementMap.set(e,t.t),!0!==n&&this._updateBounds(e,t,n)}},{key:"shouldFireEvent",value:function(e,t,n){return!0}},{key:"startTransaction",value:function(){if(null!=this._currentTransaction)throw new Error("Viewport: cannot start transaction; a transaction is currently active.");this._currentTransaction=new Us}},{key:"endTransaction",value:function(){var e=this;null!=this._currentTransaction&&(this._currentTransaction.affectedElements.forEach((function(t){var n=e.getPosition(t);e._finaliseUpdate(t,n,!0)})),this.recomputeBounds(),this._currentTransaction=null)}},{key:"updateElements",value:function(e){var t=this;ve(e,(function(e){return t.updateElement(e.id,e.x,e.y,e.width,e.height,e.rotation)}))}},{key:"updateElement",value:function(e,t,n,i,o,s,r){var a=Ie(this._elementMap,e,Ys);return a.dirty=null==t&&null==a.x||null==n&&null==a.y||null==i&&null==a.w||null==o&&null==a.h,null!=t&&(a.x=t),null!=n&&(a.y=n),null!=i&&(a.w=i),null!=o&&(a.h=o),null!=s&&(a.r=s||0),a.c.x=a.x+a.w/2,a.c.y=a.y+a.h/2,a.x2=a.x+a.w,a.y2=a.y+a.h,null==this._currentTransaction?this._finaliseUpdate(e,a,r):this._currentTransaction.affectedElements.add(e),a}},{key:"refreshElement",value:function(e,t){var n=this.instance.getManagedElements(),i=n[e]?n[e].el:null;if(null!=i){var o=this.getSize(i),s=this.getOffset(i);return this.updateElement(e,s.x,s.y,o.w,o.h,null,t)}return null}},{key:"getSize",value:function(e){return this.instance.getSize(e)}},{key:"getOffset",value:function(e){return this.instance.getOffset(e)}},{key:"registerElement",value:function(e,t){return this.updateElement(e,0,0,0,0,0,t)}},{key:"addElement",value:function(e,t,n,i,o,s){return this.updateElement(e,t,n,i,o,s)}},{key:"rotateElement",value:function(e,t){var n=Ie(this._elementMap,e,Ys);return n.r=t||0,this._finaliseUpdate(e,n),n}},{key:"getBoundsWidth",value:function(){return this._bounds.maxx-this._bounds.minx}},{key:"getBoundsHeight",value:function(){return this._bounds.maxy-this._bounds.miny}},{key:"getX",value:function(){return this._bounds.minx}},{key:"getY",value:function(){return this._bounds.miny}},{key:"setSize",value:function(e,t,n){if(this._elementMap.has(e))return this.updateElement(e,null,null,t,n,null)}},{key:"setPosition",value:function(e,t,n){if(this._elementMap.has(e))return this.updateElement(e,t,n,null,null,null)}},{key:"reset",value:function(){this._sortedElements.xmin.length=0,this._sortedElements.xmax.length=0,this._sortedElements.ymin.length=0,this._sortedElements.ymax.length=0,this._elementMap.clear(),this._transformedElementMap.clear(),this._recalculateBounds()}},{key:"remove",value:function(e){Zs(e,this._sortedElements.xmin),Zs(e,this._sortedElements.xmax),Zs(e,this._sortedElements.ymin),Zs(e,this._sortedElements.ymax),this._elementMap.delete(e),this._transformedElementMap.delete(e),this._recalculateBounds()}},{key:"getPosition",value:function(e){return this._elementMap.get(e)}},{key:"getElements",value:function(){return this._elementMap}},{key:"isEmpty",value:function(){return 0===this._elementMap.size}}]),n}(es);function Qs(e,t){return t.theta-e.theta}function er(e,t){return(e.theta<0?-Math.PI-e.theta:Math.PI-e.theta)-(t.theta<0?-Math.PI-t.theta:Math.PI-t.theta)}var tr=(Y(Js={},go,er),Y(Js,mo,Qs),Y(Js,_o,Qs),Y(Js,yo,er),Js);function nr(e){return!0===e.isContinuous}function ir(e){return!0===e.isContinuous}function or(e){return e.locations.length>1}function sr(e){return[e.currentLocation,e.locations[e.currentLocation]]}var rr=function(){function e(t){var n=this;V(this,e),this.instance=t,Y(this,"anchorLists",new Map),Y(this,"anchorLocations",new Map),t.bind(bt,(function(e){e.sourceEndpoint._anchor.isContinuous&&n._removeEndpointFromAnchorLists(e.sourceEndpoint),e.targetEndpoint._anchor.isContinuous&&n._removeEndpointFromAnchorLists(e.targetEndpoint)})),t.bind(xt,(function(e){n._removeEndpointFromAnchorLists(e)}))}return U(e,[{key:"getAnchorOrientation",value:function(e){var t=this.anchorLocations.get(e.id);return t?[t.ox,t.oy]:[0,0]}},{key:"_distance",value:function(e,t,n,i,o,s,r){var a=i.x+e.x*o.w,l=i.y+e.y*o.h,c=i.x+o.w/2,u=i.y+o.h/2;if(null!=s&&s.length>0){var h=this.instance._applyRotations([a,l,0,0],s);a=h.x,l=h.y}return Math.sqrt(Math.pow(t-a,2)+Math.pow(n-l,2))+Math.sqrt(Math.pow(c-a,2)+Math.pow(u-l,2))}},{key:"_anchorSelector",value:function(e,t,n,i,o,s,r){for(var a=n.x+i.w/2,l=n.y+i.h/2,c=-1,u=1/0,h=0;h<r.length;h++){var d=this._distance(r[h],a,l,e,t,o,s);d<u&&(c=h+0,u=d)}return[c,r[c]]}},{key:"_floatingAnchorCompute",value:function(e,t){var n=t.xy,i={curX:n.x+e.size.w/2,curY:n.y+e.size.h/2,x:0,y:0,ox:0,oy:0};return this._setComputedPosition(e,i)}},{key:"_setComputedPosition",value:function(e,t,n){return this.anchorLocations.set(e.id,t),e.computedPosition=t,n&&(e.timestamp=n),t}},{key:"_computeSingleLocation",value:function(e,t,n,i){var o,s=i.rotation,r={curX:t.x+e.x*n.w+e.offx,curY:t.y+e.y*n.h+e.offy,x:e.x,y:e.y,ox:0,oy:0};if(null!=s&&s.length>0){var a=[e.iox,e.ioy],l={x:r.curX,y:r.curY,cr:0,sr:0};ve(s,(function(e){l=Ae(l,e.c,e.r);var t=[Math.round(a[0]*l.cr-a[1]*l.sr),Math.round(a[1]*l.cr+a[0]*l.sr)];a=t.slice()})),e.ox=a[0],e.oy=a[1],o={curX:l.x,curY:l.y,x:e.x,y:e.y,ox:a[0],oy:a[1]}}else e.ox=e.iox,e.oy=e.ioy,o=se({ox:e.iox,oy:e.ioy},r);return o}},{key:"_singleAnchorCompute",value:function(e,t){var n=t.xy,i=t.wh,o=t.timestamp,s=this.anchorLocations.get(e.id);if(null!=s&&o&&o===e.timestamp)return s;var r=ee(sr(e),2);r[0];var a=r[1];return s=this._computeSingleLocation(a,n,i,t),this._setComputedPosition(e,s,o)}},{key:"_defaultAnchorCompute",value:function(e,t){var n;if(1===e.locations.length)return this._singleAnchorCompute(e,t);var i=t.xy,o=t.wh,s=t.txy,r=t.twh,a=ee(sr(e),2),l=a[0],c=a[1];if(e.locked||null==s||null==r)n=this._computeSingleLocation(c,i,o,t);else{var u=ee(this._anchorSelector(i,o,s,r,t.rotation,t.tRotation,e.locations),2),h=u[0],d=u[1];e.currentLocation=h,h!==l&&(e.cssClass=d.cls||e.cssClass,t.element._anchorLocationChanged(e)),n=this._computeSingleLocation(d,i,o,t)}return this._setComputedPosition(e,n,t.timestamp)}},{key:"_placeAnchors",value:function(e,t){var n=this,i=this.instance.viewport.getPosition(e),o=function(t,o,s,r,a,l){if(s.length>0)for(var c=s.sort(tr[t]),u=function(e,t,n,i,o){for(var s=n?e.w:e.h,r=n?e.h:e.w,a=[],l=s/(t.length+1),c=0;c<t.length;c++){var u=(c+1)*l,h=i*r;o&&(u=s-u);var d=n?u:h,p=e.x+d,f=d/e.w,v=n?h:u,g=e.y+v,y=v/e.h;if(0!==e.r&&null!=e.r){var m=Ae({x:p,y:g},e.c,e.r);p=m.x,g=m.y}a.push({x:p,y:g,xLoc:f,yLoc:y,c:t[c].c})}return a}(i,c,r,a,t===mo||t===go),h=0;h<u.length;h++){var d=u[h].c,p=d.endpoints[0].elementId===e?d.endpoints[0]:d.endpoints[1];n._setComputedPosition(p._anchor,{curX:u[h].x,curY:u[h].y,x:u[h].xLoc,y:u[h].yLoc,ox:l[0],oy:l[1]})}};o(_o,0,t.bottom,!0,1,[0,1]),o(go,0,t.top,!0,0,[0,-1]),o(yo,0,t.left,!1,0,[-1,0]),o(mo,0,t.right,!1,1,[1,0])}},{key:"_updateAnchorList",value:function(e,t,n,i,o,s,r,a,l,c,u){var h,d=i.endpoints[r],p=d.id,f=[1,0][r],v={theta:t,order:n,c:i,b:o,elId:s,epId:p},g=e[l],y=d._continuousAnchorEdge?e[d._continuousAnchorEdge]:null;if(y){var m=ge(y,(function(e){return e.epId===p}));if(-1!==m){y.splice(m,1);for(var _=0;_<y.length;_++)!0!==(h=y[_].c).placeholder&&c.add(h),u.add(y[_].c.endpoints[r]),u.add(y[_].c.endpoints[f])}}for(var x=0;x<g.length;x++)!0!==(h=g[x].c).placeholder&&c.add(h),u.add(g[x].c.endpoints[r]),u.add(g[x].c.endpoints[f]);var b=a?0:g.length;g.splice(b,0,v),d._continuousAnchorEdge=l}},{key:"_removeEndpointFromAnchorLists",value:function(e){var t=this.anchorLists.get(e.elementId),n=0;!function(e,t){if(e){var i=function(e){return e.epId===t};_e(e.top,i),_e(e.left,i),_e(e.bottom,i),_e(e.right,i),n+=e.top.length,n+=e.left.length,n+=e.bottom.length,n+=e.right.length}}(t,e.id),0===n&&this.anchorLists.delete(e.elementId),this.anchorLocations.delete(e._anchor.id)}},{key:"computeAnchorLocation",value:function(e,t){var n;return n=nr(e)?this.anchorLocations.get(e.id)||{curX:0,curY:0,x:0,y:0,ox:0,oy:0}:ir(e)?this._floatingAnchorCompute(e,t):this._defaultAnchorCompute(e,t),e.timestamp=t.timestamp,n}},{key:"computePath",value:function(e,t){var n=this.instance.viewport.getPosition(e.sourceId),i=this.instance.viewport.getPosition(e.targetId),o=e.endpoints[0],s=e.endpoints[1],r=this.getEndpointLocation(o,{xy:n,wh:n,element:o,timestamp:t,rotation:this.instance._getRotations(e.sourceId)}),a=this.getEndpointLocation(s,{xy:i,wh:i,element:s,timestamp:t,rotation:this.instance._getRotations(e.targetId)});e.connector.resetBounds(),e.connector.compute({sourcePos:r,targetPos:a,sourceEndpoint:e.endpoints[0],targetEndpoint:e.endpoints[1],strokeWidth:e.paintStyleInUse.strokeWidth,sourceInfo:n,targetInfo:i})}},{key:"getEndpointLocation",value:function(e,t){t=t||{};var n=e._anchor,i=this.anchorLocations.get(n.id);return(null==i||null!=t.timestamp&&n.timestamp!==t.timestamp)&&(i=this.computeAnchorLocation(n,t),this._setComputedPosition(n,i,t.timestamp)),i}},{key:"getEndpointOrientation",value:function(e){return e._anchor?this.getAnchorOrientation(e._anchor):[0,0]}},{key:"setAnchorOrientation",value:function(e,t){var n=this.anchorLocations.get(e.id);null!=n&&(n.ox=t[0],n.oy=t[1])}},{key:"isDynamicAnchor",value:function(e){return!!e._anchor&&(!nr(e._anchor)&&e._anchor.locations.length>1)}},{key:"isFloating",value:function(e){return!!e._anchor&&ir(e._anchor)}},{key:"prepareAnchor",value:function(e){return $o(e)}},{key:"redraw",value:function(e,t,n){var i=this,o=new Set,s=new Set,r=new Set;if(!this.instance._suspendDrawing){var a=this.instance.endpointsByElement[e]||[];t=t||we();for(var l,c,u={},h=0;h<a.length;h++)if(!1!==(c=a[h]).visible)if(s.add(c),l=c._anchor,0===c.connections.length)nr(l)&&(this.anchorLists.has(e)||this.anchorLists.set(e,{top:[],right:[],bottom:[],left:[]}),this._updateAnchorList(this.anchorLists.get(e),-Math.PI/2,0,{endpoints:[c,c],placeholder:!0},!1,e,0,!1,Po(l),o,s),r.add(e));else for(var d=0;d<c.connections.length;d++){var p=c.connections[d],f=p.sourceId,v=p.targetId,g=nr(p.endpoints[0]._anchor),y=nr(p.endpoints[1]._anchor);if(g||y){var m=[f,(p.endpoints[0]._anchor.faces||[]).join("-"),v,(p.endpoints[1]._anchor.faces||[]).join("-")].join("-"),_=u[m],x=p.sourceId===e?1:0;g&&!this.anchorLists.has(f)&&this.anchorLists.set(f,{top:[],right:[],bottom:[],left:[]}),y&&!this.anchorLists.has(v)&&this.anchorLists.set(v,{top:[],right:[],bottom:[],left:[]});var b=this.instance.viewport.getPosition(v),k=this.instance.viewport.getPosition(f);if(v===f&&(g||y))this._updateAnchorList(this.anchorLists.get(f),-Math.PI/2,0,p,!1,v,0,!1,go,o,s),this._updateAnchorList(this.anchorLists.get(v),-Math.PI/2,0,p,!1,f,1,!1,go,o,s);else{var C=this.instance._getRotations(f),E=this.instance._getRotations(v);_||(_=this._calculateOrientation(f,v,k,b,p.endpoints[0]._anchor,p.endpoints[1]._anchor,C,E),u[m]=_),g&&this._updateAnchorList(this.anchorLists.get(f),_.theta,0,p,!1,v,0,!1,_.a[0],o,s),y&&this._updateAnchorList(this.anchorLists.get(v),_.theta2,-1,p,!0,f,1,!0,_.a[1],o,s)}g&&r.add(f),y&&r.add(v),o.add(p),(g&&0===x||y&&1===x)&&s.add(p.endpoints[x])}else{var S=c.connections[d].endpoints[p.sourceId===e?1:0];if(or(S._anchor)){this.instance._paintEndpoint(S,{elementWithPrecedence:e,timestamp:t}),o.add(c.connections[d]);for(var P=0;P<S.connections.length;P++)S.connections[P]!==c.connections[d]&&o.add(S.connections[P])}else o.add(c.connections[d])}}r.forEach((function(e){i._placeAnchors(e,i.anchorLists.get(e))})),s.forEach((function(e){var n=i.instance.viewport.getPosition(e.elementId);i.instance._paintEndpoint(e,{timestamp:t,offset:n})})),o.forEach((function(e){i.instance._paintConnection(e,{timestamp:t})}))}return{c:o,e:s}}},{key:"reset",value:function(){this.anchorLocations.clear(),this.anchorLists.clear()}},{key:"setAnchor",value:function(e,t){null!=t&&(e._anchor=t)}},{key:"setConnectionAnchors",value:function(e,t){e.endpoints[0]._anchor=t[0],e.endpoints[1]._anchor=t[1]}},{key:"_calculateOrientation",value:function(e,t,n,i,o,s,r,a){var l=this;if(e===t)return{orientation:"identity",a:[go,go]};var c=Math.atan2(i.c.y-n.c.y,i.c.x-n.c.x),u=Math.atan2(n.c.y-i.c.y,n.c.x-i.c.x),h=[],d={};!function(e,t){for(var n=0;n<e.length;n++){var i;if(d[e[n]]=(Y(i={},yo,{x:t[n][0].x,y:t[n][0].c.y}),Y(i,mo,{x:t[n][0].x+t[n][0].w,y:t[n][0].c.y}),Y(i,go,{x:t[n][0].c.x,y:t[n][0].y}),Y(i,_o,{x:t[n][0].c.x,y:t[n][0].y+t[n][0].h}),i),null!=t[n][1]&&t[n][1].length>0)for(var o in d[e[n]])d[e[n]][o]=l.instance._applyRotationsXY(d[e[n]][o],t[n][1])}}([Qe,et],[[n,r],[i,a]]);for(var p=[go,yo,mo,_o],f=0;f<p.length;f++)for(var v=0;v<p.length;v++)h.push({source:p[f],target:p[v],dist:Ci(d.source[p[f]],d.target[p[v]])});h.sort((function(e,t){if(e.dist<t.dist)return-1;if(t.dist<e.dist)return 1;var n,i=(Y(n={},yo,0),Y(n,go,1),Y(n,mo,2),Y(n,_o,3),n),o=i[e.source],s=i[t.source],r=i[e.target],a=i[t.target];return o<s?-1:s<o?1:r<a?-1:a<r?1:0}));for(var g=h[0].source,y=h[0].target,m=0;m<h.length&&(g=nr(o)&&o.locked?o.currentFace:!o.isContinuous||Ao(o,h[m].source)?h[m].source:null,y=s.isContinuous&&s.locked?s.currentFace:!s.isContinuous||Ao(s,h[m].target)?h[m].target:null,null==g||null==y);m++);return o.isContinuous&&this.setCurrentFace(o,g),s.isContinuous&&this.setCurrentFace(s,y),{a:[g,y],theta:c,theta2:u}}},{key:"setCurrentFace",value:function(e,t,n){e.currentFace=t,n&&null!=e.lockedFace&&(e.lockedFace=e.currentFace)}},{key:"lock",value:function(e){e.locked=!0,nr(e)&&(e.lockedFace=e.currentFace)}},{key:"unlock",value:function(e){e.locked=!1,nr(e)&&(e.lockedFace=null)}},{key:"selectAnchorLocation",value:function(e,t){var n=ge(e.locations,(function(e){return e.x===t.x&&e.y===t.y}));return-1!==n&&(e.currentLocation=n,!0)}},{key:"lockCurrentAxis",value:function(e){null!=e.currentFace&&(e.lockedAxis=e.currentFace===yo||e.currentFace===mo?xo:bo)}},{key:"unlockCurrentAxis",value:function(e){e.lockedAxis=null}},{key:"anchorsEqual",value:function(e,t){if(!e||!t)return!1;var n=e.locations[e.currentLocation],i=t.locations[t.currentLocation];return n.x===i.x&&n.y===i.y&&n.offx===i.offx&&n.offy===i.offy&&n.ox===i.ox&&n.oy===i.oy}}]),e}(),ar={},lr=function(e,t,n){var i=ar[t];if(i)return new i(e,n);throw{message:"jsPlumb: unknown connector type '"+t+"'"}},cr=function(e,t){ar[e]=t},ur=function(e){X(n,e);var t=K(n);function n(e){var i;return V(this,n),Y(Z(i=t.call(this,e)),"length",void 0),Y(Z(i),"m",void 0),Y(Z(i),"m2",void 0),Y(Z(i),"type",n.segmentType),i._setCoordinates({x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2}),i}return U(n,[{key:"getPath",value:function(e){return(e?"M "+this.x1+" "+this.y1+" ":"")+"L "+this.x2+" "+this.y2}},{key:"_recalc",value:function(){this.length=Math.sqrt(Math.pow(this.x2-this.x1,2)+Math.pow(this.y2-this.y1,2)),this.m=ki({x:this.x1,y:this.y1},{x:this.x2,y:this.y2}),this.m2=-1/this.m,this.extents={xmin:Math.min(this.x1,this.x2),ymin:Math.min(this.y1,this.y2),xmax:Math.max(this.x1,this.x2),ymax:Math.max(this.y1,this.y2)}}},{key:"getLength",value:function(){return this.length}},{key:"getGradient",value:function(){return this.m}},{key:"_setCoordinates",value:function(e){this.x1=e.x1,this.y1=e.y1,this.x2=e.x2,this.y2=e.y2,this._recalc()}},{key:"pointOnPath",value:function(e,t){if(0!==e||t){if(1!==e||t){var n=t?e>0?e:this.length+e:e*this.length;return Pi({x:this.x1,y:this.y1},{x:this.x2,y:this.y2},n)}return{x:this.x2,y:this.y2}}return{x:this.x1,y:this.y1}}},{key:"gradientAtPoint",value:function(e,t){return this.m}},{key:"pointAlongPathFrom",value:function(e,t,n){var i=this.pointOnPath(e,n),o=t<=0?{x:this.x1,y:this.y1}:{x:this.x2,y:this.y2};return t<=0&&Math.abs(t)>1&&(t*=-1),Pi(i,o,t)}},{key:"within",value:function(e,t,n){return n>=Math.min(e,t)&&n<=Math.max(e,t)}},{key:"closest",value:function(e,t,n){return Math.abs(n-e)<Math.abs(n-t)?e:t}},{key:"findClosestPointOnPath",value:function(e,t){var n={d:1/0,x:null,y:null,l:null,x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};if(0===this.m)n.y=this.y1,n.x=this.within(this.x1,this.x2,e)?e:this.closest(this.x1,this.x2,e);else if(this.m===1/0||this.m===-1/0)n.x=this.x1,n.y=this.within(this.y1,this.y2,t)?t:this.closest(this.y1,this.y2,t);else{var i=this.y1-this.m*this.x1,o=(t-this.m2*e-i)/(this.m-this.m2),s=this.m*o+i;n.x=this.within(this.x1,this.x2,o)?o:this.closest(this.x1,this.x2,o),n.y=this.within(this.y1,this.y2,s)?s:this.closest(this.y1,this.y2,s)}var r=Ci({x:n.x,y:n.y},{x:this.x1,y:this.y1});return n.d=Ci({x:e,y:t},n),n.l=r/length,n}},{key:"_pointLiesBetween",value:function(e,t,n){return n>t?t<=e&&e<=n:t>=e&&e>=n}},{key:"lineIntersection",value:function(e,t,n,i){var o=Math.abs(ki({x:e,y:t},{x:n,y:i})),s=Math.abs(this.m),r=s===1/0?this.x1:this.y1-s*this.x1,a=[],l=o===1/0?e:t-o*e;if(o!==s)if(o===1/0&&0===s)this._pointLiesBetween(e,this.x1,this.x2)&&this._pointLiesBetween(this.y1,t,i)&&a.push({x:e,y:this.y1});else if(0===o&&s===1/0)this._pointLiesBetween(t,this.y1,this.y2)&&this._pointLiesBetween(this.x1,e,n)&&a.push({x:this.x1,y:t});else{var c,u;o===1/0?(c=e,this._pointLiesBetween(c,this.x1,this.x2)&&(u=s*e+r,this._pointLiesBetween(u,t,i)&&a.push({x:c,y:u}))):0===o?(u=t,this._pointLiesBetween(u,this.y1,this.y2)&&(c=(t-r)/s,this._pointLiesBetween(c,e,n)&&a.push({x:c,y:u}))):(u=s*(c=(l-r)/(s-o))+r,this._pointLiesBetween(c,this.x1,this.x2)&&this._pointLiesBetween(u,this.y1,this.y2)&&a.push({x:c,y:u}))}return a}},{key:"boxIntersection",value:function(e,t,n,i){var o=[];return o.push.apply(o,this.lineIntersection(e,t,e+n,t)),o.push.apply(o,this.lineIntersection(e+n,t,e+n,t+i)),o.push.apply(o,this.lineIntersection(e+n,t+i,e,t+i)),o.push.apply(o,this.lineIntersection(e,t+i,e,t)),o}}]),n}(zn);Y(ur,"segmentType","Straight");var hr=function(e){X(n,e);var t=K(n);function n(){var e;V(this,n);for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return Y(Z(e=t.call.apply(t,[this].concat(o))),"type",n.type),e}return U(n,[{key:"getDefaultStubs",value:function(){return[0,0]}},{key:"_compute",value:function(e,t){this._addSegment(ur,{x1:e.sx,y1:e.sy,x2:e.startStubX,y2:e.startStubY}),this._addSegment(ur,{x1:e.startStubX,y1:e.startStubY,x2:e.endStubX,y2:e.endStubY}),this._addSegment(ur,{x1:e.endStubX,y1:e.endStubY,x2:e.tx,y2:e.ty}),this.geometry={source:t.sourcePos,target:t.targetPos}}},{key:"transformGeometry",value:function(e,t,n){return{source:this.transformAnchorPlacement(e.source,t,n),target:this.transformAnchorPlacement(e.target,t,n)}}}]),n}(As);function dr(e,t,n){var i=[],o=function(t){return ae(t)?t:e.getId(t)};if(t)if("string"==typeof t){if("*"===t)return t;i.push(t)}else{var s;if(n)i=t;else if(null!=t.length)(s=i).push.apply(s,te(te(t).map(o)));else i.push(o(t))}return i}function pr(e,t,n){null!=t&&(t.connections.push(e),1===t.connections.length&&e.instance.addClass(e.source,e.instance.connectedClass)),null!=n&&(null!=t&&e.sourceId===e.targetId||(n.connections.push(e),1===n.connections.length&&e.instance.addClass(e.target,e.instance.connectedClass)))}function fr(e,t,n){if(null!=t){var i=t.connections.length;_e(t.connections,(function(t){return e.id===t.id})),i>0&&0===t.connections.length&&e.instance.removeClass(e.source,e.instance.connectedClass)}if(null!=n){var o=n.connections.length;null!=t&&e.sourceId===e.targetId||_e(n.connections,(function(t){return e.id===t.id})),o>0&&0===n.connections.length&&e.instance.removeClass(e.target,e.instance.connectedClass)}}Y(hr,"type","Straight");var vr=function(e){X(n,e);var t=K(n);function n(e,i){var o;return V(this,n),(o=t.call(this))._instanceIndex=e,Y(Z(o),"defaults",void 0),Y(Z(o),"_initialDefaults",{}),Y(Z(o),"isConnectionBeingDragged",!1),Y(Z(o),"currentlyDragging",!1),Y(Z(o),"hoverSuspended",!1),Y(Z(o),"_suspendDrawing",!1),Y(Z(o),"_suspendedAt",null),Y(Z(o),"connectorClass",ht),Y(Z(o),"connectorOutlineClass","jtk-connector-outline"),Y(Z(o),"connectedClass","jtk-connected"),Y(Z(o),"endpointClass",dt),Y(Z(o),"endpointConnectedClass","jtk-endpoint-connected"),Y(Z(o),"endpointFullClass","jtk-endpoint-full"),Y(Z(o),"endpointFloatingClass",pt),Y(Z(o),"endpointDropAllowedClass","jtk-endpoint-drop-allowed"),Y(Z(o),"endpointDropForbiddenClass","jtk-endpoint-drop-forbidden"),Y(Z(o),"endpointAnchorClassPrefix","jtk-endpoint-anchor"),Y(Z(o),"overlayClass",gt),Y(Z(o),"connections",[]),Y(Z(o),"endpointsByElement",{}),Y(Z(o),"endpointsByUUID",new Map),Y(Z(o),"sourceSelectors",[]),Y(Z(o),"targetSelectors",[]),Y(Z(o),"allowNestedGroups",void 0),Y(Z(o),"_curIdStamp",1),Y(Z(o),"viewport",new Ks(Z(o))),Y(Z(o),"router",void 0),Y(Z(o),"groupManager",void 0),Y(Z(o),"_connectionTypes",new Map),Y(Z(o),"_endpointTypes",new Map),Y(Z(o),"_container",void 0),Y(Z(o),"_managedElements",{}),Y(Z(o),"DEFAULT_SCOPE",void 0),Y(Z(o),"_zoom",1),o.defaults={anchor:Pn.Bottom,anchors:[null,null],connectionsDetachable:!0,connectionOverlays:[],connector:hr.type,container:null,endpoint:Ns.type,endpointOverlays:[],endpoints:[null,null],endpointStyle:{fill:"#456"},endpointStyles:[null,null],endpointHoverStyle:null,endpointHoverStyles:[null,null],hoverPaintStyle:null,listStyle:{},maxConnections:1,paintStyle:{strokeWidth:2,stroke:"#456"},reattachConnections:!1,scope:"jsplumb_defaultscope",allowNestedGroups:!0},i&&se(o.defaults,i),se(o._initialDefaults,o.defaults),null!=o._initialDefaults.paintStyle&&(o._initialDefaults.paintStyle.strokeWidth=o._initialDefaults.paintStyle.strokeWidth||2),o.DEFAULT_SCOPE=o.defaults.scope,o.allowNestedGroups=!1!==o._initialDefaults.allowNestedGroups,o.router=new rr(Z(o)),o.groupManager=new Hs(Z(o)),o.setContainer(o._initialDefaults.container),o}return U(n,[{key:"defaultScope",get:function(){return this.DEFAULT_SCOPE}},{key:"currentZoom",get:function(){return this._zoom}},{key:"areDefaultAnchorsSet",value:function(){return this.validAnchorsSpec(this.defaults.anchors)}},{key:"validAnchorsSpec",value:function(e){return null!=e&&null!=e[0]&&null!=e[1]}},{key:"getContainer",value:function(){return this._container}},{key:"setZoom",value:function(e,t){return this._zoom=e,this.fire(Pt,this._zoom),t&&this.repaintEverything(),!0}},{key:"_idstamp",value:function(){return""+this._curIdStamp++}},{key:"checkCondition",value:function(e,t){var n=this.getListener(e),i=!0;if(n&&n.length>0){var o=Array.prototype.slice.call(arguments,1);try{for(var s=0,r=n.length;s<r;s++)i=i&&n[s].apply(n[s],o)}catch(t){Te("cannot check condition ["+e+"]"+t)}}return i}},{key:"getId",value:function(e,t){if(null==e)return null;var n=this.getAttribute(e,rt);return n&&"undefined"!==n||(2===arguments.length&&void 0!==arguments[1]?n=t:(1===arguments.length||3===arguments.length&&!arguments[2])&&(n="jsplumb-"+this._instanceIndex+"-"+this._idstamp()),this.setAttribute(e,rt,n)),n}},{key:"getConnections",value:function(e,t){e?e.constructor===String&&(e={scope:e}):e={};for(var n=dr(this,e.scope||this.defaultScope,!0),i=dr(this,e.source),o=dr(this,e.target),s=!t&&n.length>1?{}:[],r=function(e,i){if(!t&&n.length>1){var o=s[e];null==o&&(o=s[e]=[]),o.push(i)}else s.push(i)},a=0,l=this.connections.length;a<l;a++){var c=this.connections[a],u=c.proxies&&c.proxies[0]?c.proxies[0].originalEp.elementId:c.sourceId,h=c.proxies&&c.proxies[1]?c.proxies[1].originalEp.elementId:c.targetId;oe(n,c.scope)&&oe(i,u)&&oe(o,h)&&r(c.scope,c)}return s}},{key:"select",value:function(e){return(e=e||{}).scope=e.scope||"*",new zs(this,e.connections||this.getConnections(e,!0))}},{key:"selectEndpoints",value:function(e){(e=e||{}).scope=e.scope||qn;var t=!e.element&&!e.source&&!e.target,n=t?qn:dr(this,e.element),i=t?qn:dr(this,e.source),o=t?qn:dr(this,e.target),s=dr(this,e.scope,!0),r=[];for(var a in this.endpointsByElement){var l=oe(n,a,!0),c=oe(i,a,!0),u="*"!==i,h=oe(o,a,!0),d="*"!==o;if(l||c||h)e:for(var p=0,f=this.endpointsByElement[a].length;p<f;p++){var v=this.endpointsByElement[a][p];if(oe(s,v.scope,!0)){var g=u&&i.length>0&&!v.isSource,y=d&&o.length>0&&!v.isTarget;if(g||y)continue e;r.push(v)}}}return new Vs(this,r)}},{key:"setContainer",value:function(e){this._container=e,this.fire("container:change",this._container)}},{key:"_set",value:function(e,t,n){var i,o,s=[{el:"source",elId:"sourceId"},{el:"target",elId:"targetId"}][n],r=e[s.elId],a=e.endpoints[n],l={index:n,originalEndpoint:a,originalSourceId:0===n?r:e.sourceId,newSourceId:e.sourceId,originalTargetId:1===n?r:e.targetId,newTargetId:e.targetId,connection:e,newEndpoint:a};return t instanceof _s?(i=t).addConnection(e):i=(o=this.getId(t))===e[s.elId]?null:e.makeEndpoint(0===n,t,o),null!=i&&(l.newEndpoint=i,a.detachFromConnection(e),e.endpoints[n]=i,e[s.el]=i.element,e[s.elId]=i.elementId,l[0===n?"newSourceId":"newTargetId"]=i.elementId,this.fireMoveEvent(l),this._paintConnection(e)),l}},{key:"setSource",value:function(e,t){fr(e,this._managedElements[e.sourceId]);var n=this._set(e,t,0);pr(e,this._managedElements[n.newSourceId])}},{key:"setTarget",value:function(e,t){fr(e,this._managedElements[e.targetId]);var n=this._set(e,t,1);pr(e,this._managedElements[n.newTargetId])}},{key:"setConnectionType",value:function(e,t,n){e.setType(t,n),this._paintConnection(e)}},{key:"isHoverSuspended",value:function(){return this.hoverSuspended}},{key:"setSuspendDrawing",value:function(e,t){var n=this._suspendDrawing;return this._suspendDrawing=e,e?this._suspendedAt=""+(new Date).getTime():(this._suspendedAt=null,this.viewport.recomputeBounds()),t&&this.repaintEverything(),n}},{key:"getSuspendedAt",value:function(){return this._suspendedAt}},{key:"batch",value:function(e,t){var n=!0===this._suspendDrawing;n||this.setSuspendDrawing(!0),e(),n||this.setSuspendDrawing(!1,!t)}},{key:"each",value:function(e,t){if(null!=e){if(null!=e.length)for(var n=0;n<e.length;n++)t(e[n]);else t(e);return this}}},{key:"updateOffset",value:function(e){var t=e.elId;return e.recalc?this.viewport.refreshElement(t):this.viewport.getPosition(t)}},{key:"deleteConnection",value:function(e,t){if(null!=e&&!0!==e.deleted&&((t=t||{}).force||pe(!0,!1,[[e.endpoints[0],wt,[e]],[e.endpoints[1],wt,[e]],[e,wt,[e]],[this,ut,[Mt,e]]]))){fr(e,this._managedElements[e.sourceId],this._managedElements[e.targetId]),this.fireDetachEvent(e,!e.pending&&!1!==t.fireEvent,t.originalEvent);var n=e.endpoints[0],i=e.endpoints[1];return n!==t.endpointToIgnore&&n.detachFromConnection(e,null,!0),i!==t.endpointToIgnore&&i.detachFromConnection(e,null,!0),_e(this.connections,(function(t){return e.id===t.id})),e.destroy(),n!==t.endpointToIgnore&&n.deleteOnEmpty&&0===n.connections.length&&this.deleteEndpoint(n),i!==t.endpointToIgnore&&i.deleteOnEmpty&&0===i.connections.length&&this.deleteEndpoint(i),!0}return!1}},{key:"deleteEveryConnection",value:function(e){var t=this;e=e||{};var n=this.connections.length,i=0;return this.batch((function(){for(var o=0;o<n;o++)i+=t.deleteConnection(t.connections[0],e)?1:0})),i}},{key:"deleteConnectionsForElement",value:function(e,t){var n=this.getId(e),i=this._managedElements[n];if(i)for(var o=i.connections.length,s=0;s<o;s++)this.deleteConnection(i.connections[0],t);return this}},{key:"fireDetachEvent",value:function(e,t,n){var i=null!=e.id?{connection:e,source:e.source,target:e.target,sourceId:e.sourceId,targetId:e.targetId,sourceEndpoint:e.endpoints[0],targetEndpoint:e.endpoints[1]}:e;t&&this.fire("connection:detach",i,n),this.fire(bt,i,n)}},{key:"fireMoveEvent",value:function(e,t){this.fire(_t,e,t)}},{key:"manageAll",value:function(e,t){for(var n=ae(e)?this.getSelector(this.getContainer(),e):e,i=0;i<n.length;i++)this.manage(n[i],null,t)}},{key:"manage",value:function(e,t,n){null==this.getAttribute(e,rt)&&(t=t||this.getAttribute(e,"id")||we(),this.setAttribute(e,rt,t));var i=this.getId(e);if(this._managedElements[i])n&&(this._managedElements[i].viewportElement=this.updateOffset({elId:i,timestamp:null,recalc:!0}));else{var o={el:e,endpoints:[],connections:[],rotation:0,data:{}};this._managedElements[i]=o,this._suspendDrawing?o.viewportElement=this.viewport.registerElement(i,!0):o.viewportElement=this.updateOffset({elId:i,recalc:!0}),this.fire(kt,{el:e})}return this._managedElements[i]}},{key:"getManagedData",value:function(e,t,n){if(this._managedElements[e]){var i=this._managedElements[e].data[t];return null!=i?i[n]:null}}},{key:"setManagedData",value:function(e,t,n,i){this._managedElements[e]&&(this._managedElements[e].data[t]=this._managedElements[e].data[t]||{},this._managedElements[e].data[t][n]=i)}},{key:"getManagedElement",value:function(e){return this._managedElements[e]?this._managedElements[e].el:null}},{key:"unmanage",value:function(e,t){var n=this;this.removeAllEndpoints(e,!0);var i=function(e){var i=n.getId(e);n.removeAttribute(e,rt),delete n._managedElements[i],n.viewport.remove(i),n.fire(St,{el:e,id:i}),e&&t&&n._removeElement(e)};this._getAssociatedElements(e).map(i),i(e)}},{key:"rotate",value:function(e,t,n){var i=this.getId(e);return this._managedElements[i]&&(this._managedElements[i].rotation=t,this.viewport.rotateElement(i,t),!0!==n)?this.revalidate(e):{c:new Set,e:new Set}}},{key:"_getRotation",value:function(e){var t=this._managedElements[e];return null!=t&&t.rotation||0}},{key:"_getRotations",value:function(e){var t=this,n=[],i=this._managedElements[e];return null!=i&&(n.push({r:i.viewportElement.r||0,c:i.viewportElement.c}),function e(i){if(null!=i.group){var o=t._managedElements[i.group];null!=o&&(n.push({r:o.viewportElement.r,c:o.viewportElement.c}),e(o))}}(i)),n}},{key:"_applyRotations",value:function(e,t){var n=e.slice(),i={x:n[0],y:n[1],cr:0,sr:0};return ve(t,(function(e){i=Ae(i,e.c,e.r)})),i}},{key:"_applyRotationsXY",value:function(e,t){return ve(t,(function(t){e=Ae(e,t.c,t.r)})),e}},{key:"_internal_newEndpoint",value:function(e){var t=se({},e),n=this.manage(t.element);t.elementId=this.getId(t.element),t.id="ep_"+this._idstamp();var i=new _s(this,t);return function(e,t){null!=e&&e.endpoints.push(t)}(n,i),e.uuid&&this.endpointsByUUID.set(e.uuid,i),ke(this.endpointsByElement,i.elementId,i),this._suspendDrawing||this._paintEndpoint(i,{timestamp:this._suspendedAt}),i}},{key:"_deriveEndpointAndAnchorSpec",value:function(e,t){for(var n=((t?"":"default ")+e).split(/[\s]/),i=null,o=null,s=null,r=null,a=0;a<n.length;a++){var l=this.getConnectionType(n[a]);l&&(l.endpoints&&(i=l.endpoints),l.endpoint&&(o=l.endpoint),l.anchors&&(r=l.anchors),l.anchor&&(s=l.anchor))}return{endpoints:i||[o,o],anchors:r||[s,s]}}},{key:"revalidate",value:function(e,t){var n=this.getId(e);return this.updateOffset({elId:n,recalc:!0,timestamp:t}),this.repaint(e)}},{key:"repaintEverything",value:function(){var e,t=we();for(e in this._managedElements)this.viewport.refreshElement(e,!0);for(e in this.viewport.recomputeBounds(),this._managedElements)this.repaint(this._managedElements[e].el,t,!0);return this}},{key:"setElementPosition",value:function(e,t,n){var i=this.getId(e);return this.viewport.setPosition(i,t,n),this.repaint(e)}},{key:"repaint",value:function(e,t,n){var i={c:new Set,e:new Set},o=function(e){e.c.forEach((function(e){return i.c.add(e)})),e.e.forEach((function(e){return i.e.add(e)}))};if(!this._suspendDrawing){var s=this.getId(e);if(null!=e){var r=this._getAssociatedElements(e);if(null==t&&(t=we()),!n)for(var a=0;a<r.length;a++)this.updateOffset({elId:this.getId(r[a]),recalc:!0,timestamp:t});if(o(this.router.redraw(s,t,null)),r.length>0)for(var l=0;l<r.length;l++)o(this.router.redraw(this.getId(r[l]),t,null))}}return i}},{key:"unregisterEndpoint",value:function(e){var t=e.getUuid();t&&this.endpointsByUUID.delete(t),function(e,t){null!=e&&_e(e.endpoints,(function(e){return e===t}))}(this._managedElements[e.elementId],e);var n=this.endpointsByElement[e.elementId];null!=n&&(this.endpointsByElement[e.elementId]=n.filter((function(t){return t!==e}))),this.fire(xt,e)}},{key:"_maybePruneEndpoint",value:function(e){return!(!e.deleteOnEmpty||0!==e.connections.length)&&(this.deleteEndpoint(e),!0)}},{key:"deleteEndpoint",value:function(e){var t=this,n="string"==typeof e?this.endpointsByUUID.get(e):e;if(n){var i=n.proxiedBy,o=n.connections.slice();ve(o,(function(e){n.detachFromConnection(e,null,!0)})),this.unregisterEndpoint(n),n.destroy(),ve(o,(function(e){t.deleteConnection(e,{force:!0,endpointToIgnore:n})})),null!=i&&this.deleteEndpoint(i)}return this}},{key:"addEndpoint",value:function(e,t,n){var i=se({},n=n||{});se(i,t||{});var o=se({element:e},i);return this._internal_newEndpoint(o)}},{key:"addEndpoints",value:function(e,t,n){for(var i=[],o=0,s=t.length;o<s;o++)i.push(this.addEndpoint(e,t[o],n));return i}},{key:"reset",value:function(){var e=this;this.silently((function(){e.endpointsByElement={},e._managedElements={},e.endpointsByUUID.clear(),e.viewport.reset(),e.router.reset(),e.groupManager.reset(),e.connections.length=0}))}},{key:"destroy",value:function(){this.reset(),this.unbind(),this.sourceSelectors.length=0,this.targetSelectors.length=0,this._connectionTypes.clear(),this._endpointTypes.clear()}},{key:"getEndpoints",value:function(e){return this.endpointsByElement[this.getId(e)]||[]}},{key:"getEndpoint",value:function(e){return this.endpointsByUUID.get(e)}},{key:"setEndpointUuid",value:function(e,t){e.uuid&&this.endpointsByUUID.delete(e.uuid),e.uuid=t,this.endpointsByUUID.set(t,e)}},{key:"connect",value:function(e,t){try{var n=this._prepareConnectionParams(e,t),i=this._newConnection(n);return this._finaliseConnection(i,n),i}catch(e){return void Te(e)}}},{key:"_prepareConnectionParams",value:function(e,t){var n=se({},e);t&&se(n,t);var i=n;if(i.source&&i.source.endpoint&&(i.sourceEndpoint=i.source),i.target&&i.target.endpoint&&(i.targetEndpoint=i.target),e.uuids&&(i.sourceEndpoint=this.getEndpoint(e.uuids[0]),i.targetEndpoint=this.getEndpoint(e.uuids[1])),null!=i.sourceEndpoint){if(i.sourceEndpoint.isFull())throw"Cannot establish connection: source endpoint is full";if(i.type||(i.type=i.sourceEndpoint.edgeType),i.sourceEndpoint.connectorOverlays){i.overlays=i.overlays||[];for(var o=0,s=i.sourceEndpoint.connectorOverlays.length;o<s;o++)i.overlays.push(i.sourceEndpoint.connectorOverlays[o])}i.sourceEndpoint.scope&&(i.scope=i.sourceEndpoint.scope)}else if(null==i.source)throw"Cannot establish connection: source does not exist";if(null!=i.targetEndpoint){if(i.targetEndpoint.isFull())throw"Cannot establish connection: target endpoint is full"}else if(null==i.target)throw"Cannot establish connection: target does not exist";if(i.sourceEndpoint&&i.targetEndpoint&&!function(e,t){for(var n=e.scope.split(/\s/),i=t.scope.split(/\s/),o=0;o<n.length;o++)for(var s=0;s<i.length;s++)if(i[s]===n[o])return!0;return!1}(i.sourceEndpoint,i.targetEndpoint))throw"Cannot establish connection: scopes do not match";return i}},{key:"_newConnection",value:function(e){e.id="con_"+this._idstamp();var t=new Cs(this,e);return pr(t,this._managedElements[t.sourceId],this._managedElements[t.targetId]),this._paintConnection(t),t}},{key:"_finaliseConnection",value:function(e,t,n){t=t||{},e.suspendedEndpoint||this.connections.push(e),e.pending=null,e.endpoints[0].isTemporarySource=!1,this.repaint(e.source);var i={connection:e,source:e.source,target:e.target,sourceId:e.sourceId,targetId:e.targetId,sourceEndpoint:e.endpoints[0],targetEndpoint:e.endpoints[1]};this.fire(mt,i,n),t.doNotFireConnectionEvent||!1===t.fireEvent||this.fire(yt,i,n)}},{key:"removeAllEndpoints",value:function(e,t){var n=this,i=function(e){var t,i,o=n.getId(e),s=n.endpointsByElement[o];if(s)for(t=0,i=s.length;t<i;t++)n.deleteEndpoint(s[t]);delete n.endpointsByElement[o]};return t&&this._getAssociatedElements(e).map(i),i(e),this}},{key:"_createSourceDefinition",value:function(e,t){var n=se({},t);se(n,e),n.edgeType=n.edgeType||Yn;var i=this._deriveEndpointAndAnchorSpec(n.edgeType);n.endpoint=n.endpoint||i.endpoints[0],n.anchor=n.anchor||i.anchors[0];var o=n.maxConnections||-1;return{def:se({},n),uniqueEndpoint:n.uniqueEndpoint,maxConnections:o,enabled:!0,endpoint:null}}},{key:"addSourceSelector",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this._createSourceDefinition(t),o=new Uo(e,i,n);return this.sourceSelectors.push(o),o}},{key:"removeSourceSelector",value:function(e){_e(this.sourceSelectors,(function(t){return t===e}))}},{key:"removeTargetSelector",value:function(e){_e(this.targetSelectors,(function(t){return t===e}))}},{key:"addTargetSelector",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this._createTargetDefinition(t),o=new Uo(e,i,n);return this.targetSelectors.push(o),o}},{key:"_createTargetDefinition",value:function(e,t){var n=se({},t);se(n,e),n.edgeType=n.edgeType||Yn;var i=n.maxConnections||-1;return{def:se({},n),uniqueEndpoint:n.uniqueEndpoint,maxConnections:i,enabled:!0,endpoint:null}}},{key:"show",value:function(e,t){return this._setVisible(e,tt,t)}},{key:"hide",value:function(e,t){return this._setVisible(e,nt,t)}},{key:"_setVisible",value:function(e,t,n){var i=t===tt,o=null;n&&(o=function(e){e.setVisible(i,!0,!0)});var s=this.getId(e);return this._operation(e,(function(e){if(i&&n){var t=e.sourceId===s?1:0;e.endpoints[t].isVisible()&&e.setVisible(!0)}else e.setVisible(i)}),o),this}},{key:"toggleVisible",value:function(e,t){var n=null;t&&(n=function(e){var t=e.isVisible();e.setVisible(!t)}),this._operation(e,(function(e){var t=e.isVisible();e.setVisible(!t)}),n)}},{key:"_operation",value:function(e,t,n){var i=this.getId(e),o=this.endpointsByElement[i];if(o&&o.length)for(var s=0,r=o.length;s<r;s++){for(var a=0,l=o[s].connections.length;a<l;a++){if(t(o[s].connections[a]))return}n&&n(o[s])}}},{key:"registerConnectionType",value:function(e,t){if(this._connectionTypes.set(e,se({},t)),t.overlays){for(var n={},i=0;i<t.overlays.length;i++){var o=ts(t.overlays[i]);n[o.options.id]=o}this._connectionTypes.get(e).overlays=n}}},{key:"registerConnectionTypes",value:function(e){for(var t in e)this.registerConnectionType(t,e[t])}},{key:"registerEndpointType",value:function(e,t){if(this._endpointTypes.set(e,se({},t)),t.overlays){for(var n={},i=0;i<t.overlays.length;i++){var o=ts(t.overlays[i]);n[o.options.id]=o}this._endpointTypes.get(e).overlays=n}}},{key:"registerEndpointTypes",value:function(e){for(var t in e)this.registerEndpointType(t,e[t])}},{key:"getType",value:function(e,t){return"connection"===t?this.getConnectionType(e):this.getEndpointType(e)}},{key:"getConnectionType",value:function(e){return this._connectionTypes.get(e)}},{key:"getEndpointType",value:function(e){return this._endpointTypes.get(e)}},{key:"importDefaults",value:function(e){for(var t in e)this.defaults[t]=e[t];return null!=this.defaults.paintStyle&&(this.defaults.paintStyle.strokeWidth=this.defaults.paintStyle.strokeWidth||2),e.container&&this.setContainer(e.container),this}},{key:"restoreDefaults",value:function(){return this.defaults=se({},this._initialDefaults),this}},{key:"getManagedElements",value:function(){return this._managedElements}},{key:"proxyConnection",value:function(e,t,n,i,o){var s,r=null!=e.proxies[t],a=r?e.proxies[t].originalEp.elementId:e.endpoints[t].elementId,l=r?e.proxies[t].originalEp:e.endpoints[t],c=this.getId(n);e.proxies[t]?e.proxies[t].ep.elementId===c?s=e.proxies[t].ep:(e.proxies[t].ep.detachFromConnection(e,t),s=this._internal_newEndpoint({element:n,endpoint:i(e,t),anchor:o(e,t),parameters:{isProxyEndpoint:!0}})):s=this._internal_newEndpoint({element:n,endpoint:i(e,t),anchor:o(e,t),parameters:{isProxyEndpoint:!0}}),s.deleteOnEmpty=!0,e.proxies[t]={ep:s,originalEp:l},this.sourceOrTargetChanged(a,c,e,n,t),l.detachFromConnection(e,null,!0),s.connections=[e],e.endpoints[t]=s,l.proxiedBy=s,l.setVisible(!1),e.setVisible(!0),this.revalidate(n)}},{key:"unproxyConnection",value:function(e,t){if(null!=e.proxies&&null!=e.proxies[t]){var n=e.proxies[t].originalEp.element,i=e.proxies[t].originalEp.elementId,o=e.proxies[t].ep.elementId;e.endpoints[t]=e.proxies[t].originalEp,delete e.proxies[t].originalEp.proxiedBy,this.sourceOrTargetChanged(o,i,e,n,t),e.proxies[t].ep.detachFromConnection(e,null),e.proxies[t].originalEp.addConnection(e),e.isVisible()&&e.proxies[t].originalEp.setVisible(!0),e.proxies[t]=null,-1===ge(e.proxies,(function(e){return null!=e}))&&(e.proxies.length=0)}}},{key:"sourceOrTargetChanged",value:function(e,t,n,i,o){e!==t&&(0===o?(n.sourceId=t,n.source=i):1===o&&(n.targetId=t,n.target=i),fr(n,this._managedElements[e]),pr(n,this._managedElements[t]))}},{key:"getGroup",value:function(e){return this.groupManager.getGroup(e)}},{key:"getGroupFor",value:function(e){return this.groupManager.getGroupFor(e)}},{key:"addGroup",value:function(e){return this.groupManager.addGroup(e)}},{key:"addToGroup",value:function(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return(t=this.groupManager).addToGroup.apply(t,[e,!1].concat(i))}},{key:"collapseGroup",value:function(e){this.groupManager.collapseGroup(e)}},{key:"expandGroup",value:function(e){this.groupManager.expandGroup(e)}},{key:"toggleGroup",value:function(e){this.groupManager.toggleGroup(e)}},{key:"removeGroup",value:function(e,t,n,i){return this.groupManager.removeGroup(e,t,n,i)}},{key:"removeAllGroups",value:function(e,t){this.groupManager.removeAllGroups(e,t,!1)}},{key:"removeFromGroup",value:function(e,t,n){this.groupManager.removeFromGroup(e,n,t),this._appendElement(t,this.getContainer()),this.updateOffset({recalc:!0,elId:this.getId(t)})}},{key:"_paintEndpoint",value:function(e,t){var n=(t=t||{}).timestamp,i=!(!1===t.recalc);if(!n||e.timestamp!==n){var o=this.viewport.getPosition(e.elementId),s=t.offset?{x:t.offset.x,y:t.offset.y}:{x:o.x,y:o.y};if(null!=s){var r=t.anchorLoc;if(null==r){var a={xy:s,wh:o,element:e,timestamp:n};if(i&&this.router.isDynamicAnchor(e)&&e.connections.length>0){var l=function(e){var n=0;if(null!=t.elementWithPrecedence)for(var i=0;i<e.connections.length;i++)if(e.connections[i].sourceId===t.elementWithPrecedence||e.connections[i].targetId===t.elementWithPrecedence){n=i;break}return e.connections[n]}(e),c=l.endpoints[0]===e?1:0,u=0===c?l.sourceId:l.targetId,h=this.viewport.getPosition(u);a.index=0===c?1:0,a.connection=l,a.txy=h,a.twh=h,a.tElement=l.endpoints[c],a.tRotation=this._getRotations(u)}else e.connections.length>0&&(a.connection=e.connections[0]);a.rotation=this._getRotations(e.elementId),r=this.router.computeAnchorLocation(e._anchor,a)}for(var d in e.endpoint.compute(r,this.router.getEndpointOrientation(e),e.paintStyleInUse),this.renderEndpoint(e,e.paintStyleInUse),e.timestamp=n,e.overlays)if(e.overlays.hasOwnProperty(d)){var p=e.overlays[d];p.isVisible()&&(e.overlayPlacements[d]=this.drawOverlay(p,e.endpoint,e.paintStyleInUse,e.getAbsoluteOverlayPosition(p)),this._paintOverlay(p,e.overlayPlacements[d],{xmin:0,ymin:0}))}}}}},{key:"_paintConnection",value:function(e,t){if(!this._suspendDrawing&&!1!==e.visible){var n=(t=t||{}).timestamp;if(null!=n&&n===e.lastPaintedAt)return;if(null==n||n!==e.lastPaintedAt){this.router.computePath(e,n);var i={xmin:1/0,ymin:1/0,xmax:-1/0,ymax:-1/0};for(var o in e.overlays)if(e.overlays.hasOwnProperty(o)){var s=e.overlays[o];s.isVisible()&&(e.overlayPlacements[o]=this.drawOverlay(s,e.connector,e.paintStyleInUse,e.getAbsoluteOverlayPosition(s)),i.xmin=Math.min(i.xmin,e.overlayPlacements[o].xmin),i.xmax=Math.max(i.xmax,e.overlayPlacements[o].xmax),i.ymin=Math.min(i.ymin,e.overlayPlacements[o].ymin),i.ymax=Math.max(i.ymax,e.overlayPlacements[o].ymax))}var r=parseFloat(""+e.paintStyleInUse.strokeWidth||"1")/2,a=parseFloat(""+e.paintStyleInUse.strokeWidth||"0"),l={xmin:Math.min(e.connector.bounds.xmin-(r+a),i.xmin),ymin:Math.min(e.connector.bounds.ymin-(r+a),i.ymin),xmax:Math.max(e.connector.bounds.xmax+(r+a),i.xmax),ymax:Math.max(e.connector.bounds.ymax+(r+a),i.ymax)};for(var c in this.paintConnector(e.connector,e.paintStyleInUse,l),e.overlays)if(e.overlays.hasOwnProperty(c)){var u=e.overlays[c];u.isVisible()&&this._paintOverlay(u,e.overlayPlacements[c],l)}}e.lastPaintedAt=n}}},{key:"_refreshEndpoint",value:function(e){e._anchor.isFloating||(e.connections.length>0?this.addEndpointClass(e,this.endpointConnectedClass):this.removeEndpointClass(e,this.endpointConnectedClass),e.isFull()?this.addEndpointClass(e,this.endpointFullClass):this.removeEndpointClass(e,this.endpointFullClass))}},{key:"_makeConnector",value:function(e,t,n){return lr(e,t,n)}},{key:"addOverlay",value:function(e,t,n){if(e.addOverlay(t),!n){var i=e instanceof _s?e.element:e.source;this.revalidate(i)}}},{key:"removeOverlay",value:function(e,t){e.removeOverlay(t);var n=e instanceof _s?e.element:e.source;this.revalidate(n)}},{key:"setOutlineColor",value:function(e,t){e.paintStyleInUse.outlineStroke=t,this._paintConnection(e)}},{key:"setOutlineWidth",value:function(e,t){e.paintStyleInUse.outlineWidth=t,this._paintConnection(e)}},{key:"setColor",value:function(e,t){e.paintStyleInUse.stroke=t,this._paintConnection(e)}},{key:"setLineWidth",value:function(e,t){e.paintStyleInUse.strokeWidth=t,this._paintConnection(e)}},{key:"setLineStyle",value:function(e,t){null!=t.lineWidth&&(e.paintStyleInUse.strokeWidth=t.lineWidth),null!=t.outlineWidth&&(e.paintStyleInUse.outlineWidth=t.outlineWidth),null!=t.color&&(e.paintStyleInUse.stroke=t.color),null!=t.outlineColor&&(e.paintStyleInUse.outlineStroke=t.outlineColor),this._paintConnection(e)}},{key:"getPathData",value:function(e){for(var t="",n=0;n<e.segments.length;n++)t+=e.segments[n].getPath(0===n),t+=" ";return t}}]),n}(es),gr={};function yr(e,t){gr[e]=t}function mr(e,t,n){var i=t,o=B(t.getBoundingClientRect)!==Un?t.getBoundingClientRect():{left:0,top:0,width:0,height:0},s=document.body,r=document.documentElement,a=window.pageYOffset||r.scrollTop||s.scrollTop,l=window.pageXOffset||r.scrollLeft||s.scrollLeft,c=r.clientTop||s.clientTop||0,u=r.clientLeft||s.clientLeft||0,h=o.top+a-c+0*n,d=o.left+l-u+0*n,p=si(e),f=o.width||i.offsetWidth*n,v=o.height||i.offsetHeight*n;return{x:(p.x-d)/f,y:(p.y-h)/v}}function _r(e){return Ds(e)||Os(e)||Is(e)}function xr(e,t){e.canvas&&(e.canvas.style.display=t?"block":"none")}function br(e){e.canvas&&e.canvas.parentNode.removeChild(e.canvas),delete e.canvas}function kr(e){return e.canvas}function Cr(e){return Qo.getElement(e)}function Er(e){return Qo.getElement(e,e.component,(function(t){var n=e.create(t);return e.instance.addClass(n,e.instance.overlayClass),n}))}function Sr(e,t,n,i){var o=e.x,s=e.y;return t._jsPlumbParentGroup&&t._jsPlumbParentGroup.constrain&&(o=Math.max(e.x,0),s=Math.max(e.y,0),o=Math.min(o,n.w-i.w),s=Math.min(s,n.h-i.h)),{x:o,y:s}}var Pr=function(e){X(n,e);var t=K(n);function n(e,i){var o;if(V(this,n),(o=t.call(this,e,i))._instanceIndex=e,Y(Z(o),"containerType",null),Y(Z(o),"dragSelection",void 0),Y(Z(o),"dragManager",void 0),Y(Z(o),"_connectorClick",void 0),Y(Z(o),"_connectorDblClick",void 0),Y(Z(o),"_connectorTap",void 0),Y(Z(o),"_connectorDblTap",void 0),Y(Z(o),"_endpointClick",void 0),Y(Z(o),"_endpointDblClick",void 0),Y(Z(o),"_overlayClick",void 0),Y(Z(o),"_overlayDblClick",void 0),Y(Z(o),"_overlayTap",void 0),Y(Z(o),"_overlayDblTap",void 0),Y(Z(o),"_connectorMouseover",void 0),Y(Z(o),"_connectorMouseout",void 0),Y(Z(o),"_endpointMouseover",void 0),Y(Z(o),"_endpointMouseout",void 0),Y(Z(o),"_connectorContextmenu",void 0),Y(Z(o),"_connectorMousedown",void 0),Y(Z(o),"_connectorMouseup",void 0),Y(Z(o),"_endpointMousedown",void 0),Y(Z(o),"_endpointMouseup",void 0),Y(Z(o),"_overlayMouseover",void 0),Y(Z(o),"_overlayMouseout",void 0),Y(Z(o),"_elementClick",void 0),Y(Z(o),"_elementTap",void 0),Y(Z(o),"_elementDblTap",void 0),Y(Z(o),"_elementMouseenter",void 0),Y(Z(o),"_elementMouseexit",void 0),Y(Z(o),"_elementMousemove",void 0),Y(Z(o),"_elementMouseup",void 0),Y(Z(o),"_elementMousedown",void 0),Y(Z(o),"_elementContextmenu",void 0),Y(Z(o),"_resizeObserver",void 0),Y(Z(o),"eventManager",void 0),Y(Z(o),"draggingClass","jtk-dragging"),Y(Z(o),"elementDraggingClass","jtk-element-dragging"),Y(Z(o),"hoverClass","jtk-hover"),Y(Z(o),"sourceElementDraggingClass","jtk-source-element-dragging"),Y(Z(o),"targetElementDraggingClass","jtk-target-element-dragging"),Y(Z(o),"hoverSourceClass","jtk-source-hover"),Y(Z(o),"hoverTargetClass","jtk-target-hover"),Y(Z(o),"dragSelectClass","jtk-drag-select"),Y(Z(o),"managedElementsSelector",void 0),Y(Z(o),"elementsDraggable",void 0),Y(Z(o),"elementDragHandler",void 0),Y(Z(o),"groupDragOptions",void 0),Y(Z(o),"elementDragOptions",void 0),Y(Z(o),"svg",{node:function(e,t){return Nt(e,t)},attr:function(e,t){return Lt(e,t)},pos:function(e){return Ft(e)}}),i=i||{},o.containerType=Ze(o.getContainer()),o.elementsDraggable=i&&!1!==i.elementsDraggable,o.managedElementsSelector=i&&i.managedElementsSelector||Dt,o.eventManager=new mi,o.dragSelection=new eo(Z(o)),o.dragManager=new io(Z(o),o.dragSelection),o.dragManager.addHandler(new Jo(Z(o))),o.groupDragOptions={constrainFunction:Sr},o.dragManager.addHandler(new Ko(Z(o),o.dragSelection),o.groupDragOptions),o.elementDragHandler=new co(Z(o),o.dragSelection),o.elementDragOptions=i&&i.dragOptions||{},o.dragManager.addHandler(o.elementDragHandler,o.elementDragOptions),i&&i.dragOptions&&i.dragOptions.filter&&o.dragManager.addFilter(i.dragOptions.filter),o._createEventListeners(),o._attachEventDelegates(),!1!==i.resizeObserver)try{o._resizeObserver=new ResizeObserver((function(e){e.filter((function(e){var t=o.getAttribute(e.target,rt);if(null!=t){var n=o.viewport._elementMap.get(t);return!!n&&(n.w!==e.contentRect.width||n.h!==e.contentRect.height)}return!1})).forEach((function(e){return o.revalidate(e.target)}))}))}catch(e){Te("WARN: ResizeObserver could not be attached.")}return o}return U(n,[{key:"fireOverlayMethod",value:function(e,t,n){var i=Ht(e.component instanceof Cs?Xt:Ut,t);n._jsPlumbOverlay=e,e.fire(t,{e:n,overlay:e}),this.fire(i,e.component,n)}},{key:"addDragFilter",value:function(e,t){this.dragManager.addFilter(e,t)}},{key:"removeDragFilter",value:function(e){this.dragManager.removeFilter(e)}},{key:"setDragGrid",value:function(e){this.dragManager.setOption(this.elementDragHandler,{grid:e})}},{key:"setDragConstrainFunction",value:function(e){this.dragManager.setOption(this.elementDragHandler,{constrainFunction:e})}},{key:"_removeElement",value:function(e){e.parentNode&&e.parentNode.removeChild(e)}},{key:"_appendElement",value:function(e,t){t&&t.appendChild(e)}},{key:"_appendElementToGroup",value:function(e,t){this.getGroupContentArea(e).appendChild(t)}},{key:"_appendElementToContainer",value:function(e){this._appendElement(e,this.getContainer())}},{key:"_getAssociatedElements",value:function(e){var t=[];if(3!==e.nodeType&&8!==e.nodeType){var n=e.querySelectorAll(Dt);Array.prototype.push.apply(t,n)}return t.filter((function(e){return 3!==e.nodeType&&8!==e.nodeType}))}},{key:"shouldFireEvent",value:function(e,t,n){return!0}},{key:"getClass",value:function(e){return function(e){return $e(e)}(e)}},{key:"addClass",value:function(e,t){Ve(e,t)}},{key:"hasClass",value:function(e,t){return function(e,t){return e.classList?e.classList.contains(t):-1!==$e(e).indexOf(t)}(e,t)}},{key:"removeClass",value:function(e,t){ze(e,t)}},{key:"toggleClass",value:function(e,t){!function(e,t){var n=this,i=function(e,t){null!=e&&null!=t&&t.length>0&&(e.classList?e.classList.toggle(t):n.hasClass(e,t)?n.removeClass(e,t):n.addClass(e,t))};Be(e)?ve(e,(function(e){return i(e,t)})):i(e,t)}(e,t)}},{key:"setAttribute",value:function(e,t,n){e.setAttribute(t,n)}},{key:"getAttribute",value:function(e,t){return e.getAttribute(t)}},{key:"setAttributes",value:function(e,t){for(var n in t)e.setAttribute(n,t[n])}},{key:"removeAttribute",value:function(e,t){e.removeAttribute&&e.removeAttribute(t)}},{key:"on",value:function(e,t,n,i){var o=this,s=function(e){null==i?o.eventManager.on(e,t,n):o.eventManager.on(e,t,n,i)};return Be(e)?ve(e,(function(e){return s(e)})):s(e),this}},{key:"off",value:function(e,t,n){var i=this;return Be(e)?ve(e,(function(e){return i.eventManager.off(e,t,n)})):this.eventManager.off(e,t,n),this}},{key:"trigger",value:function(e,t,n,i,o){this.eventManager.trigger(e,t,n,i,o)}},{key:"getOffsetRelativeToRoot",value:function(e){return Xe(e)}},{key:"getOffset",value:function(e){for(var t,n=e,i=this.getContainer(),o=this.getPosition(n),s=e!==i&&n.offsetParent!==i?n.offsetParent:null;null!=s;)o.x+=s.offsetLeft,o.y+=s.offsetTop,null!=(t=s)&&t!==document.body&&(t.scrollTop>0||t.scrollLeft>0)&&(o.x-=t.scrollLeft,o.y-=t.scrollTop),s=s.offsetParent===i?null:s.offsetParent;if(null!=i&&(i.scrollTop>0||i.scrollLeft>0)){var r=null!=n.offsetParent?this.getStyle(n.offsetParent,Ln):"static",a=this.getStyle(n,Ln);a!==it&&a!==ot&&r!==it&&r!==ot&&(o.x-=i.scrollLeft,o.y-=i.scrollTop)}return o}},{key:"getSize",value:function(e){var t=e;return null!=t.offsetWidth?function(e){return{w:e.offsetWidth,h:e.offsetHeight}}(e):t.width&&t.width.baseVal?function(e){try{return{w:parseFloat(e.width.baseVal.value),h:parseFloat(e.height.baseVal.value)}}catch(e){return{w:0,h:0}}}(t):void 0}},{key:"getPosition",value:function(e){var t=e;return null!=t.offsetLeft?{x:parseFloat(t.offsetLeft),y:parseFloat(t.offsetTop)}:t.x&&t.x.baseVal?function(e){try{return{x:parseFloat(e.x.baseVal.value),y:parseFloat(e.y.baseVal.value)}}catch(e){return{x:0,y:0}}}(t):void 0}},{key:"getStyle",value:function(e,t){return B(window.getComputedStyle)!==Un?getComputedStyle(e,null).getPropertyValue(t):e.currentStyle[t]}},{key:"getGroupContentArea",value:function(e){var t=this.getSelector(e.el,$n);return t&&t.length>0?t[0]:e.el}},{key:"getSelector",value:function(e,t){var n=null;if(1===arguments.length){if(!ae(e)){var i=document.createDocumentFragment();return i.appendChild(e),xe(i.childNodes)}n=xe(document.querySelectorAll(e))}else n=xe(e.querySelectorAll(t));return n}},{key:"setPosition",value:function(e,t){var n=e;n.style.left=t.x+"px",n.style.top=t.y+"px"}},{key:"setDraggable",value:function(e,t){t?this.removeAttribute(e,at):this.setAttribute(e,at,Xn)}},{key:"isDraggable",value:function(e){var t=this.getAttribute(e,at);return null==t||t===Wn}},{key:"toggleDraggable",value:function(e){var t=this.isDraggable(e);return this.setDraggable(e,!t),!t}},{key:"_createEventListeners",value:function(){var e=function(e,t){if(!t.defaultPrevented&&null==t._jsPlumbOverlay){var n=Fe(Re(t),Nn,this.getContainer(),!0);this.fire(e,n.jtk.connector.connection,t)}};this._connectorClick=e.bind(this,wn),this._connectorDblClick=e.bind(this,An),this._connectorTap=e.bind(this,Gn),this._connectorDblTap=e.bind(this,Mn);var t=function(e,t){var n=Re(t).parentNode;if(n.jtk&&n.jtk.connector){var i=n.jtk.connector,o=i.connection;this.setConnectorHover(i,e),e?(this.addClass(o.source,this.hoverSourceClass),this.addClass(o.target,this.hoverTargetClass)):(this.removeClass(o.source,this.hoverSourceClass),this.removeClass(o.target,this.hoverTargetClass)),this.fire(e?Tn:Dn,n.jtk.connector.connection,t)}};this._connectorMouseover=t.bind(this,!0),this._connectorMouseout=t.bind(this,!1);var n=function(e,t){var n=Re(t).parentNode;n.jtk&&n.jtk.connector&&this.fire(e?On:jn,n.jtk.connector.connection,t)};this._connectorMouseup=n.bind(this,!0),this._connectorMousedown=n.bind(this,!1),this._connectorContextmenu=function(e){var t=Re(e).parentNode;t.jtk&&t.jtk.connector&&this.fire(In,t.jtk.connector.connection,e)}.bind(this);var i=function(e,t,n){t.defaultPrevented||null!=t._jsPlumbOverlay||this.fire(e,n.jtk.endpoint,t)};this._endpointClick=i.bind(this,_n),this._endpointDblClick=i.bind(this,xn);var o=function(e,t){var n=Re(t);n.jtk&&n.jtk.endpoint&&(this.setEndpointHover(n.jtk.endpoint,e),this.fire(e?kn:bn,n.jtk.endpoint,t))};this._endpointMouseover=o.bind(this,!0),this._endpointMouseout=o.bind(this,!1);var s=function(e,t){var n=Re(t);n.jtk&&n.jtk.endpoint&&this.fire(e?Cn:En,n.jtk.endpoint,t)};this._endpointMouseup=s.bind(this,!0),this._endpointMousedown=s.bind(this,!1);var r=function(e,t){var n=Fe(Re(t),Hn,this.getContainer(),!0).jtk.overlay;n&&this.fireOverlayMethod(n,e,t)}.bind(this);this._overlayClick=r.bind(this,Wt),this._overlayDblClick=r.bind(this,Zt),this._overlayTap=r.bind(this,rn),this._overlayDblTap=r.bind(this,Jt);var a=function(e,t){var n=Fe(Re(t),Hn,this.getContainer(),!0).jtk.overlay;n&&this.setOverlayHover(n,e)};this._overlayMouseover=a.bind(this,!0),this._overlayMouseout=a.bind(this,!1);this._elementClick=function(e,t,n){t.defaultPrevented||this.fire(1===t.detail?cn:un,n,t)}.bind(this,cn);this._elementTap=function(e,t,n){t.defaultPrevented||this.fire(mn,n,t)}.bind(this,mn);this._elementDblTap=function(e,t,n){t.defaultPrevented||this.fire(hn,n,t)}.bind(this,hn);var l=function(e,t){this.fire(e?pn:dn,Re(t),t)};this._elementMouseenter=l.bind(this,!0),this._elementMouseexit=l.bind(this,!1),this._elementMousemove=function(e){this.fire(fn,Re(e),e)}.bind(this),this._elementMouseup=function(e){this.fire(vn,Re(e),e)}.bind(this),this._elementMousedown=function(e){this.fire(gn,Re(e),e)}.bind(this),this._elementContextmenu=function(e){this.fire(yn,Re(e),e)}.bind(this)}},{key:"_attachEventDelegates",value:function(){var e=this.getContainer();this.eventManager.on(e,Wt,Hn,this._overlayClick),this.eventManager.on(e,Zt,Hn,this._overlayDblClick),this.eventManager.on(e,rn,Hn,this._overlayTap),this.eventManager.on(e,Jt,Hn,this._overlayDblTap),this.eventManager.on(e,Wt,Nn,this._connectorClick),this.eventManager.on(e,Zt,Nn,this._connectorDblClick),this.eventManager.on(e,rn,Nn,this._connectorTap),this.eventManager.on(e,Jt,Nn,this._connectorDblTap),this.eventManager.on(e,Wt,Fn,this._endpointClick),this.eventManager.on(e,Zt,Fn,this._endpointDblClick),this.eventManager.on(e,Wt,this.managedElementsSelector,this._elementClick),this.eventManager.on(e,rn,this.managedElementsSelector,this._elementTap),this.eventManager.on(e,Jt,this.managedElementsSelector,this._elementDblTap),this.eventManager.on(e,sn,Nn,this._connectorMouseover),this.eventManager.on(e,on,Nn,this._connectorMouseout),this.eventManager.on(e,qt,Nn,this._connectorContextmenu),this.eventManager.on(e,nn,Nn,this._connectorMouseup),this.eventManager.on(e,Kt,Nn,this._connectorMousedown),this.eventManager.on(e,sn,Fn,this._endpointMouseover),this.eventManager.on(e,on,Fn,this._endpointMouseout),this.eventManager.on(e,nn,Fn,this._endpointMouseup),this.eventManager.on(e,Kt,Fn,this._endpointMousedown),this.eventManager.on(e,sn,Hn,this._overlayMouseover),this.eventManager.on(e,on,Hn,this._overlayMouseout),this.eventManager.on(e,sn,Dt,this._elementMouseenter),this.eventManager.on(e,on,Dt,this._elementMouseexit),this.eventManager.on(e,tn,Dt,this._elementMousemove),this.eventManager.on(e,nn,Dt,this._elementMouseup),this.eventManager.on(e,Kt,Dt,this._elementMousedown),this.eventManager.on(e,qt,Dt,this._elementContextmenu)}},{key:"_detachEventDelegates",value:function(){var e=this.getContainer();e&&(this.eventManager.off(e,Wt,this._connectorClick),this.eventManager.off(e,Zt,this._connectorDblClick),this.eventManager.off(e,rn,this._connectorTap),this.eventManager.off(e,Jt,this._connectorDblTap),this.eventManager.off(e,Wt,this._endpointClick),this.eventManager.off(e,Zt,this._endpointDblClick),this.eventManager.off(e,Wt,this._overlayClick),this.eventManager.off(e,Zt,this._overlayDblClick),this.eventManager.off(e,rn,this._overlayTap),this.eventManager.off(e,Jt,this._overlayDblTap),this.eventManager.off(e,Wt,this._elementClick),this.eventManager.off(e,rn,this._elementTap),this.eventManager.off(e,Jt,this._elementDblTap),this.eventManager.off(e,sn,this._connectorMouseover),this.eventManager.off(e,on,this._connectorMouseout),this.eventManager.off(e,qt,this._connectorContextmenu),this.eventManager.off(e,nn,this._connectorMouseup),this.eventManager.off(e,Kt,this._connectorMousedown),this.eventManager.off(e,sn,this._endpointMouseover),this.eventManager.off(e,on,this._endpointMouseout),this.eventManager.off(e,nn,this._endpointMouseup),this.eventManager.off(e,Kt,this._endpointMousedown),this.eventManager.off(e,sn,this._overlayMouseover),this.eventManager.off(e,on,this._overlayMouseout),this.eventManager.off(e,Qt,this._elementMouseenter),this.eventManager.off(e,en,this._elementMouseexit),this.eventManager.off(e,tn,this._elementMousemove),this.eventManager.off(e,nn,this._elementMouseup),this.eventManager.off(e,Kt,this._elementMousedown),this.eventManager.off(e,qt,this._elementContextmenu))}},{key:"setContainer",value:function(e){var t,i=this;if(e===document||e===document.body)throw new Error("Cannot set document or document.body as container element");this._detachEventDelegates(),null!=this.dragManager&&(t=this.dragManager.reset()),this.setAttribute(e,Bt,we().replace("-",""));var o=this.getContainer();null!=o&&(o.removeAttribute(Bt),ve(xe(o.childNodes).filter((function(e){return null!=e&&(i.hasClass(e,ht)||i.hasClass(e,dt)||i.hasClass(e,gt)||e.getAttribute&&null!=e.getAttribute(rt))})),(function(t){e.appendChild(t)})));Q(W(n.prototype),"setContainer",this).call(this,e),this.containerType=Ze(e),null!=this.eventManager&&this._attachEventDelegates(),null!=this.dragManager&&(this.dragManager.addHandler(new Jo(this)),this.dragManager.addHandler(new Ko(this,this.dragSelection),this.groupDragOptions),this.elementDragHandler=new co(this,this.dragSelection),this.dragManager.addHandler(this.elementDragHandler,this.elementDragOptions),null!=t&&this.dragManager.setFilters(t))}},{key:"reset",value:function(){Q(W(n.prototype),"reset",this).call(this),this._resizeObserver&&this._resizeObserver.disconnect(),ve(this.getContainer().querySelectorAll([Dt,Fn,Nn,Hn].join(",")),(function(e){return e.parentNode&&e.parentNode.removeChild(e)}))}},{key:"destroy",value:function(){this._detachEventDelegates(),null!=this.dragManager&&this.dragManager.reset(),this.clearDragSelection(),Q(W(n.prototype),"destroy",this).call(this)}},{key:"unmanage",value:function(e,t){null!=this._resizeObserver&&this._resizeObserver.unobserve(e),this.removeFromDragSelection(e),Q(W(n.prototype),"unmanage",this).call(this,e,t)}},{key:"addToDragSelection",value:function(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];ve(n,(function(t){return e.dragSelection.add(t)}))}},{key:"clearDragSelection",value:function(){this.dragSelection.clear()}},{key:"removeFromDragSelection",value:function(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];ve(n,(function(t){return e.dragSelection.remove(t)}))}},{key:"toggleDragSelection",value:function(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];ve(n,(function(t){return e.dragSelection.toggle(t)}))}},{key:"addToDragGroup",value:function(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];(t=this.elementDragHandler).addToDragGroup.apply(t,[e].concat(i))}},{key:"removeFromDragGroup",value:function(){var e;(e=this.elementDragHandler).removeFromDragGroup.apply(e,arguments)}},{key:"setDragGroupState",value:function(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];(t=this.elementDragHandler).setDragGroupState.apply(t,[e].concat(i))}},{key:"clearDragGroup",value:function(e){this.elementDragHandler.clearDragGroup(e)}},{key:"consume",value:function(e,t){Ne(e,t)}},{key:"rotate",value:function(e,t,i){var o=this.getId(e);return this._managedElements[o]?(this._managedElements[o].el.style.transform="rotate("+t+"deg)",this._managedElements[o].el.style.transformOrigin="center center",Q(W(n.prototype),"rotate",this).call(this,e,t,i)):{c:new Set,e:new Set}}},{key:"addOverlayClass",value:function(e,t){if(as(e))e.instance.addClass(Cr(e),t);else if(_r(e))e.instance.addClass(Es(e),t);else{if(!Ls(e))throw"Could not add class to overlay of type ["+e.type+"]";e.instance.addClass(Er(e),t)}}},{key:"removeOverlayClass",value:function(e,t){if(as(e))e.instance.removeClass(Cr(e),t);else if(_r(e))e.instance.removeClass(Es(e),t);else{if(!Ls(e))throw"Could not remove class from overlay of type ["+e.type+"]";e.instance.removeClass(Er(e),t)}}},{key:"_paintOverlay",value:function(e,t,n){if(as(e)){Cr(e);var i=e.component.getXY();e.canvas.style.left=i.x+t.d.minx+"px",e.canvas.style.top=i.y+t.d.miny+"px"}else if(_r(e)){!function(e,t,n,i){Es(e);var o=[0,0];i.xmin<0&&(o[0]=-i.xmin),i.ymin<0&&(o[1]=-i.ymin);var s={d:t,stroke:n.stroke?n.stroke:null,fill:n.fill?n.fill:null,transform:"translate("+o[0]+","+o[1]+")","pointer-events":"visibleStroke"};Lt(e.path,s)}(e,isNaN(t.d.cxy.x)||isNaN(t.d.cxy.y)?"M 0 0":"M"+t.d.hxy.x+","+t.d.hxy.y+" L"+t.d.tail[0].x+","+t.d.tail[0].y+" L"+t.d.cxy.x+","+t.d.cxy.y+" L"+t.d.tail[1].x+","+t.d.tail[1].y+" Z",t,n)}else{if(!Ls(e))throw"Could not paint overlay of type ["+e.type+"]";Er(e);var o=e.component.getXY();e.canvas.style.left=o.x+t.d.minx+"px",e.canvas.style.top=o.y+t.d.miny+"px"}}},{key:"setOverlayVisible",value:function(e,t){var n=t?"block":"none";function i(e){null!=e&&(e.style.display=n)}as(e)?i(Cr(e)):Ls(e)?i(Er(e)):_r(e)&&i(e.path)}},{key:"reattachOverlay",value:function(e,t){as(e)?e.instance._appendElement(Cr(e),this.getContainer()):Ls(e)?e.instance._appendElement(Er(e),this.getContainer()):_r(e)&&this._appendElement(Es(e),t.connector.canvas)}},{key:"setOverlayHover",value:function(e,t){var n;as(e)?n=Cr(e):Ls(e)?n=Er(e):_r(e)&&(n=Es(e)),null!=n&&(null!=this.hoverClass&&(t?this.addClass(n,this.hoverClass):this.removeClass(n,this.hoverClass)),this.setHover(e.component,t))}},{key:"destroyOverlay",value:function(e){if(as(e)){var t=Cr(e);t.parentNode.removeChild(t),delete e.canvas,delete e.cachedDimensions}else if(Ds(e)||Os(e)||Is(e))!function(e,t){var n=e;null!=n.path&&null!=n.path.parentNode&&n.path.parentNode.removeChild(n.path),null!=n.bgPath&&null!=n.bgPath.parentNode&&n.bgPath.parentNode.removeChild(n.bgPath),delete n.path,delete n.bgPath}(e);else if(Ls(e)){var n=Er(e);n.parentNode.removeChild(n),delete e.canvas,delete e.cachedDimensions}}},{key:"drawOverlay",value:function(e,t,n,i){if(as(e)||Ls(e)){var o=Qo._getDimensions(e);if(null!=o&&null!=o.w&&null!=o.h){var s={x:0,y:0};if(i)s={x:i.x,y:i.y};else if(t instanceof vo){var r=Array.isArray(e.location)?e.location:[e.location,e.location];s={x:r[0]*t.w,y:r[1]*t.h}}else{var a=e.location,l=!1;(ae(e.location)||e.location<0||e.location>1)&&(a=parseInt(""+e.location,10),l=!0),s=t.pointOnPath(a,l)}var c=s.x-o.w/2,u=s.y-o.h/2;return{component:e,d:{minx:c,miny:u,td:o,cxy:s},xmin:c,xmax:c+o.w,ymin:u,ymax:u+o.h}}return{xmin:0,xmax:0,ymin:0,ymax:0}}if(Ds(e)||Os(e)||Is(e))return e.draw(t,n,i);throw"Could not draw overlay of type ["+e.type+"]"}},{key:"updateLabel",value:function(e){if(ue(e.label)){var t=e.label(this);Cr(e).innerText=null!=t?t:""}else null==e.labelText&&(e.labelText=e.label,null!=e.labelText?Cr(e).innerText=e.labelText:Cr(e).innerText="")}},{key:"setHover",value:function(e,t){e._hover=t,e instanceof _s&&null!=e.endpoint?this.setEndpointHover(e,t,-1):e instanceof Cs&&null!=e.connector&&this.setConnectorHover(e.connector,t)}},{key:"paintConnector",value:function(e,t,n){Ps(this,e,t,n)}},{key:"setConnectorHover",value:function(e,t,n){if(!1===t||!this.currentlyDragging&&!this.isHoverSuspended()){var i=e.canvas;null!=i&&(null!=e.hoverClass&&(t?this.addClass(i,e.hoverClass):this.removeClass(i,e.hoverClass)),t?this.addClass(i,this.hoverClass):this.removeClass(i,this.hoverClass)),null!=e.connection.hoverPaintStyle&&(e.connection.paintStyleInUse=t?e.connection.hoverPaintStyle:e.connection.paintStyle,this._suspendDrawing||this._paintConnection(e.connection)),e.connection.endpoints[0]!==n&&this.setEndpointHover(e.connection.endpoints[0],t,0,!0),e.connection.endpoints[1]!==n&&this.setEndpointHover(e.connection.endpoints[1],t,1,!0)}}},{key:"destroyConnector",value:function(e){null!=e.connector&&br(e.connector)}},{key:"addConnectorClass",value:function(e,t){e.canvas&&this.addClass(e.canvas,t)}},{key:"removeConnectorClass",value:function(e,t){e.canvas&&this.removeClass(e.canvas,t)}},{key:"getConnectorClass",value:function(e){return e.canvas?e.canvas.className.baseVal:""}},{key:"setConnectorVisible",value:function(e,t){xr(e,t)}},{key:"applyConnectorType",value:function(e,t){if(e.canvas&&t.cssClass){var n=Array.isArray(t.cssClass)?t.cssClass:[t.cssClass];this.addClass(e.canvas,n.join(" "))}}},{key:"addEndpointClass",value:function(e,t){var n=kr(e.endpoint);null!=n&&this.addClass(n,t)}},{key:"applyEndpointType",value:function(e,t){if(t.cssClass){var n=kr(e.endpoint);if(n){var i=Array.isArray(t.cssClass)?t.cssClass:[t.cssClass];this.addClass(n,i.join(" "))}}}},{key:"destroyEndpoint",value:function(e){var t=this.endpointAnchorClassPrefix+(e.currentAnchorClass?"-"+e.currentAnchorClass:"");this.removeClass(e.element,t),br(e.endpoint)}},{key:"renderEndpoint",value:function(e,t){var n=gr[e.endpoint.type];null!=n?ws.paint(e.endpoint,n,t):Te("jsPlumb: no endpoint renderer found for type ["+e.endpoint.type+"]")}},{key:"removeEndpointClass",value:function(e,t){var n=kr(e.endpoint);null!=n&&this.removeClass(n,t)}},{key:"getEndpointClass",value:function(e){var t=kr(e.endpoint);return null!=t?t.className:""}},{key:"setEndpointHover",value:function(e,t,n,i){if(null!=e&&(!1===t||!this.currentlyDragging&&!this.isHoverSuspended())){var o=kr(e.endpoint);if(null!=o&&(null!=e.hoverClass&&(t?this.addClass(o,e.hoverClass):this.removeClass(o,e.hoverClass)),0===n||1===n)){var s=0===n?this.hoverSourceClass:this.hoverTargetClass;t?this.addClass(o,s):this.removeClass(o,s)}if(null!=e.hoverPaintStyle&&(e.paintStyleInUse=t?e.hoverPaintStyle:e.paintStyle,this._suspendDrawing||this.renderEndpoint(e,e.paintStyleInUse)),!i)for(var r=0;r<e.connections.length;r++)this.setConnectorHover(e.connections[r].connector,t,e)}}},{key:"setEndpointVisible",value:function(e,t){xr(e.endpoint,t)}},{key:"setGroupVisible",value:function(e,t){for(var n=e.el.querySelectorAll(Dt),i=0;i<n.length;i++)t?this.show(n[i],!0):this.hide(n[i],!0)}},{key:"deleteConnection",value:function(e,t){return null!=e&&!0!==e.deleted&&(!0!==e.endpoints[0].deleted&&this.setEndpointHover(e.endpoints[0],!1,0,!0),!0!==e.endpoints[1].deleted&&this.setEndpointHover(e.endpoints[1],!1,1,!0),Q(W(n.prototype),"deleteConnection",this).call(this,e,t))}},{key:"addSourceSelector",value:function(e,t,i){return this.addDragFilter(e),Q(W(n.prototype),"addSourceSelector",this).call(this,e,t,i)}},{key:"removeSourceSelector",value:function(e){this.removeDragFilter(e.selector),Q(W(n.prototype),"removeSourceSelector",this).call(this,e)}},{key:"manage",value:function(e,t,i){if(this.containerType===Ee.SVG&&Ze(e)!==Ee.SVG)throw new Error("ERROR: cannot manage non-svg element when container is an SVG element.");var o=Q(W(n.prototype),"manage",this).call(this,e,t,i);return null!=o&&null!=this._resizeObserver&&this._resizeObserver.observe(o.el),o}}]),n}(vr),wr=function(e){X(n,e);var t=K(n);function n(e,i){var o;return V(this,n),Y(Z(o=t.call(this,e,i)),"width",void 0),Y(Z(o),"height",void 0),Y(Z(o),"type",n.type),i=i||{},o.width=i.width||10,o.height=i.height||10,o}return U(n,null,[{key:"_getParams",value:function(e){return{width:e.width,height:e.height}}}]),n}(vo);Y(wr,"type","Rectangle");var Ar={type:wr.type,cls:wr,compute:function(e,t,n,i){var o=i.width||e.width,s=i.height||e.height,r=t.curX-o/2,a=t.curY-s/2;return e.x=r,e.y=a,e.w=o,e.h=s,[r,a,o,s]},getParams:function(e){return{width:e.width,height:e.height}}},Mr=function(e){X(n,e);var t=K(n);function n(e,i){var o;return V(this,n),Y(Z(o=t.call(this,e,i)),"type",n.type),o}return n}(vo);Y(Mr,"type","Blank");var Dr,Tr={type:Mr.type,cls:Mr,compute:function(e,t,n,i){return e.x=t.curX,e.y=t.curY,e.w=10,e.h=0,[t.curX,t.curY,10,0]},getParams:function(e){return{}}},Or={width:10,height:0,fill:"transparent",stroke:"transparent"};yr(Ns.type,{makeNode:function(e,t){return Nt("circle",{cx:e.w/2,cy:e.h/2,r:e.radius})},updateNode:function(e,t){Lt(t,{cx:""+e.w/2,cy:""+e.h/2,r:""+e.radius})}}),yr(Mr.type,{makeNode:function(e,t){return Nt("rect",Or)},updateNode:function(e,t){Lt(t,Or)}}),yr(wr.type,{makeNode:function(e,t){return Nt("rect",{width:e.w,height:e.h})},updateNode:function(e,t){Lt(t,{width:e.w,height:e.h})}}),function(e){e[e.top=0]="top",e[e.bottom=1]="bottom"}(Dr||(Dr={}));var jr=new Map;jr.set(Dr.top,[Pn.TopRight,Pn.TopLeft]),jr.set(Dr.bottom,[Pn.BottomRight,Pn.BottomLeft]);var Ir={deriveAnchor:function(e,t,n,i){return jr.get(e)[t]}},Gr="jtk-scrollable-list",Lr=Ke(Gr),Nr="scroll";!function(){function e(t,n){var i=this;V(this,e),this.instance=t,Y(this,"options",void 0),Y(this,"count",void 0),Y(this,"lists",void 0),this.count=0,this.lists={},this.options=n||{},this.instance.bind(kt,(function(e){for(var t=i.instance.getSelector(e.el,Lr),n=0;n<t.length;n++)i.addList(t[n])})),this.instance.bind(St,(function(e){i.removeList(e.el)})),this.instance.bind(yt,(function(e,t){if(null==t){var n=i.findParentList(e.target);null!=n&&n.newConnection(e.connection,e.target,1);var o=i.findParentList(e.source);null!=o&&o.newConnection(e.connection,e.source,0)}})),this.instance.bind(At,(function(e){var t=e.dropEndpoint.element,n=i.findParentList(t);return null==n||t.offsetTop>=n.domElement.scrollTop&&t.offsetTop+t.offsetHeight<=n.domElement.scrollTop+n.domElement.offsetHeight}))}U(e,[{key:"addList",value:function(e,t){var n=se({},Ir);se(n,this.options),t=se(n,t||{});var i=[this.instance._instanceIndex,this.count++].join("_");return this.lists[i]=new Fr(this.instance,e,t,i),this.lists[i]}},{key:"getList",value:function(e){var t=this.instance.getAttribute(e,Gr);if(null!=t)return this.lists[t]}},{key:"removeList",value:function(e){var t=this.getList(e);t&&(t.destroy(),delete this.lists[t.id])}},{key:"findParentList",value:function(e){for(var t,n=e.parentNode,i=this.instance.getContainer();null!=n&&n!==i&&n!==document;){if(null!=(t=this.getList(n)))return t;n=n.parentNode}}}])}();var Fr=function(){function e(t,n,i,o){V(this,e),this.instance=t,this.el=n,this.options=i,this.id=o,Y(this,"_scrollHandler",void 0),Y(this,"domElement",void 0),Y(this,"elId",void 0),this.domElement=n,this.elId=this.instance.getId(n),t.setAttribute(n,Gr,o),this._scrollHandler=this.scrollHandler.bind(this),this.domElement._jsPlumbScrollHandler=this._scrollHandler,t.on(n,Nr,this._scrollHandler),this._scrollHandler()}return U(e,[{key:"deriveAnchor",value:function(e,t,n,i){return this.options.anchor?this.options.anchor:this.options.deriveAnchor(e,t,n,i)}},{key:"deriveEndpoint",value:function(e,t,n,i){return this.options.deriveEndpoint?this.options.deriveEndpoint(e,t,n,i):this.options.endpoint?this.options.endpoint:n.endpoint.type}},{key:"newConnection",value:function(e,t,n){t.offsetTop<this.el.scrollTop?this._proxyConnection(t,e,n,Dr.top):t.offsetTop+t.offsetHeight>this.el.scrollTop+this.domElement.offsetHeight&&this._proxyConnection(t,e,n,Dr.bottom)}},{key:"scrollHandler",value:function(){for(var e=this,t=this.instance.getSelector(this.el,Dt),n=function(n){if(t[n].offsetTop<e.el.scrollTop)t[n]._jsPlumbProxies=t[n]._jsPlumbProxies||[],e.instance.select({source:t[n]}).each((function(i){e._proxyConnection(t[n],i,0,Dr.top)})),e.instance.select({target:t[n]}).each((function(i){e._proxyConnection(t[n],i,1,Dr.top)}));else if(t[n].offsetTop+t[n].offsetHeight>e.el.scrollTop+e.domElement.offsetHeight)t[n]._jsPlumbProxies=t[n]._jsPlumbProxies||[],e.instance.select({source:t[n]}).each((function(i){e._proxyConnection(t[n],i,0,Dr.bottom)})),e.instance.select({target:t[n]}).each((function(i){e._proxyConnection(t[n],i,1,Dr.bottom)}));else if(t[n]._jsPlumbProxies){for(var i=0;i<t[n]._jsPlumbProxies.length;i++)e.instance.unproxyConnection(t[n]._jsPlumbProxies[i][0],t[n]._jsPlumbProxies[i][1]);delete t[n]._jsPlumbProxies}e.instance.revalidate(t[n])},i=0;i<t.length;i++)n(i)}},{key:"_proxyConnection",value:function(e,t,n,i){var o=this;this.instance.proxyConnection(t,n,this.domElement,(function(e,n){return o.deriveEndpoint(i,n,t.endpoints[n],t)}),(function(e,n){return o.deriveAnchor(i,n,t.endpoints[n],t)})),e._jsPlumbProxies=e._jsPlumbProxies||[],e._jsPlumbProxies.push([t,n])}},{key:"destroy",value:function(){this.instance.off(this.el,Nr,this._scrollHandler),delete this.domElement._jsPlumbScrollHandler;for(var e=this.instance.getSelector(this.el,Dt),t=0;t<e.length;t++)if(e[t]._jsPlumbProxies){for(var n=0;n<e[t]._jsPlumbProxies.length;n++)this.instance.unproxyConnection(e[t]._jsPlumbProxies[n][0],e[t]._jsPlumbProxies[n][1]);delete e[t]._jsPlumbProxies}}}]),e}();function Rr(e){var t=Math.floor(e),n=Math.ceil(e);return e-t<1e-10?t:n-e<1e-10?n:e}var $r=function(e){X(n,e);var t=K(n);function n(e){var i;V(this,n),Y(Z(i=t.call(this,e)),"type",n.segmentType),Y(Z(i),"cx",void 0),Y(Z(i),"cy",void 0),Y(Z(i),"radius",void 0),Y(Z(i),"anticlockwise",void 0),Y(Z(i),"startAngle",void 0),Y(Z(i),"endAngle",void 0),Y(Z(i),"sweep",void 0),Y(Z(i),"length",void 0),Y(Z(i),"circumference",void 0),Y(Z(i),"frac",void 0),i.cx=e.cx,i.cy=e.cy,i.radius=e.r,i.anticlockwise=e.ac,e.startAngle&&e.endAngle?(i.startAngle=e.startAngle,i.endAngle=e.endAngle,i.x1=i.cx+i.radius*Math.cos(i.startAngle),i.y1=i.cy+i.radius*Math.sin(i.startAngle),i.x2=i.cx+i.radius*Math.cos(i.endAngle),i.y2=i.cy+i.radius*Math.sin(i.endAngle)):(i.startAngle=i._calcAngle(i.x1,i.y1),i.endAngle=i._calcAngle(i.x2,i.y2)),i.endAngle<0&&(i.endAngle+=bi),i.startAngle<0&&(i.startAngle+=bi);var o=i.endAngle<i.startAngle?i.endAngle+bi:i.endAngle;return i.sweep=Math.abs(o-i.startAngle),i.anticlockwise&&(i.sweep=bi-i.sweep),i.circumference=2*Math.PI*i.radius,i.frac=i.sweep/bi,i.length=i.circumference*i.frac,i.extents={xmin:i.cx-i.radius,xmax:i.cx+i.radius,ymin:i.cy-i.radius,ymax:i.cy+i.radius},i}return U(n,[{key:"_calcAngle",value:function(e,t){return n={x:this.cx,y:this.cy},o=ki(n,i={x:e,y:t}),s=Math.atan(o),4!=(r=Ei(n,i))&&3!=r||(s+=Math.PI),s<0&&(s+=2*Math.PI),s;var n,i,o,s,r}},{key:"_calcAngleForLocation",value:function(e,t){if(e.anticlockwise){var n=e.startAngle<e.endAngle?e.startAngle+bi:e.startAngle;return n-Math.abs(n-e.endAngle)*t}var i=e.endAngle<e.startAngle?e.endAngle+bi:e.endAngle,o=Math.abs(i-e.startAngle);return e.startAngle+o*t}},{key:"getPath",value:function(e){var t=this.sweep>Math.PI?1:0,n=this.anticlockwise?0:1;return(e?"M"+this.x1+" "+this.y1+" ":"")+"A "+this.radius+" "+this.radius+" 0 "+t+","+n+" "+this.x2+" "+this.y2}},{key:"getLength",value:function(){return this.length}},{key:"pointOnPath",value:function(e,t){if(0===e)return{x:this.x1,y:this.y1,theta:this.startAngle};if(1===e)return{x:this.x2,y:this.y2,theta:this.endAngle};t&&(e/=length);var n=this._calcAngleForLocation(this,e),i=this.cx+this.radius*Math.cos(n),o=this.cy+this.radius*Math.sin(n);return{x:Rr(i),y:Rr(o),theta:n}}},{key:"gradientAtPoint",value:function(e,t){var n=this.pointOnPath(e,t),i=-1/ki({x:this.cx,y:this.cy},n);return this.anticlockwise||i!==1/0&&i!==-1/0||(i*=-1),i}},{key:"pointAlongPathFrom",value:function(e,t,n){var i=this.pointOnPath(e,n),o=t/this.circumference*2*Math.PI,s=this.anticlockwise?-1:1,r=i.theta+s*o;return{x:this.cx+this.radius*Math.cos(r),y:this.cy+this.radius*Math.sin(r)}}}]),n}(zn);Y($r,"segmentType","Arc");var Hr=function(e){X(n,e);var t=K(n);function n(e,i){var o;return V(this,n),(o=t.call(this,e,i)).connection=e,Y(Z(o),"showLoopback",void 0),Y(Z(o),"curviness",void 0),Y(Z(o),"margin",void 0),Y(Z(o),"proximityLimit",void 0),Y(Z(o),"orientation",void 0),Y(Z(o),"loopbackRadius",void 0),Y(Z(o),"clockwise",void 0),Y(Z(o),"isLoopbackCurrently",void 0),Y(Z(o),"geometry",null),i=i||{},o.showLoopback=!1!==i.showLoopback,o.curviness=i.curviness||10,o.margin=i.margin||5,o.proximityLimit=i.proximityLimit||80,o.clockwise=i.orientation&&"clockwise"===i.orientation,o.loopbackRadius=i.loopbackRadius||25,o.isLoopbackCurrently=!1,o}return U(n,[{key:"getDefaultStubs",value:function(){return[0,0]}},{key:"_compute",value:function(e,t){var n=t.sourcePos,i=t.targetPos,o=Math.abs(n.curX-i.curX),s=Math.abs(n.curY-i.curY);if(this.showLoopback&&t.sourceEndpoint.elementId===t.targetEndpoint.elementId){this.isLoopbackCurrently=!0;var r=t.sourcePos.curX,a=t.sourcePos.curY-this.margin,l=r,c=a-this.loopbackRadius,u=l-this.loopbackRadius,h=c-this.loopbackRadius;o=2*this.loopbackRadius,s=2*this.loopbackRadius,e.points[0]=u,e.points[1]=h,e.points[2]=o,e.points[3]=s,this._addSegment($r,{loopback:!0,x1:r-u+4,y1:a-h,startAngle:0,endAngle:2*Math.PI,r:this.loopbackRadius,ac:!this.clockwise,x2:r-u-4,y2:a-h,cx:l-u,cy:c-h})}else this.isLoopbackCurrently=!1,this._computeBezier(e,t,n,i,o,s)}},{key:"exportGeometry",value:function(){return null==this.geometry?null:{controlPoints:[se({},this.geometry.controlPoints[0]),se({},this.geometry.controlPoints[1])],source:se({},this.geometry.source),target:se({},this.geometry.target)}}},{key:"transformGeometry",value:function(e,t,n){return{controlPoints:[{x:e.controlPoints[0].x+t,y:e.controlPoints[0].y+n},{x:e.controlPoints[1].x+t,y:e.controlPoints[1].y+n}],source:this.transformAnchorPlacement(e.source,t,n),target:this.transformAnchorPlacement(e.target,t,n)}}},{key:"importGeometry",value:function(e){return null!=e&&(null==e.controlPoints||2!=e.controlPoints.length?(Te("jsPlumb Bezier: cannot import geometry; controlPoints missing or does not have length 2"),this.setGeometry(null,!0),!1):null==e.controlPoints[0].x||null==e.controlPoints[0].y||null==e.controlPoints[1].x||null==e.controlPoints[1].y?(Te("jsPlumb Bezier: cannot import geometry; controlPoints malformed"),this.setGeometry(null,!0),!1):null==e.source||null==e.source.curX||null==e.source.curY?(Te("jsPlumb Bezier: cannot import geometry; source missing or malformed"),this.setGeometry(null,!0),!1):null==e.target||null==e.target.curX||null==e.target.curY?(Te("jsPlumb Bezier: cannot import geometry; target missing or malformed"),this.setGeometry(null,!0),!1):(this.setGeometry(e,!1),!0))}}]),n}(As),Br=function(e,t){return{x:e.x-t.x,y:e.y-t.y}},Vr=function(e,t){return e.x*t.x+e.y*t.y},zr=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},Ur=function(e,t){return{x:e.x*t,y:e.y*t}},Yr=Math.pow(2,-65);function Xr(e,t){for(var n,i=[],o=function(e,t){for(var n=t.length-1,i=2*n-1,o=[],s=[],r=[],a=[],l=[[1,.6,.3,.1],[.4,.6,.6,.4],[.1,.3,.6,1]],c=0;c<=n;c++)o[c]=Br(t[c],e);for(var u=0;u<=n-1;u++)s[u]=Br(t[u+1],t[u]),s[u]=Ur(s[u],3);for(var h=0;h<=n-1;h++)for(var d=0;d<=n;d++)r[h]||(r[h]=[]),r[h][d]=Vr(s[h],o[d]);for(var p=0;p<=i;p++)a[p]||(a[p]=[]),a[p].y=0,a[p].x=parseFloat(""+p)/i;for(var f=n,v=n-1,g=0;g<=f+v;g++)for(var y=Math.max(0,g-v),m=Math.min(g,f),_=y;_<=m;_++){var x=g-_;a[_+x].y+=r[x][_]*l[x][_]}return a}(e,t),s=t.length-1,r=Wr(o,2*s-1,i,0),a=Br(e,t[0]),l=zr(a),c=0,u=0;u<r;u++)a=Br(e,qr(t,s,i[u],null,null)),(n=zr(a))<l&&(l=n,c=i[u]);return a=Br(e,t[s]),(n=zr(a))<l&&(l=n,c=1),{location:c,distance:l}}function Wr(e,t,n,i){var o,s,r=[],a=[],l=[],c=[];switch(function(e,t){var n,i,o=0;n=i=Oe(e[0].y);for(var s=1;s<=t;s++)(n=Oe(e[s].y))!=i&&o++,i=n;return o}(e,t)){case 0:return 0;case 1:if(i>=64)return n[0]=(e[0].x+e[t].x)/2,1;if(function(e,t){var n,i,o,s,r,a,l,c,u,h,d,p,f;r=e[0].y-e[t].y,a=e[t].x-e[0].x,l=e[0].x*e[t].y-e[t].x*e[0].y,p=f=0;for(var v=1;v<t;v++){var g=r*e[v].x+a*e[v].y+l;g>p?p=g:g<f&&(f=g)}return n=((u=1)*(l-p)-(d=a)*(h=0))*(1/((c=0)*d-r*u)),i=(u*(l-f)-(d=a)*h)*(1/(c*d-r*u)),o=Math.min(n,i),s=Math.max(n,i),s-o<Yr?1:0}(e,t))return n[0]=function(e,t){var n=1,i=0,o=e[t].x-e[0].x,s=e[t].y-e[0].y,r=e[0].x-0,a=e[0].y-0;return 0+n*(1/(o*i-s*n)*(o*a-s*r))}(e,t),1}qr(e,t,.5,r,a),o=Wr(r,t,l,i+1),s=Wr(a,t,c,i+1);for(var u=0;u<o;u++)n[u]=l[u];for(var h=0;h<s;h++)n[h+o]=c[h];return o+s}function qr(e,t,n,i,o){for(var s=[[]],r=0;r<=t;r++)s[0][r]=e[r];for(var a=1;a<=t;a++)for(var l=0;l<=t-a;l++)s[a]||(s[a]=[]),s[a][l]||(s[a][l]={}),s[a][l].x=(1-n)*s[a-1][l].x+n*s[a-1][l+1].x,s[a][l].y=(1-n)*s[a-1][l].y+n*s[a-1][l+1].y;if(null!=i)for(var c=0;c<=t;c++)i[c]=s[c][0];if(null!=o)for(var u=0;u<=t;u++)o[u]=s[t-u][u];return s[t][0]}function Zr(e,t){var n={x:0,y:0};if(0===e)return t[0];var i=t.length-1;if(1===e)return t[i];var o=t,s=1-e;if(0===i)return t[0];if(1===i)return{x:s*o[0].x+e*o[1].x,y:s*o[0].y+e*o[1].y};if(4>i){var r,a,l,c=s*s,u=e*e,h=0;return 2===i?(o=[o[0],o[1],o[2],n],r=c,a=s*e*2,l=u):3===i&&(r=c*s,a=c*e*3,l=s*u*3,h=e*u),{x:r*o[0].x+a*o[1].x+l*o[2].x+h*o[3].x,y:r*o[0].y+a*o[1].y+l*o[2].y+h*o[3].y}}return n}function Jr(e){var t=0;if(!ta(e))for(var n=function(e,t){var n=[];e--;for(var i=0;i<=e;i++)n.push(Zr(i/e,t));return n}(16,e),i=0;i<15;i++){t+=ea(n[i],n[i+1])}return t}var Kr=new Map;function Qr(e,t){for(var n=function(e){var t=Kr.get(e);if(!t){var n=function(e){return function(t){return e}},i=function(e){return function(t){for(var n=1,i=0;i<e.length;i++)n*=e[i](t);return n}};(t=[]).push((function(t){return Math.pow(t,e)}));for(var o=1;o<e;o++){for(var s=[n(e)],r=0;r<e-o;r++)s.push((function(e){return e}));for(var a=0;a<o;a++)s.push((function(e){return 1-e}));t.push(i(s))}t.push((function(t){return Math.pow(1-t,e)})),Kr.set(e,t)}return t}(e.length-1),i=0,o=0,s=0;s<e.length;s++)i+=e[s].x*n[s](t),o+=e[s].y*n[s](t);return{x:i,y:o}}function ea(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function ta(e){return e[0].x===e[1].x&&e[0].y===e[1].y}function na(e,t,n){if(ta(e))return{point:e[0],location:t};for(var i=Qr(e,t),o=0,s=t,r=n>0?1:-1,a=null;o<Math.abs(n);)o+=ea(a=Qr(e,s+=.005*r),i),i=a;return{point:a,location:s}}function ia(e,t,n,i,o){var s=i-t,r=e-n,a=e*(t-i)+t*(n-e),l=function(e){return[oa(e,"x"),oa(e,"y")]}(o),c=[s*l[0][0]+r*l[1][0],s*l[0][1]+r*l[1][1],s*l[0][2]+r*l[1][2],s*l[0][3]+r*l[1][3]+a],u=sa.apply(null,c),h=[];if(null!=u)for(var d=0;d<3;d++){var p=u[d],f=Math.pow(p,2),v=Math.pow(p,3),g={x:l[0][0]*v+l[0][1]*f+l[0][2]*p+l[0][3],y:l[1][0]*v+l[1][1]*f+l[1][2]*p+l[1][3]},y=void 0;y=n-e!=0?(g[0]-e)/(n-e):(g[1]-t)/(i-t),p>=0&&p<=1&&y>=0&&y<=1&&h.push(g)}return h}function oa(e,t){return[-e[0][t]+3*e[1][t]+-3*e[2][t]+e[3][t],3*e[0][t]-6*e[1][t]+3*e[2][t],-3*e[0][t]+3*e[1][t],e[0][t]]}function sa(e,t,n,i){var o,s,r=t/e,a=n/e,l=i/e,c=(3*a-Math.pow(r,2))/9,u=(9*r*a-27*l-2*Math.pow(r,3))/54,h=Math.pow(c,3)+Math.pow(u,2),d=[0,0,0];if(h>=0)o=Oe(u+Math.sqrt(h))*Math.pow(Math.abs(u+Math.sqrt(h)),1/3),s=Oe(u-Math.sqrt(h))*Math.pow(Math.abs(u-Math.sqrt(h)),1/3),d[0]=-r/3+(o+s),d[1]=-r/3-(o+s)/2,d[2]=-r/3-(o+s)/2,0!==Math.abs(Math.sqrt(3)*(o-s)/2)&&(d[1]=-1,d[2]=-1);else{var p=Math.acos(u/Math.sqrt(-Math.pow(c,3)));d[0]=2*Math.sqrt(-c)*Math.cos(p/3)-r/3,d[1]=2*Math.sqrt(-c)*Math.cos((p+2*Math.PI)/3)-r/3,d[2]=2*Math.sqrt(-c)*Math.cos((p+4*Math.PI)/3)-r/3}for(var f=0;f<3;f++)(d[f]<0||d[f]>1)&&(d[f]=-1);return d}var ra=function(e){X(n,e);var t=K(n);function n(e){var i;return V(this,n),Y(Z(i=t.call(this,e)),"curve",void 0),Y(Z(i),"cp1x",void 0),Y(Z(i),"cp1y",void 0),Y(Z(i),"cp2x",void 0),Y(Z(i),"cp2y",void 0),Y(Z(i),"length",0),Y(Z(i),"type",n.segmentType),i.cp1x=e.cp1x,i.cp1y=e.cp1y,i.cp2x=e.cp2x,i.cp2y=e.cp2y,i.x1=e.x1,i.x2=e.x2,i.y1=e.y1,i.y2=e.y2,i.curve=[{x:i.x1,y:i.y1},{x:i.cp1x,y:i.cp1y},{x:i.cp2x,y:i.cp2y},{x:i.x2,y:i.y2}],i.extents={xmin:Math.min(i.x1,i.x2,i.cp1x,i.cp2x),ymin:Math.min(i.y1,i.y2,i.cp1y,i.cp2y),xmax:Math.max(i.x1,i.x2,i.cp1x,i.cp2x),ymax:Math.max(i.y1,i.y2,i.cp1y,i.cp2y)},i}return U(n,[{key:"getPath",value:function(e){return(e?"M "+this.x2+" "+this.y2+" ":"")+"C "+this.cp2x+" "+this.cp2y+" "+this.cp1x+" "+this.cp1y+" "+this.x1+" "+this.y1}},{key:"pointOnPath",value:function(e,t){return e=n._translateLocation(this.curve,e,t),Qr(this.curve,e)}},{key:"gradientAtPoint",value:function(e,t){return e=n._translateLocation(this.curve,e,t),function(e,t){var n=Qr(e,t),i=Qr(e.slice(0,e.length-1),t),o=i.y-n.y,s=i.x-n.x;return 0===o?1/0:Math.atan(o/s)}(this.curve,e)}},{key:"pointAlongPathFrom",value:function(e,t,i){return e=n._translateLocation(this.curve,e,i),function(e,t,n){return na(e,t,n).point}(this.curve,e,t)}},{key:"getLength",value:function(){return null!=this.length&&0!==this.length||(this.length=Jr(this.curve)),this.length}},{key:"findClosestPointOnPath",value:function(e,t){var n,i,o,s=(n={x:e,y:t},i=this.curve,o=Xr(n,i),{point:qr(i,i.length-1,o.location,null,null),location:o.location});return{d:Math.sqrt(Math.pow(s.point.x-e,2)+Math.pow(s.point.y-t,2)),x:s.point.x,y:s.point.y,l:1-s.location,s:this,x1:null,y1:null,x2:null,y2:null}}},{key:"lineIntersection",value:function(e,t,n,i){return ia(e,t,n,i,this.curve)}}],[{key:"_translateLocation",value:function(e,t,n){return n&&(t=function(e,t,n){return na(e,t,n).location}(e,t>0?0:1,t)),t}}]),n}(zn);Y(ra,"segmentType","Bezier");var aa=function(e){X(n,e);var t=K(n);function n(e,i){var o;return V(this,n),(o=t.call(this,e,i)).connection=e,Y(Z(o),"type",n.type),Y(Z(o),"majorAnchor",void 0),Y(Z(o),"minorAnchor",void 0),i=i||{},o.majorAnchor=i.curviness||150,o.minorAnchor=10,o}return U(n,[{key:"getCurviness",value:function(){return this.majorAnchor}},{key:"_findControlPoint",value:function(e,t,n,i,o){var s={x:0,y:0};return i[0]!==o[0]||i[1]===o[1]?(0===o[0]?s.x=n.curX<t.curX?e.x+this.minorAnchor:e.x-this.minorAnchor:s.x=e.x+this.majorAnchor*o[0],0===o[1]?s.y=n.curY<t.curY?e.y+this.minorAnchor:e.y-this.minorAnchor:s.y=e.y+this.majorAnchor*i[1]):(0===i[0]?s.x=t.curX<n.curX?e.x+this.minorAnchor:e.x-this.minorAnchor:s.x=e.x-this.majorAnchor*i[0],0===i[1]?s.y=t.curY<n.curY?e.y+this.minorAnchor:e.y-this.minorAnchor:s.y=e.y+this.majorAnchor*o[1]),s}},{key:"_computeBezier",value:function(e,t,n,i,o,s){var r,a,l=n.curX<i.curX?o:0,c=n.curY<i.curY?s:0,u=n.curX<i.curX?0:o,h=n.curY<i.curY?0:s;!0!==this.edited?(r=this._findControlPoint({x:l,y:c},n,i,e.so,e.to),a=this._findControlPoint({x:u,y:h},i,n,e.to,e.so)):(r=this.geometry.controlPoints[0],a=this.geometry.controlPoints[1]),this.geometry={controlPoints:[r,a],source:t.sourcePos,target:t.targetPos},this._addSegment(ra,{x1:l,y1:c,x2:u,y2:h,cp1x:r.x,cp1y:r.y,cp2x:a.x,cp2y:a.y})}}]),n}(Hr);Y(aa,"type","Bezier");var la=function(e){X(n,e);var t=K(n);function n(e,i){var o;return V(this,n),(o=t.call(this,e,i)).connection=e,Y(Z(o),"type",n.type),Y(Z(o),"_controlPoint",void 0),o.curviness=i.curviness||10,o.margin=i.margin||5,o.proximityLimit=i.proximityLimit||80,o.clockwise=i.orientation&&"clockwise"===i.orientation,o}return U(n,[{key:"_computeBezier",value:function(e,t,n,i,o,s){var r,a,l,c,u,h,d,p,f=n.curX<i.curX?0:o,v=n.curY<i.curY?0:s,g=n.curX<i.curX?o:0,y=n.curY<i.curY?s:0;if(0===n.x&&(f-=this.margin),1===n.x&&(f+=this.margin),0===n.y&&(v-=this.margin),1===n.y&&(v+=this.margin),0===i.x&&(g-=this.margin),1===i.x&&(g+=this.margin),0===i.y&&(y-=this.margin),1===i.y&&(y+=this.margin),!0!==this.edited){var m=(f+g)/2,_=(v+y)/2,x=(a=v,c=y,(r=f)<=(l=g)&&c<=a?1:r<=l&&a<=c?2:l<=r&&c>=a?3:4),b=Math.sqrt(Math.pow(g-f,2)+Math.pow(y-v,2));this._controlPoint=function(e,t,n,i,o,s,r,a,l){return a<=l?{x:e,y:t}:1===n?i.curY<=0&&o.curY>=1?{x:e+(i.x<.5?-1*s:s),y:t}:i.curX>=1&&o.curX<=0?{x:e,y:t+(i.y<.5?-1*r:r)}:{x:e+-1*s,y:t+-1*r}:2===n?i.curY>=1&&o.curY<=0?{x:e+(i.x<.5?-1*s:s),y:t}:i.curX>=1&&o.curX<=0?{x:e,y:t+(i.y<.5?-1*r:r)}:{x:e+s,y:t+-1*r}:3===n?i.curY>=1&&o.curY<=0?{x:e+(i.x<.5?-1*s:s),y:t}:i.curX<=0&&o.curX>=1?{x:e,y:t+(i.y<.5?-1*r:r)}:{x:e+-1*s,y:t+-1*r}:4===n?i.curY<=0&&o.curY>=1?{x:e+(i.x<.5?-1*s:s),y:t}:i.curX<=0&&o.curX>=1?{x:e,y:t+(i.y<.5?-1*r:r)}:{x:e+s,y:t+-1*r}:void 0}(m,_,x,t.sourcePos,t.targetPos,this.curviness,this.curviness,b,this.proximityLimit)}else this._controlPoint=this.geometry.controlPoints[0];u=this._controlPoint.x,h=this._controlPoint.x,d=this._controlPoint.y,p=this._controlPoint.y,this.geometry={controlPoints:[this._controlPoint,this._controlPoint],source:t.sourcePos,target:t.targetPos},this._addSegment(ra,{x1:g,y1:y,x2:f,y2:v,cp1x:u,cp1y:d,cp2x:h,cp2y:p})}}]),n}(Hr);function ca(e){return e<0?-1:0===e?0:1}function ua(e){return[ca(e[2]-e[0]),ca(e[3]-e[1])]}function ha(e){return Math.sqrt(Math.pow(e[0]-e[2],2)+Math.pow(e[1]-e[3],2))}function da(e){var t=[];return t.push.apply(t,e),t}Y(la,"type","StateMachine"),cr(aa.type,aa),cr(la.type,la);var pa=function(e){X(n,e);var t=K(n);function n(e,i){var o;return V(this,n),(o=t.call(this,e,i)).connection=e,Y(Z(o),"type",n.type),Y(Z(o),"internalSegments",[]),Y(Z(o),"midpoint",void 0),Y(Z(o),"alwaysRespectStubs",void 0),Y(Z(o),"cornerRadius",void 0),Y(Z(o),"lastx",void 0),Y(Z(o),"lasty",void 0),Y(Z(o),"lastOrientation",void 0),Y(Z(o),"loopbackRadius",void 0),Y(Z(o),"isLoopbackCurrently",void 0),o.midpoint=null==i.midpoint||isNaN(i.midpoint)?.5:i.midpoint,o.cornerRadius=null!=i.cornerRadius?i.cornerRadius:0,o.alwaysRespectStubs=!0===i.alwaysRespectStubs,o.lastx=null,o.lasty=null,o.lastOrientation=null,o.loopbackRadius=i.loopbackRadius||25,o.isLoopbackCurrently=!1,o}return U(n,[{key:"getDefaultStubs",value:function(){return[30,30]}},{key:"addASegment",value:function(e,t,n){if(this.lastx!==e||this.lasty!==t){var i=null==this.lastx?n.sx:this.lastx,o=null==this.lasty?n.sy:this.lasty,s=i===e?"v":"h";this.lastx=e,this.lasty=t,this.internalSegments.push([i,o,e,t,s])}}},{key:"writeSegments",value:function(e){for(var t,n,i,o=null,s=0;s<this.internalSegments.length-1;s++){if(o=o||da(this.internalSegments[s]),t=da(this.internalSegments[s+1]),n=ua(o),i=ua(t),this.cornerRadius>0&&o[4]!==t[4]){var r=Math.min(ha(o),ha(t)),a=Math.min(this.cornerRadius,r/2);o[2]-=n[0]*a,o[3]-=n[1]*a,t[0]+=i[0]*a,t[1]+=i[1]*a;var l=n[1]===i[0]&&1===i[0]||n[1]===i[0]&&0===i[0]&&n[0]!==i[1]||n[1]===i[0]&&-1===i[0],c=(t[1]>o[3]?1:-1)===(t[0]>o[2]?1:-1),u=c&&l||!c&&!l?t[0]:o[2],h=c&&l||!c&&!l?o[3]:t[1];this._addSegment(ur,{x1:o[0],y1:o[1],x2:o[2],y2:o[3]}),this._addSegment($r,{r:a,x1:o[2],y1:o[3],x2:t[0],y2:t[1],cx:u,cy:h,ac:l})}else this._addSegment(ur,{x1:o[0],y1:o[1],x2:o[2],y2:o[3]});o=t}null!=t&&this._addSegment(ur,{x1:t[0],y1:t[1],x2:t[2],y2:t[3]})}},{key:"_compute",value:function(e,t){var n=this;this.internalSegments.length=0,this.lastx=null,this.lasty=null,this.lastOrientation=null;var i=function(t){return[e.startStubX,e.startStubY,e.endStubX,e.endStubY]},o={perpendicular:i,orthogonal:i,opposite:function(t){var i=e,o="x"===t?0:1,s={x:function(){return 1===i.so[o]&&(i.startStubX>i.endStubX&&i.tx>i.startStubX||i.sx>i.endStubX&&i.tx>i.sx)||-1===i.so[o]&&(i.startStubX<i.endStubX&&i.tx<i.startStubX||i.sx<i.endStubX&&i.tx<i.sx)},y:function(){return 1===i.so[o]&&(i.startStubY>i.endStubY&&i.ty>i.startStubY||i.sy>i.endStubY&&i.ty>i.sy)||-1===i.so[o]&&(i.startStubY<i.endStubY&&i.ty<i.startStubY||i.sy<i.endStubY&&i.ty<i.sy)}};return!n.alwaysRespectStubs&&s[t]()?{x:[(e.sx+e.tx)/2,e.startStubY,(e.sx+e.tx)/2,e.endStubY],y:[e.startStubX,(e.sy+e.ty)/2,e.endStubX,(e.sy+e.ty)/2]}[t]:[e.startStubX,e.startStubY,e.endStubX,e.endStubY]}}[e.anchorOrientation](e.sourceAxis),s="x"===e.sourceAxis?0:1,r="x"===e.sourceAxis?1:0,a=o[s],l=o[r],c=o[s+2],u=o[r+2];this.addASegment(o[0],o[1],e);var h=e.startStubX+(e.endStubX-e.startStubX)*this.midpoint,d=e.startStubY+(e.endStubY-e.startStubY)*this.midpoint,p={x:[0,1],y:[1,0]},f={perpendicular:function(t,n,i,o,s){var r=e,a={x:[[r.startStubX,r.endStubX],null,[r.endStubX,r.startStubX]],y:[[r.startStubY,r.endStubY],null,[r.endStubY,r.startStubY]]},l={x:[[h,r.startStubY],[h,r.endStubY]],y:[[r.startStubX,d],[r.endStubX,d]]},c={x:[[r.endStubX,r.startStubY]],y:[[r.startStubX,r.endStubY]]},u={x:[[r.startStubX,r.endStubY],[r.endStubX,r.endStubY]],y:[[r.endStubX,r.startStubY],[r.endStubX,r.endStubY]]},f={x:[[r.startStubX,d],[r.endStubX,d],[r.endStubX,r.endStubY]],y:[[h,r.startStubY],[h,r.endStubY],[r.endStubX,r.endStubY]]},v={x:[r.startStubY,r.endStubY],y:[r.startStubX,r.endStubX]},g=p[t][0],y=p[t][1],m=r.so[g]+1,_=r.to[y]+1,x=-1===r.to[y]&&v[t][1]<v[t][0]||1===r.to[y]&&v[t][1]>v[t][0],b=a[t][m][0],k=a[t][m][1],C={x:[[[1,2,3,4],null,[2,1,4,3]],null,[[4,3,2,1],null,[3,4,1,2]]],y:[[[3,2,1,4],null,[2,3,4,1]],null,[[4,1,2,3],null,[1,4,3,2]]]}[t][m][_];return r.segment===C[3]||r.segment===C[2]&&x?l[t]:r.segment===C[2]&&k<b?c[t]:r.segment===C[2]&&k>=b||r.segment===C[1]&&!x?f[t]:r.segment===C[0]||r.segment===C[1]&&x?u[t]:void 0},orthogonal:function(t,n,i,o,s){var r=e,a={x:-1===r.so[0]?Math.min(n,o):Math.max(n,o),y:-1===r.so[1]?Math.min(n,o):Math.max(n,o)}[t];return{x:[[a,i],[a,s],[o,s]],y:[[i,a],[s,a],[s,o]]}[t]},opposite:function(i,o,r,a,l){var c=e,u={x:"y",y:"x"}[i],p={x:"h",y:"w"}[i],f=c["is"+i.toUpperCase()+"GreaterThanStubTimes2"];if(t.sourceEndpoint.elementId===t.targetEndpoint.elementId){var v=r+(1-t.sourceEndpoint._anchor.computedPosition[u])*t.sourceInfo[p]+n.maxStub;return{x:[[o,v],[a,v]],y:[[v,o],[v,a]]}[i]}return!f||1===c.so[s]&&o>a||-1===c.so[s]&&o<a?{x:[[o,d],[a,d]],y:[[h,o],[h,a]]}[i]:1===c.so[s]&&o<a||-1===c.so[s]&&o>a?{x:[[h,c.sy],[h,c.ty]],y:[[c.sx,d],[c.tx,d]]}[i]:void 0}}[e.anchorOrientation](e.sourceAxis,a,l,c,u);if(f)for(var v=0;v<f.length;v++)this.addASegment(f[v][0],f[v][1],e);this.addASegment(o[2],o[3],e),this.addASegment(e.tx,e.ty,e),this.writeSegments(e)}},{key:"transformGeometry",value:function(e,t,n){return e}}]),n}(As);Y(pa,"type","Flowchart"),cr(pa.type,pa),fo.registerHandler(Fs),fo.registerHandler(Ar),fo.registerHandler(Tr),cr(hr.type,hr);for(var fa={clientX:5e4,clientY:5e4,screenX:5e4,screenY:5e4,pageX:5e4,pageY:5e4},va=[],ga=0;ga<256;ga++)va[ga]=(ga<16?"0":"")+ga.toString(16);!function(){function e(t,n,i){V(this,e),this._jsPlumb=t,this.ok=n,this.equal=i,Y(this,"_divs",[]),Y(this,"mottle",void 0),this.mottle=new mi}U(e,[{key:"_t",value:function(e,t,n,i){this.mottle.trigger(e,t,{pageX:n,pageY:i,screenX:n,screenY:i,clientX:n,clientY:i})}},{key:"addDiv",value:function(e,t,n,i,o,s,r){var a=document.createElement("div");return a.style.position="absolute",a.innerHTML=e,t?t.appendChild(a):this._jsPlumb.getContainer().appendChild(a),a.setAttribute("id",e),a.style.left=(null!=i?i:Math.floor(1e3*Math.random()))+"px",a.style.top=(null!=o?o:Math.floor(1e3*Math.random()))+"px",n&&(a.className=n),s&&(a.style.width=s+"px"),r&&(a.style.height=r+"px"),this._divs.push(e),a}},{key:"addDivs",value:function(e,t){for(var n=0;n<e.length;n++)this.addDiv(e[n],t)}},{key:"assertEndpointCount",value:function(e,t){var n=this._jsPlumb.getEndpoints(e),i=n?n.length:0;this.equal(i,t,e.getAttribute("data-jtk-managed")+" has "+t+(t>1||0==t?" endpoints":" endpoint"))}},{key:"_assertManagedEndpointCount",value:function(e,t){var n=this._jsPlumb.getId(e),i=this._jsPlumb._managedElements[n];this.equal(i.endpoints.length,t,n+" has "+t+" endpoints in managed record")}},{key:"_assertManagedConnectionCount",value:function(e,t){var n=this._jsPlumb.getId(e),i=this._jsPlumb._managedElements[n];this.equal(i.connections.length,t,n+" has "+t+" connections in managed record")}},{key:"_registerDiv",value:function(e){this._divs.push(e)}},{key:"makeDragStartEvt",value:function(e){var t=this.makeEvent(e),n=this._jsPlumb.getContainer();return t.clientX+=n.offsetLeft,t.screenX+=n.offsetLeft,t.pageX+=n.offsetLeft,t.clientY+=n.offsetTop,t.screenY+=n.offsetTop,t.pageY+=n.offsetTop,t}},{key:"getAttribute",value:function(e,t){return e.getAttribute(t)}},{key:"dragNodeBy",value:function(e,t,n,i){(i=i||{}).before&&i.before();var o=this.makeEvent(e);this._jsPlumb.trigger(e,Kt,o),i.beforeMouseMove&&i.beforeMouseMove(),this._t(document,tn,o.pageX+t,o.pageY+n),i.beforeMouseUp&&i.beforeMouseUp(),this.mottle.trigger(document,nn,null),i.after&&i.after()}},{key:"dragNodeTo",value:function(e,t,n,i){i=i||{};var o=this._jsPlumb.viewport.getPosition(this._jsPlumb.getId(e));i.before&&i.before();var s=this.makeEvent(e);this._jsPlumb.trigger(e,Kt,s);var r=this._jsPlumb.getContainer().getBoundingClientRect();i.beforeMouseMove&&i.beforeMouseMove(),this._t(document,tn,r.x+t+o.w/2,r.y+n+o.h/2),i.beforeMouseUp&&i.beforeMouseUp(),this.mottle.trigger(document,nn,null),i.after&&i.after()}},{key:"dragToGroup",value:function(e,t,n){var i=this._jsPlumb.getGroup(t),o=this._jsPlumb.viewport.getPosition(i.elId),s=o.x+o.w/2,r=o.y+o.h/2;this.dragNodeTo(e,s,r,n)}},{key:"aSyncDragNodeBy",value:function(e,t,n,i){var o=this;(i=i||{}).before&&i.before();var s=this.makeEvent(e);this._jsPlumb.trigger(e,Kt,s),i.beforeMouseMove&&i.beforeMouseMove(),setTimeout((function(){o._t(document,tn,s.pageX+t,s.pageY+n),i.beforeMouseUp&&i.beforeMouseUp(),setTimeout((function(){o.mottle.trigger(document,nn,null),i.after&&i.after()}),45)}),45)}},{key:"dragANodeAround",value:function(e,t,n){this._jsPlumb.trigger(e,Kt,this.makeEvent(e));for(var i,o,s=50*Math.random(),r=0;r<s;r++){var a=(i=void 0,o=void 0,i=Math.floor(2e3*Math.random()),o=Math.floor(2e3*Math.random()),{clientX:i,clientY:o,screenX:i,screenY:o,pageX:i,pageY:o});e.style.left=a.screenX+"px",e.style.top=a.screenY+"px",this._jsPlumb.trigger(document,tn,a)}t&&this.ok(t(),n||"while dragging assert"),this._jsPlumb.trigger(document,nn,fa)}},{key:"dragConnection",value:function(e,t,n,i){var o=this.getCanvas(e),s=this.getCanvas(t),r=this.makeEvent(o),a=this.makeEvent(s);i=i||{};var l=this._jsPlumb.select().length;return this._jsPlumb.trigger(o,Kt,r),i.beforeMouseMove&&i.beforeMouseMove(),this._jsPlumb.trigger(n?s:document,tn,a),i.beforeMouseUp&&i.beforeMouseUp(),this._jsPlumb.trigger(n?s:document,nn,a),this._jsPlumb.select().get(l)}},{key:"aSyncDragConnection",value:function(e,t,n){var i=this;n=n||{};var o=this.getCanvas(e),s=this.getCanvas(t),r=this.makeEvent(o),a=this.makeEvent(s),l=this._jsPlumb.select().length;this._jsPlumb.trigger(o,Kt,r),setTimeout((function(){n.beforeMouseMove&&n.beforeMouseMove(),i._jsPlumb.trigger(document,tn,a),setTimeout((function(){n.beforeMouseUp&&n.beforeMouseUp(),i._jsPlumb.trigger(s,nn,a),n.after&&n.after(i._jsPlumb.select().get(l))}),5)}),5)}},{key:"dragAndAbortConnection",value:function(e){var t=this.getCanvas(e),n=this.makeEvent(t);this._jsPlumb.trigger(t,Kt,n),this._jsPlumb.trigger(document,tn,fa),this._jsPlumb.trigger(document,nn,fa)}},{key:"detachConnection",value:function(e,t){t=t||{};var n=this.getEndpointCanvas(e),i=this.makeEvent(n);t.before&&t.before(),this._jsPlumb.trigger(n,Kt,i),t.beforeMouseMove&&t.beforeMouseMove(),this._jsPlumb.trigger(document,tn,fa),t.beforeMouseUp&&t.beforeMouseUp(),this._jsPlumb.trigger(document,nn,fa),t.after&&t.after()}},{key:"detachAndReattachConnection",value:function(e,t){t=t||{};var n=this.getEndpointCanvas(e),i=this.makeEvent(n);t.before&&t.before(),this._jsPlumb.trigger(n,Kt,i),t.beforeMouseMove&&t.beforeMouseMove(),this._jsPlumb.trigger(document,tn,fa),this._jsPlumb.trigger(document,tn,i),t.beforeMouseUp&&t.beforeMouseUp(),this._jsPlumb.trigger(document,nn,i),t.after&&t.after()}},{key:"detachConnectionByTarget",value:function(e,t){this.detachConnection(e.endpoints[1],t)}},{key:"relocateTarget",value:function(e,t,n){this.relocate(e,1,t,n)}},{key:"relocate",value:function(e,t,n,i){i=i||{},n=this.getCanvas(n);var o=this.getEndpointCanvas(e.endpoints[t]),s=this.makeEvent(o),r=this.makeEvent(n);i.before&&i.before(),this._jsPlumb.trigger(o,Kt,s),i.beforeMouseMove&&i.beforeMouseMove(),this._jsPlumb.trigger(document,tn,r),i.beforeMouseUp&&i.beforeMouseUp(),this._jsPlumb.trigger(n,nn,r),i.after&&i.after()}},{key:"relocateSource",value:function(e,t,n){this.relocate(e,0,t,n)}},{key:"makeEvent",value:function(e){var t=e.getBoundingClientRect(),n=t.x+t.width/2,i=t.y+t.height/2;return{clientX:n,clientY:i,screenX:n,screenY:i,pageX:n,pageY:i}}},{key:"getCanvas",value:function(e){return e.endpoint?this.getEndpointCanvas(e):e}},{key:"getEndpointCanvas",value:function(e){return e.endpoint.canvas}},{key:"getConnectionCanvas",value:function(e){return e.connector.canvas}},{key:"getEndpointCanvasPosition",value:function(e){var t=this.getEndpointCanvas(e);return{x:parseInt(t.style.left,10),y:parseInt(t.style.top,10),w:t.getAttribute("width"),h:t.getAttribute("height")}}},{key:"within",value:function(e,t,n){this.ok(Math.abs(e-t)<1e-11,n+"[expected: "+t+" got "+e+"] [diff:"+Math.abs(e-t)+"]")}},{key:"assertManagedEndpointCount",value:function(e,t){var n=this._jsPlumb.getId(e),i=this._jsPlumb._managedElements[n];this.equal(i.endpoints.length,t,n+" has "+t+" endpoints in managed record")}},{key:"assertManagedConnectionCount",value:function(e,t){var n=this._jsPlumb.getId(e),i=this._jsPlumb._managedElements[n];this.equal(i.connections.length,t,n+" has "+t+" connections in managed record")}},{key:"fireEventOnEndpoint",value:function(e){for(var t=this.getEndpointCanvas(e),n=0;n<(arguments.length<=1?0:arguments.length-1);n++)this._jsPlumb.trigger(t,n+1<1||arguments.length<=n+1?void 0:arguments[n+1])}},{key:"fireEventOnElement",value:function(e){for(var t=0;t<(arguments.length<=1?0:arguments.length-1);t++)this._jsPlumb.trigger(e,t+1<1||arguments.length<=t+1?void 0:arguments[t+1])}},{key:"fireEventOnConnection",value:function(e){for(var t=this.getConnectionCanvas(e),n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];this.fireEventOnElement.apply(this,[t].concat(i))}},{key:"clickOnConnection",value:function(e){this.fireEventOnConnection(e,Wt)}},{key:"dblClickOnConnection",value:function(e){this.fireEventOnConnection(e,Zt)}},{key:"tapOnConnection",value:function(e){this.fireEventOnConnection(e,Kt),this.fireEventOnConnection(e,nn)}},{key:"dblTapOnConnection",value:function(e){this.fireEventOnConnection(e,Kt),this.fireEventOnConnection(e,nn),this.fireEventOnConnection(e,Kt),this.fireEventOnConnection(e,nn)}},{key:"clickOnElement",value:function(e,t){this._jsPlumb.trigger(e,Wt,null,null,null==t?1:t)}},{key:"dblClickOnElement",value:function(e){this._jsPlumb.trigger(e,Zt)}},{key:"tapOnElement",value:function(e){this._jsPlumb.trigger(e,Kt),this._jsPlumb.trigger(e,nn)}},{key:"dblTapOnElement",value:function(e){this._jsPlumb.trigger(e,Kt),this._jsPlumb.trigger(e,nn),this._jsPlumb.trigger(e,Kt),this._jsPlumb.trigger(e,nn)}},{key:"getOverlayCanvas",value:function(e){return e.canvas||e.path}},{key:"fireEventOnOverlay",value:function(e,t,n){var i=e.getOverlay(t),o=this.getOverlayCanvas(i);this._jsPlumb.trigger(o,n)}},{key:"clickOnOverlay",value:function(e,t){this.fireEventOnOverlay(e,t,Wt)}},{key:"dblClickOnOverlay",value:function(e,t){this.fireEventOnOverlay(e,t,Zt)}},{key:"tapOnOverlay",value:function(e,t){this.fireEventOnOverlay(e,t,Kt),this.fireEventOnOverlay(e,t,nn)}},{key:"dblTapOnOverlay",value:function(e,t){this.fireEventOnOverlay(e,t,Kt),this.fireEventOnOverlay(e,t,nn),this.fireEventOnOverlay(e,t,Kt),this.fireEventOnOverlay(e,t,nn)}},{key:"cleanup",value:function(){var e=this._jsPlumb.getContainer();for(var t in this._jsPlumb.destroy(),this._divs){var n=document.getElementById(this._divs[t]);n&&n.parentNode.removeChild(n)}this._divs.length=0;var i=this._jsPlumb.select().length,o=this._jsPlumb.selectEndpoints().length,s=e.querySelectorAll(".jtk-endpoint").length,r=e.querySelectorAll(".jtk-connector").length;for(var a in e.__ta)for(var l in e.__ta[a])throw"Container event bindings not empty for key "+a;if(i>0)throw"there are connections in the data model!";if(o>0)throw"there are endpoints in the data model!";if(s>0)throw"there are "+s+" endpoints left in the dom!";if(r>0)throw"there are "+r+" connections left in the dom!"}},{key:"makeContent",value:function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstChild}},{key:"length",value:function(e){var t=0;for(var n in e)e.hasOwnProperty(n)&&t++;return t}},{key:"head",value:function(e){for(var t in e)return e[t]}},{key:"uuid",value:function(){return we()}}])}();var ya,ma,_a,xa,ba,ka,Ca,Ea=0;function Sa(e){return new Pr(function(){var e=Ea+1;return Ea++,e}(),e)}class Pa{constructor(e){this.Model=e,this.HorizontalMargin=45,this.VerticalMargin=10}Render(){var e;this.LineDictionary=new Map,this.CreateDictionary(this.RootNode),this.RootContainer.innerHTML="",this.Canvas=document.createElement("div"),this.Canvas.style.position="relative",this.Canvas.style.width="100%",this.Canvas.style.height="100%",this.RootContainer.appendChild(this.Canvas),e=()=>{this.RootNode.Render(),this.Layout(this.RootNode),this.PlumberInstance=Sa({container:this.Canvas,connectionsDetachable:!1,elementsDraggable:!1}),this.RootNode.CreateEndPoints(),this.RootNode.CreateRelations()},function t(){/complete|loaded|interactive/.test(document.readyState)&&void 0!==document.body&&null!=document.body?e():setTimeout(t,9)}()}CreateDictionary(e){this.LineDictionary.has(e.Level)?this.LineDictionary.get(e.Level).push(e):this.LineDictionary.set(e.Level,[e]),e.Children.forEach((e=>this.CreateDictionary(e)))}Layout(e){let t=this.Canvas.getBoundingClientRect().width;this.RootNode.GetAreaWidth()>t&&(t=this.RootNode.GetAreaWidth()),this.CenterNode(0,this.RootNode,0,t)}CenterNode(e,t,n,i){let o=(i-n)/2+n;t.Instance.style.top=e+"px",t.Instance.style.left=o-t.Width/2+"px";let s=0;for(let e of t.Children)s+=e.GetAreaWidth();s+=this.HorizontalMargin*(t.Children.length-1);let r=o-s/2;e+=this.LineDictionary.get(t.Level).reduce(((e,t)=>Math.max(e,t.Height)),0)+this.HorizontalMargin;for(let n of t.Children)this.CenterNode(e,n,r,r+n.GetAreaWidth()),r+=n.Width+this.HorizontalMargin}}class wa extends t.ModelBase{constructor(e){super(e),this.Diagram=new Pa(this),this.RootNode=new H(this,this.Options.Node).Initialize(),this.Diagram.RootNode=this.RootNode,this.SetForm(this.Options.FormId),this.DataSource=new g.DataSource(this),window.addEventListener("resize",(()=>{setTimeout((()=>{this.Diagram.Render()}),500)}))}get AutomationBuilder(){return this}render(){return e.html`<rnaut-workflow-builder .model="${this}"></rnaut-workflow-builder>`}async Save(){let e=this.GetOptions();e.Node=this.RootNode.GetOptions();let t=await f.WpAjaxPost.Post("save_workflow",{Options:e});null!=t&&(this.Options.Id=t.Id,window.history.replaceState({},document.title,rnBuilderVar.BuilderURL+"&id="+t.Id),c.ToastService.SendSuccess("Automation saved successfully"))}SetForm(e){let t=rnBuilderVar.FormList.find((t=>t.Id==e));this.formBuilder=null==t?null:new v.DataSourceForm(e,t.Name),this.Options.FormId=e}SetSelectedNode(e){null==e?document.getElementById("app").classList.remove("settings"):document.getElementById("app").classList.add("settings"),this.SelectedNode=e,this.Refresh()}GetNodeList(e=null,t=[]){return null==e&&(e=this.RootNode),t.push(e),e.Children.forEach((e=>this.GetNodeList(e,t))),t}GetFormBuilder(){return this.formBuilder}}let Aa=(ya=y.StoreAutoIncrement("DiagramNode"),ma=y.StoreDataType(Object),_a=y.StoreDataType(m.ConditionBaseOptions),xa=class extends y.StoreBase{constructor(...e){super(...e),babelHelpers.initializerDefineProperty(this,"Id",ba,this),this.Type="",babelHelpers.initializerDefineProperty(this,"Children",ka,this),babelHelpers.initializerDefineProperty(this,"Condition",Ca,this)}LoadDefaultValues(){this.Id=0,this.Title="",this.Type="",this.Children=[],this.Condition=(new m.ConditionBaseOptions).Merge()}GetValueFromLoader(e,t){switch(e){case"Children":return class{static GetDiagramNode(e){return a.EventManager.Publish("GetNodeOptions",e)}static GetDiagramNodeList(e){let t=[];for(let n of e)t.push(this.GetDiagramNode(n));return t}}.GetDiagramNodeList(t);default:return null}}},ba=babelHelpers.applyDecoratedDescriptor(xa.prototype,"Id",[ya],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ka=babelHelpers.applyDecoratedDescriptor(xa.prototype,"Children",[ma],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ca=babelHelpers.applyDecoratedDescriptor(xa.prototype,"Condition",[_a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xa);class Ma extends Aa{LoadDefaultValues(){super.LoadDefaultValues(),this.Type="Root"}}a.EventManager.Subscribe("GetNodeOptions",(e=>{if("Root"==e.Type)return(new Ma).Merge(e)}));class Da extends y.StoreBase{constructor(...e){super(...e),this.FormId=""}LoadDefaultValues(){this.Id=0,this.TriggerType="form_submitted",this.Name="",this.FormId="",this.Status="disabled",this.Node=(new Ma).Merge()}}class Ta extends ${constructor(e=null,t){super(e,t),this.ActionModel=b.ActionFactory.GetModel(t.ActionOptions,e.RootNode.Model)}InnerRender(){return this.Options.Title}GetSettings(){return this.ActionModel.GetSettings().map((e=>(e.Item.Label=e.Label,e.Item)))}GetAdditionalSettingSections(){return[...this.ActionModel.GetAdditionalSettingSections(),...super.GetAdditionalSettingSections()]}GetOptions(){let e=super.GetOptions();return e.ActionOptions=this.ActionModel.GetOptions(),e}GetDependencies(){return[]}InitializeOptionsForFirstTime(){super.InitializeOptionsForFirstTime(),this.ActionModel.InitializeOptionsForFirstTime()}}var Oa,ja,Ia;a.EventManager.Subscribe("GetNode",(e=>{if("Action"==e.Options.Type)return new Ta(e.Parent,e.Options).Initialize()}));let Ga=(Oa=y.StoreDataType(Object),ja=class extends Aa{constructor(...e){super(...e),babelHelpers.initializerDefineProperty(this,"ActionOptions",Ia,this)}LoadDefaultValues(){super.LoadDefaultValues(),this.Type="Action",this.ActionOptions=null}},Ia=babelHelpers.applyDecoratedDescriptor(ja.prototype,"ActionOptions",[Oa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ja);a.EventManager.Subscribe("GetNodeOptions",(e=>{if("Action"==e.Type)return(new Ga).Merge(e)}));var La,Na,Fa,Ra,$a,Ha,Ba,Va,za,Ua,Ya,Xa,Wa,qa,Za,Ja,Ka,Qa,el=[{Type:"approve",Title:"Approve",Description:"Request the approval of the entry before going to the next step"}];let tl=(La=y.StoreDataType(Object),Na=y.StoreDataType(Object),Fa=class extends Aa{constructor(...e){super(...e),babelHelpers.initializerDefineProperty(this,"AssignTo",Ra,this),babelHelpers.initializerDefineProperty(this,"HeaderInstructions",$a,this)}LoadDefaultValues(){super.LoadDefaultValues(),this.Type="approve",this.Title="Approve",this.AssignTo=[],this.ApprovalType="one",this.DisplayInstructions=!1,this.HeaderInstructions=null,this.WorkflowStepAfterAccept=0,this.WorkflowStepAfterReject=0,this.AssignEmail=(new nl).Merge(),this.ApproveEmail=(new nl).Merge(),this.RejectEmail=(new nl).Merge()}},Ra=babelHelpers.applyDecoratedDescriptor(Fa.prototype,"AssignTo",[La],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$a=babelHelpers.applyDecoratedDescriptor(Fa.prototype,"HeaderInstructions",[Na],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fa),nl=(Ha=y.StoreDataType(Object),Ba=y.StoreDataType(k.EmailAddress),Va=y.StoreDataType(k.EmailAddress),za=y.StoreDataType(k.EmailAddress),Ua=y.StoreDataType(k.EmailAddress),Ya=y.StoreDataType(Object),Xa=class extends y.StoreBase{constructor(...e){super(...e),babelHelpers.initializerDefineProperty(this,"Email",Wa,this),babelHelpers.initializerDefineProperty(this,"To",qa,this),babelHelpers.initializerDefineProperty(this,"ReplyTo",Za,this),babelHelpers.initializerDefineProperty(this,"CC",Ja,this),babelHelpers.initializerDefineProperty(this,"BCC",Ka,this),babelHelpers.initializerDefineProperty(this,"Subject",Qa,this)}LoadDefaultValues(){this.Enabled=!1,this.To=[],this.ReplyTo=[],this.CC=[],this.BCC=[],this.Subject=null,this.FromName="",this.FromEmailAddress="",this.Email=null}},Wa=babelHelpers.applyDecoratedDescriptor(Xa.prototype,"Email",[Ha],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qa=babelHelpers.applyDecoratedDescriptor(Xa.prototype,"To",[Ba],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Za=babelHelpers.applyDecoratedDescriptor(Xa.prototype,"ReplyTo",[Va],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ja=babelHelpers.applyDecoratedDescriptor(Xa.prototype,"CC",[za],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ka=babelHelpers.applyDecoratedDescriptor(Xa.prototype,"BCC",[Ua],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qa=babelHelpers.applyDecoratedDescriptor(Xa.prototype,"Subject",[Ya],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xa);a.EventManager.Subscribe("GetNodeOptions",(e=>{if("approve"==e.Type)return(new tl).Merge(e)}));class il extends ${InnerRender(){return this.Options.Title}GetDependencyProperties(){return[]}GetAllowAddingNodes(){return!0}GetDependencies(){let e=this.GetDependencyProperties(),t=[];for(let n of e){let e=this.Options[n.PropertyName];if(null==e)continue;let i=this.RootNode.GetNodeById(e);null!=i&&t.push({Node:i,Label:n.Title,Position:n.Position})}return t}}var ol,sl,rl,al;i.customElement("rnwf-workflow-property")(class extends C.DropdownProperty{SubRender(){return e.html` <select ?multiple="${this.model._multiple}" value="${this.model.GetValue()}" style="width: 100%;max-width: 100%;display: none;"> <option></option> ${s.repeat(this.model.Items,(e=>e.Value),(t=>e.html`<option ?selected="${this.IsSelected(t.Value)}" .value="${t.Value}">${t.Label}</option>`))} ${r.rnIf(null!=this.model.OnCreateNode&&e.html`<option value="_new">Create new step</option>`)} </select> `}});const ll=window,cl=e=>{ll.emitLitDebugLogEvents&&ll.dispatchEvent(new CustomEvent("lit-debug",{detail:e}))};let ul;null!==(ol=ll.litIssuedWarnings)&&void 0!==ol||(ll.litIssuedWarnings=new Set),ul=(e,t)=>{t+=e?` See https://lit.dev/msg/${e} for more information.`:"",ll.litIssuedWarnings.has(t)||(console.warn(t),ll.litIssuedWarnings.add(t))},ul("dev-mode","Lit is in dev mode. Not recommended for production!");const hl=(null===(sl=ll.ShadyDOM)||void 0===sl?void 0:sl.inUse)&&!0===(null===(rl=ll.ShadyDOM)||void 0===rl?void 0:rl.noPatch)?ll.ShadyDOM.wrap:e=>e,dl=ll.trustedTypes,pl=dl?dl.createPolicy("lit-html",{createHTML:e=>e}):void 0,fl=e=>e,vl=(e,t,n)=>fl,gl=(e,t,n)=>Ll(e,t,n),yl="$lit$",ml=`lit$${String(Math.random()).slice(9)}$`,_l="?"+ml,xl=`<${_l}>`,bl=document,kl=(e="")=>bl.createComment(e),Cl=e=>null===e||"object"!=typeof e&&"function"!=typeof e,El=Array.isArray,Sl=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Pl=/-->/g,wl=/>/g,Al=new RegExp(">|[ \t\n\f\r](?:([^\\s\"'>=/]+)([ \t\n\f\r]*=[ \t\n\f\r]*(?:[^ \t\n\f\r\"'`<>=]|(\"|')|))|$)","g"),Ml=/'/g,Dl=/"/g,Tl=/^(?:script|style|textarea|title)$/i,Ol=Symbol.for("lit-noChange"),jl=Symbol.for("lit-nothing"),Il=new WeakMap,Gl=bl.createTreeWalker(bl,129,null,!1);let Ll=vl;class Nl{constructor({strings:e,_$litType$:t},n){let i;this.parts=[];let o=0,s=0;const r=e.length-1,a=this.parts,[l,c]=((e,t)=>{const n=e.length-1,i=[];let o,s=2===t?"<svg>":"",r=Sl;for(let t=0;t<n;t++){const n=e[t];let a,l,c=-1,u=0;for(;u<n.length&&(r.lastIndex=u,l=r.exec(n),null!==l);)if(u=r.lastIndex,r===Sl){if("!--"===l[1])r=Pl;else if(void 0!==l[1])r=wl;else if(void 0!==l[2])Tl.test(l[2])&&(o=new RegExp(`</${l[2]}`,"g")),r=Al;else if(void 0!==l[3])throw new Error("Bindings in tag names are not supported. Please use static templates instead. See https://lit.dev/docs/templates/expressions/#static-expressions")}else r===Al?">"===l[0]?(r=null!=o?o:Sl,c=-1):void 0===l[1]?c=-2:(c=r.lastIndex-l[2].length,a=l[1],r=void 0===l[3]?Al:'"'===l[3]?Dl:Ml):r===Dl||r===Ml?r=Al:r===Pl||r===wl?r=Sl:(r=Al,o=void 0);console.assert(-1===c||r===Al||r===Ml||r===Dl,"unexpected parse state B");const h=r===Al&&e[t+1].startsWith("/>")?" ":"";s+=r===Sl?n+xl:c>=0?(i.push(a),n.slice(0,c)+yl+n.slice(c)+ml+h):n+ml+(-2===c?(i.push(void 0),t):h)}const a=s+(e[n]||"<?>")+(2===t?"</svg>":"");if(!Array.isArray(e)||!e.hasOwnProperty("raw")){let e="invalid template strings array";throw e=" Internal Error: expected template strings to be an array with a 'raw' field. Faking a template strings array by calling html or svg like an ordinary function is effectively the same as calling unsafeHtml and can lead to major security issues, e.g. opening your code up to XSS attacks. If you're using the html or svg tagged template functions normally and and still seeing this error, please file a bug at https://github.com/lit/lit/issues/new?template=bug_report.md and include information about your build tooling, if any. ".trim().replace(/\n */g,"\n"),new Error(e)}return[void 0!==pl?pl.createHTML(a):a,i]})(e,t);if(this.el=Nl.createElement(l,n),Gl.currentNode=this.el.content,2===t){const e=this.el.content,t=e.firstChild;t.remove(),e.append(...t.childNodes)}for(;null!==(i=Gl.nextNode())&&a.length<r;){if(1===i.nodeType){{const e=i.localName;if(/^(?:textarea|template)$/i.test(e)&&i.innerHTML.includes(ml)){const t=`Expressions are not supported inside \`${e}\` elements. See https://lit.dev/msg/expression-in-${e} for more information.`;if("template"===e)throw new Error(t);ul("",t)}}if(i.hasAttributes()){const e=[];for(const t of i.getAttributeNames())if(t.endsWith(yl)||t.startsWith(ml)){const n=c[s++];if(e.push(t),void 0!==n){const e=i.getAttribute(n.toLowerCase()+yl).split(ml),t=/([.?@])?(.*)/.exec(n);a.push({type:1,index:o,name:t[2],strings:e,ctor:"."===t[1]?Bl:"?"===t[1]?zl:"@"===t[1]?Ul:Hl})}else a.push({type:6,index:o})}for(const t of e)i.removeAttribute(t)}if(Tl.test(i.tagName)){const e=i.textContent.split(ml),t=e.length-1;if(t>0){i.textContent=dl?dl.emptyScript:"";for(let n=0;n<t;n++)i.append(e[n],kl()),Gl.nextNode(),a.push({type:2,index:++o});i.append(e[t],kl())}}}else if(8===i.nodeType){if(i.data===_l)a.push({type:2,index:o});else{let e=-1;for(;-1!==(e=i.data.indexOf(ml,e+1));)a.push({type:7,index:o}),e+=ml.length-1}}o++}null==cl||cl({kind:"template prep",template:this,clonableTemplate:this.el,parts:this.parts,strings:e})}static createElement(e,t){const n=bl.createElement("template");return n.innerHTML=e,n}}function Fl(e,t,n=e,i){var o,s,r,a;if(t===Ol)return t;let l=void 0!==i?null===(o=n.__directives)||void 0===o?void 0:o[i]:n.__directive;const c=Cl(t)?void 0:t._$litDirective$;return(null==l?void 0:l.constructor)!==c&&(null===(s=null==l?void 0:l._$notifyDirectiveConnectionChanged)||void 0===s||s.call(l,!1),void 0===c?l=void 0:(l=new c(e),l._$initialize(e,n,i)),void 0!==i?(null!==(r=(a=n).__directives)&&void 0!==r?r:a.__directives=[])[i]=l:n.__directive=l),void 0!==l&&(t=Fl(e,l._$resolve(e,t.values),l,i)),t}class Rl{constructor(e,t){this._parts=[],this._$disconnectableChildren=void 0,this._$template=e,this._$parent=t}get parentNode(){return this._$parent.parentNode}get _$isConnected(){return this._$parent._$isConnected}_clone(e){var t;const{el:{content:n},parts:i}=this._$template,o=(null!==(t=null==e?void 0:e.creationScope)&&void 0!==t?t:bl).importNode(n,!0);Gl.currentNode=o;let s=Gl.nextNode(),r=0,a=0,l=i[0];for(;void 0!==l;){if(r===l.index){let t;2===l.type?t=new $l(s,s.nextSibling,this,e):1===l.type?t=new l.ctor(s,l.name,l.strings,this,e):6===l.type&&(t=new Yl(s,this,e)),this._parts.push(t),l=i[++a]}r!==(null==l?void 0:l.index)&&(s=Gl.nextNode(),r++)}return o}_update(e){let t=0;for(const n of this._parts)void 0!==n&&(null==cl||cl({kind:"set part",part:n,value:e[t],valueIndex:t,values:e,templateInstance:this}),void 0!==n.strings?(n._$setValue(e,n,t),t+=n.strings.length-2):n._$setValue(e[t])),t++}}class $l{constructor(e,t,n,i){var o;this.type=2,this._$committedValue=jl,this._$disconnectableChildren=void 0,this._$startNode=e,this._$endNode=t,this._$parent=n,this.options=i,this.__isConnected=null===(o=null==i?void 0:i.isConnected)||void 0===o||o,this._textSanitizer=void 0}get _$isConnected(){var e,t;return null!==(t=null===(e=this._$parent)||void 0===e?void 0:e._$isConnected)&&void 0!==t?t:this.__isConnected}get parentNode(){let e=hl(this._$startNode).parentNode;const t=this._$parent;return void 0!==t&&11===e.nodeType&&(e=t.parentNode),e}get startNode(){return this._$startNode}get endNode(){return this._$endNode}_$setValue(e,t=this){var n;if(null===this.parentNode)throw new Error("This `ChildPart` has no `parentNode` and therefore cannot accept a value. This likely means the element containing the part was manipulated in an unsupported way outside of Lit's control such that the part's marker nodes were ejected from DOM. For example, setting the element's `innerHTML` or `textContent` can do this.");if(e=Fl(this,e,t),Cl(e))e===jl||null==e||""===e?(this._$committedValue!==jl&&(null==cl||cl({kind:"commit nothing to child",start:this._$startNode,end:this._$endNode,parent:this._$parent,options:this.options}),this._$clear()),this._$committedValue=jl):e!==this._$committedValue&&e!==Ol&&this._commitText(e);else if(void 0!==e._$litType$)this._commitTemplateResult(e);else if(void 0!==e.nodeType){if((null===(n=this.options)||void 0===n?void 0:n.host)===e)return this._commitText("[probable mistake: rendered a template's host in itself (commonly caused by writing ${this} in a template]"),void console.warn("Attempted to render the template host",e,"inside itself. This is almost always a mistake, and in dev mode ","we render some warning text. In production however, we'll ","render it, which will usually result in an error, and sometimes ","in the element disappearing from the DOM.");this._commitNode(e)}else(e=>El(e)||"function"==typeof(null==e?void 0:e[Symbol.iterator]))(e)?this._commitIterable(e):this._commitText(e)}_insert(e,t=this._$endNode){return hl(hl(this._$startNode).parentNode).insertBefore(e,t)}_commitNode(e){var t;if(this._$committedValue!==e){if(this._$clear(),Ll!==vl){const e=null===(t=this._$startNode.parentNode)||void 0===t?void 0:t.nodeName;if("STYLE"===e||"SCRIPT"===e){let t="Forbidden";throw t="STYLE"===e?"Lit does not support binding inside style nodes. This is a security risk, as style injection attacks can exfiltrate data and spoof UIs. Consider instead using css`...` literals to compose styles, and make do dynamic styling with css custom properties, ::parts, <slot>s, and by mutating the DOM rather than stylesheets.":"Lit does not support binding inside script nodes. This is a security risk, as it could allow arbitrary code execution.",new Error(t)}}null==cl||cl({kind:"commit node",start:this._$startNode,parent:this._$parent,value:e,options:this.options}),this._$committedValue=this._insert(e)}}_commitText(e){if(this._$committedValue!==jl&&Cl(this._$committedValue)){const t=hl(this._$startNode).nextSibling;void 0===this._textSanitizer&&(this._textSanitizer=gl(t,"data","property")),e=this._textSanitizer(e),null==cl||cl({kind:"commit text",node:t,value:e,options:this.options}),t.data=e}else{const t=document.createTextNode("");this._commitNode(t),void 0===this._textSanitizer&&(this._textSanitizer=gl(t,"data","property")),e=this._textSanitizer(e),null==cl||cl({kind:"commit text",node:t,value:e,options:this.options}),t.data=e}this._$committedValue=e}_commitTemplateResult(e){var t;const{values:n,_$litType$:i}=e,o="number"==typeof i?this._$getTemplate(e):(void 0===i.el&&(i.el=Nl.createElement(i.h,this.options)),i);if((null===(t=this._$committedValue)||void 0===t?void 0:t._$template)===o)null==cl||cl({kind:"template updating",template:o,instance:this._$committedValue,parts:this._$committedValue._parts,options:this.options,values:n}),this._$committedValue._update(n);else{const e=new Rl(o,this),t=e._clone(this.options);null==cl||cl({kind:"template instantiated",template:o,instance:e,parts:e._parts,options:this.options,fragment:t,values:n}),e._update(n),null==cl||cl({kind:"template instantiated and updated",template:o,instance:e,parts:e._parts,options:this.options,fragment:t,values:n}),this._commitNode(t),this._$committedValue=e}}_$getTemplate(e){let t=Il.get(e.strings);return void 0===t&&Il.set(e.strings,t=new Nl(e)),t}_commitIterable(e){El(this._$committedValue)||(this._$committedValue=[],this._$clear());const t=this._$committedValue;let n,i=0;for(const o of e)i===t.length?t.push(n=new $l(this._insert(kl()),this._insert(kl()),this,this.options)):n=t[i],n._$setValue(o),i++;i<t.length&&(this._$clear(n&&hl(n._$endNode).nextSibling,i),t.length=i)}_$clear(e=hl(this._$startNode).nextSibling,t){var n;for(null===(n=this._$notifyConnectionChanged)||void 0===n||n.call(this,!1,!0,t);e&&e!==this._$endNode;){const t=hl(e).nextSibling;hl(e).remove(),e=t}}setConnected(e){var t;if(void 0!==this._$parent)throw new Error("part.setConnected() may only be called on a RootPart returned from render().");this.__isConnected=e,null===(t=this._$notifyConnectionChanged)||void 0===t||t.call(this,e)}}class Hl{constructor(e,t,n,i,o){this.type=1,this._$committedValue=jl,this._$disconnectableChildren=void 0,this.element=e,this.name=t,this._$parent=i,this.options=o,n.length>2||""!==n[0]||""!==n[1]?(this._$committedValue=new Array(n.length-1).fill(new String),this.strings=n):this._$committedValue=jl,this._sanitizer=void 0}get tagName(){return this.element.tagName}get _$isConnected(){return this._$parent._$isConnected}_$setValue(e,t=this,n,i){const o=this.strings;let s=!1;if(void 0===o)e=Fl(this,e,t,0),s=!Cl(e)||e!==this._$committedValue&&e!==Ol,s&&(this._$committedValue=e);else{const i=e;let r,a;for(e=o[0],r=0;r<o.length-1;r++)a=Fl(this,i[n+r],t,r),a===Ol&&(a=this._$committedValue[r]),s||(s=!Cl(a)||a!==this._$committedValue[r]),a===jl?e=jl:e!==jl&&(e+=(null!=a?a:"")+o[r+1]),this._$committedValue[r]=a}s&&!i&&this._commitValue(e)}_commitValue(e){e===jl?hl(this.element).removeAttribute(this.name):(void 0===this._sanitizer&&(this._sanitizer=Ll(this.element,this.name)),e=this._sanitizer(null!=e?e:""),null==cl||cl({kind:"commit attribute",element:this.element,name:this.name,value:e,options:this.options}),hl(this.element).setAttribute(this.name,null!=e?e:""))}}class Bl extends Hl{constructor(){super(...arguments),this.type=3}_commitValue(e){void 0===this._sanitizer&&(this._sanitizer=Ll(this.element,this.name)),e=this._sanitizer(e),null==cl||cl({kind:"commit property",element:this.element,name:this.name,value:e,options:this.options}),this.element[this.name]=e===jl?void 0:e}}const Vl=dl?dl.emptyScript:"";class zl extends Hl{constructor(){super(...arguments),this.type=4}_commitValue(e){null==cl||cl({kind:"commit boolean attribute",element:this.element,name:this.name,value:!(!e||e===jl),options:this.options}),e&&e!==jl?hl(this.element).setAttribute(this.name,Vl):hl(this.element).removeAttribute(this.name)}}class Ul extends Hl{constructor(e,t,n,i,o){if(super(e,t,n,i,o),this.type=5,void 0!==this.strings)throw new Error(`A \`<${e.localName}>\` has a \`@${t}=...\` listener with invalid content. Event listeners in templates must have exactly one expression and no surrounding text.`)}_$setValue(e,t=this){var n;if((e=null!==(n=Fl(this,e,t,0))&&void 0!==n?n:jl)===Ol)return;const i=this._$committedValue,o=e===jl&&i!==jl||e.capture!==i.capture||e.once!==i.once||e.passive!==i.passive,s=e!==jl&&(i===jl||o);null==cl||cl({kind:"commit event listener",element:this.element,name:this.name,value:e,options:this.options,removeListener:o,addListener:s,oldListener:i}),o&&this.element.removeEventListener(this.name,this,i),s&&this.element.addEventListener(this.name,this,e),this._$committedValue=e}handleEvent(e){var t,n;"function"==typeof this._$committedValue?this._$committedValue.call(null!==(n=null===(t=this.options)||void 0===t?void 0:t.host)&&void 0!==n?n:this.element,e):this._$committedValue.handleEvent(e)}}class Yl{constructor(e,t,n){this.element=e,this.type=6,this._$disconnectableChildren=void 0,this._$parent=t,this.options=n}get _$isConnected(){return this._$parent._$isConnected}_$setValue(e){null==cl||cl({kind:"commit to element binding",element:this.element,value:e,options:this.options}),Fl(this,e)}}const Xl=ll.litHtmlPolyfillSupportDevMode;var Wl,ql;null==Xl||Xl(Nl,$l),(null!==(al=ll.litHtmlVersions)&&void 0!==al?al:ll.litHtmlVersions=[]).push("2.3.1"),ll.litHtmlVersions.length>1&&ul("multiple-versions","Multiple versions of Lit loaded. Loading multiple versions is not recommended."),(null===(Wl=window.ShadyDOM)||void 0===Wl?void 0:Wl.inUse)&&!0===(null===(ql=window.ShadyDOM)||void 0===ql?void 0:ql.noPatch)&&window.ShadyDOM.wrap;const Zl=2;const Jl=(e,t)=>{var n,i;const o=e._$disconnectableChildren;if(void 0===o)return!1;for(const e of o)null===(i=(n=e)._$notifyDirectiveConnectionChanged)||void 0===i||i.call(n,t,!1),Jl(e,t);return!0},Kl=e=>{let t,n;do{if(void 0===(t=e._$parent))break;n=t._$disconnectableChildren,n.delete(e),e=t}while(0===(null==n?void 0:n.size))},Ql=e=>{for(let t;t=e._$parent;e=t){let n=t._$disconnectableChildren;if(void 0===n)t._$disconnectableChildren=n=new Set;else if(n.has(e))break;n.add(e),nc(t)}};function ec(e){void 0!==this._$disconnectableChildren?(Kl(this),this._$parent=e,Ql(this)):this._$parent=e}function tc(e,t=!1,n=0){const i=this._$committedValue,o=this._$disconnectableChildren;if(void 0!==o&&0!==o.size)if(t)if(Array.isArray(i))for(let e=n;e<i.length;e++)Jl(i[e],!1),Kl(i[e]);else null!=i&&(Jl(i,!1),Kl(i));else Jl(this,e)}const nc=e=>{var t,n,i,o;e.type==Zl&&(null!==(t=(i=e)._$notifyConnectionChanged)&&void 0!==t||(i._$notifyConnectionChanged=tc),null!==(n=(o=e)._$reparentDisconnectables)&&void 0!==n||(o._$reparentDisconnectables=ec))};const ic=new WeakMap;const oc=(sc=class extends class extends class{constructor(e){}get _$isConnected(){return this._$parent._$isConnected}_$initialize(e,t,n){this.__part=e,this._$parent=t,this.__attributeIndex=n}_$resolve(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}}{constructor(){super(...arguments),this._$disconnectableChildren=void 0}_$initialize(e,t,n){super._$initialize(e,t,n),Ql(this),this.isConnected=e._$isConnected}_$notifyDirectiveConnectionChanged(e,t=!0){var n,i;e!==this.isConnected&&(this.isConnected=e,e?null===(n=this.reconnected)||void 0===n||n.call(this):null===(i=this.disconnected)||void 0===i||i.call(this)),t&&(Jl(this,e),Kl(this))}setValue(e){if(void 0===this.__part.strings)this.__part._$setValue(e,this);else{if(void 0===this.__attributeIndex)throw new Error("Expected this.__attributeIndex to be a number");const t=[...this.__part._$committedValue];t[this.__attributeIndex]=e,this.__part._$setValue(t,this,0)}}disconnected(){}reconnected(){}}{render(e){return jl}update(e,[t]){var n;const i=t!==this._ref;return i&&void 0!==this._ref&&this._updateRefValue(void 0),(i||this._lastElementForRef!==this._element)&&(this._ref=t,this._context=null===(n=e.options)||void 0===n?void 0:n.host,this._updateRefValue(this._element=e.element)),jl}_updateRefValue(e){var t;if("function"==typeof this._ref){const n=null!==(t=this._context)&&void 0!==t?t:globalThis;let i=ic.get(n);void 0===i&&(i=new WeakMap,ic.set(n,i)),void 0!==i.get(this._ref)&&this._ref.call(this._context,void 0),i.set(this._ref,e),void 0!==e&&this._ref.call(this._context,e)}else this._ref.value=e}get _lastElementForRef(){var e,t,n;return"function"==typeof this._ref?null===(t=ic.get(null!==(e=this._context)&&void 0!==e?e:globalThis))||void 0===t?void 0:t.get(this._ref):null===(n=this._ref)||void 0===n?void 0:n.value}disconnected(){this._lastElementForRef===this._element&&this._updateRefValue(void 0)}reconnected(){this._updateRefValue(this._element)}},(...e)=>({_$litDirective$:sc,values:e}));var sc;class rc extends p.DropdownPropertyModel{constructor(e,t,n,i,o){super(e,t,n),this.CurrentNode=o,this.WorkFlow=i;let s=this.WorkFlow.GetNodeList();for(let e of s)e.HasGrandParent(o)||this.AddItem(e.Options.Title,e.Options.Id.toString())}SetOnChange(e){return super.SetOnChange((async t=>{let n=await e(t);return!1===n&&this.Instance.TomSelect.setValue(this.GetValue(),!0),n}))}async SetValue(t){if("_new"==t){let n=await l.Dialog.Show(e.html`<rnaut-action-picker-dialog .parent="${this}" .parent="${this.CurrentNode}" .model="${this.WorkFlow}"></rnaut-action-picker-dialog>`);if(null==n)return;if(n.InitializeOptionsForFirstTime(),!await this.OnCreateNode(n))return;t=n.Options.Id,this.Instance.TomSelect.addOption({value:n.Options.Id,text:n.Options.Title}),this.Instance.TomSelect.setValue(t,!0)}super.SetValue(t)}Render(){return e.html`<rnwf-workflow-property ${oc((e=>this.Instance=e))} .model="${this}"></rnwf-workflow-property>`}SetOnCreateNode(e){return this.OnCreateNode=e,this}}var ac={};!function(e){Object.defineProperty(e,"__esModule",{value:!0});var t="envelope",n=[128386,9993,61443],i="f0e0",o="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4L236.8 313.6c11.4 8.5 27 8.5 38.4 0L492.8 150.4c12.1-9.1 19.2-23.3 19.2-38.4c0-26.5-21.5-48-48-48H48zM0 176V384c0 35.3 28.7 64 64 64H448c35.3 0 64-28.7 64-64V176L294.4 339.2c-22.8 17.1-54 17.1-76.8 0L0 176z";e.definition={prefix:"fas",iconName:t,icon:[512,512,n,i,o]},e.faEnvelope=e.definition,e.prefix="fas",e.iconName=t,e.width=512,e.height=512,e.ligatures=n,e.unicode=i,e.svgPathData=o,e.aliases=n}(ac);class lc extends il{GetAllowAddingNodes(){return!1}GetDependencyProperties(){return[{PropertyName:"WorkflowStepAfterAccept",Title:"Approve",Position:"Left",Color:"green"},{PropertyName:"WorkflowStepAfterReject",Title:"Reject",Position:"Right",Color:"red"}]}GetSettings(){let e=[];return this.WorkFlow.GetNodeList(),e.push(new S.UserPropertyModel(null,"AssignTo","Assign to").SetIncludeGroups().SetMultiple().SetOptionsOverwrite(this.Options)),e.push(new p.DropdownPropertyModel(null,"ApprovalType","Approval type").SetOptionsOverwrite(this.Options).AddItem("Only one assignee is required to approve","one").AddItem("All assignees are required to approve","all")),e.push(new rc(null,"WorkflowStepAfterAccept","Workflow Step After Accept",this.WorkFlow,this.WorkFlow.SelectedNode).SetOptionsOverwrite(this.Options).SetOnChange((async e=>this.OnChange(e,"WorkflowStepAfterAccept"))).SetOnCreateNode((async e=>this.MaybeAddChildren(e,"WorkflowStepAfterAccept")))),e.push(new rc(null,"WorkflowStepAfterReject","Workflow Step After Reject",this.WorkFlow,this.WorkFlow.SelectedNode).SetOptionsOverwrite(this.Options).SetOnChange((async e=>this.OnChange(e,"WorkflowStepAfterReject"))).SetOnCreateNode((e=>this.MaybeAddChildren(e,"WorkflowStepAfterReject")))),e.push(new P.CheckboxPropertyModel(null,"DisplayInstructions","Display Instructions").SetRefreshPropertiesPanel().SetOptionsOverwrite(this.Options)),this.Options.DisplayInstructions&&e.push(new w.EmailPropertyModel(null,"HeaderInstructions","Instructions").SetOptionsOverwrite(this.Options)),e}GetAdditionalSettingSections(){let e=new A.AccordionPropertyModel(null);return this.CreateEmail(e,"AssignEmail","Assign"),this.CreateEmail(e,"ApproveEmail","Approve"),this.CreateEmail(e,"RejectEmail","Reject"),[{Label:"Emails",Icon:ac.faEnvelope,Settings:[e],Content:null}]}CreateEmail(e,t,n){let i=e.CreateTab(n),o=this.Options[t];i.AddProperty(new P.CheckboxPropertyModel(null,"Enabled","Enabled").SetOptionsOverwrite(o).SetRefreshPropertiesPanel()),o.Enabled&&(i.AddProperty(new T.EmailAddressPropertyModel(this.RootNode.Model,"To","To").SetOptionsOverwrite(o).AddCustomValue("Assignee(s)","Assignee")),i.AddProperty(new M.TextWithTagsPropertyModel(this.RootNode.Model,"Subject","Subject").SetAddFieldsGroup().SetOptionsOverwrite(o).SetAddEntryInfoGroup()),i.AddProperty(new D.SimpleTextPropertyModel(this.RootNode.Model,"FromName","From Name").SetPlaceholder("Default").SetOptionsOverwrite(o)),i.AddProperty(new D.SimpleTextPropertyModel(this.RootNode.Model,"FromEmailAddress","From email address").SetPlaceholder("Default").SetOptionsOverwrite(o)),i.AddProperty(new T.EmailAddressPropertyModel(this.RootNode.Model,"ReplyTo","Reply to").SetOptionsOverwrite(o)),i.AddProperty(new T.EmailAddressPropertyModel(this.RootNode.Model,"CC","CC").SetOptionsOverwrite(o)),i.AddProperty(new T.EmailAddressPropertyModel(this.RootNode.Model,"BCC","BCC").SetOptionsOverwrite(o)),i.AddProperty(new w.EmailPropertyModel(this.RootNode.Model,"Email","Email").SetOptionsOverwrite(o)))}async OnChange(e,t){let n=this.Options[t],i=this.WorkFlow.SelectedNode,o=i.Children.find((e=>e.Options.Id==n));if(null!=o&&o.Options.Id!=e){if(!await E.ConfirmDialog.Show("Continue","This will remove your previously configured node, do you wish to continue?"))return!1;i.Children.splice(i.Children.indexOf(o),1)}this.Options[t]=e}async MaybeAddChildren(e,t){let n=this.Options[t],i=this.WorkFlow.SelectedNode,o=i.Children.find((e=>e.Options.Id==n));if(null!=o){if(!await E.ConfirmDialog.Show("Continue","This will remove your previously configured node, do you wish to continue?"))return!1;i.Children.splice(i.Children.indexOf(o),1)}return i.Children.push(e),!0}InitializeOptionsForFirstTime(){super.InitializeOptionsForFirstTime(),this.Options.AssignEmail.Enabled=!0,this.Options.AssignEmail.To.push((new k.EmailAddress).Merge({Type:k.EmailAddressEnum.Custom,Value:"Assignee"})),this.Options.AssignEmail.Subject={type:"doc",content:[{type:"field",attrs:{Type:"fixed",Value:"EntryNumber",AdditionalOptions:null}},{type:"text",text:" entry is waiting your approval"}]},this.Options.AssignEmail.Email={type:"doc",content:[{type:"paragraph",attrs:{align:null},content:[{type:"text",text:"Entry "},{type:"field",attrs:{type:"fixed",id:"EntryNumber",options:""},marks:[{type:"link",attrs:{href:"",target:"_blank",type:"EntryURL"}}]},{type:"text",text:" is pending your approval, please go to the entries screen and approve your entry"}]}]},this.Options.ApproveEmail.Enabled=!0,this.Options.ApproveEmail.To.push((new k.EmailAddress).Merge({Type:k.EmailAddressEnum.Custom,Value:"Assignee"})),this.Options.ApproveEmail.Subject={type:"doc",content:[{type:"field",attrs:{Type:"fixed",Value:"EntryNumber",AdditionalOptions:null}},{type:"text",text:" was approved"}]},this.Options.ApproveEmail.Email={type:"doc",content:[{type:"paragraph",attrs:{align:null},content:[{type:"text",text:"Entry "},{type:"field",attrs:{type:"fixed",id:"EntryNumber",options:""},marks:[{type:"link",attrs:{href:"",target:"_blank",type:"EntryURL"}}]},{type:"text",text:" was approved."}]}]},this.Options.RejectEmail.Enabled=!0,this.Options.RejectEmail.To.push((new k.EmailAddress).Merge({Type:k.EmailAddressEnum.Custom,Value:"Assignee"})),this.Options.RejectEmail.Subject={type:"doc",content:[{type:"field",attrs:{Type:"fixed",Value:"EntryNumber",AdditionalOptions:null}},{type:"text",text:" was rejected"}]},this.Options.RejectEmail.Email={type:"doc",content:[{type:"paragraph",attrs:{align:null},content:[{type:"text",text:"Entry "},{type:"field",attrs:{type:"fixed",id:"EntryNumber",options:""},marks:[{type:"link",attrs:{href:"",target:"_blank",type:"EntryURL"}}]},{type:"text",text:" was rejected."}]}]}}}a.EventManager.Subscribe("GetNode",(e=>{if("approve"==e.Options.Type)return new lc(e.Parent,e.Options).Initialize()})),i.customElement("rnaut-action-picker-dialog")(class extends x.DialogBase{InternalGetOptions(){return{Title:"Select an action",Styles:{width:"600px",maxWidth:"80%"}}}SubRender(){return e.html` <div style="display: flex;flex-wrap: wrap;"> <table style="border-collapse: collapse;width: 100%;" class="tableAction"> ${s.repeat(_.ActionDictionary,(e=>e.Type),(t=>e.html` <tr> <td class="actionItem" @click="${()=>this.ActionSelected(t.Type)}"> <label class="title">${t.Title}</label> <p class="description"> ${t.Description} </p> </td> </tr> `))} ${s.repeat(el,(e=>e.Type),(t=>e.html` <tr> <td class="actionItem" @click="${()=>this.WorkFlowSelected(t.Type)}"> <label class="title">${t.Title}</label> <p class="description"> ${t.Description} </p> </td> </tr> `))} </table> </div>`}WorkFlowSelected(e){"approve"==e&&this.SendResult(new lc(this.parent,(new tl).Merge()).Initialize())}ActionSelected(e){let t=(new Ga).Merge({Title:_.ActionDictionary.find((t=>t.Type==e)).Title,ActionOptions:{Type:e}});this.SendResult(new Ta(this.parent,t).Initialize())}}),f.WpAjaxPost.SetGlobalVar(rnBuilderVar);let cc=new wa((new Da).Merge(rnBuilderVar.Options)),uc=document.getElementById("app");uc.style.height=window.innerHeight-uc.getBoundingClientRect().top+"px",window.rnAutomationBuilder=cc,e.render(cc.render(),document.getElementById("app"))}));
