rndefine("#RNAUTODesigner",["#RNAUTOCore/EventManager","#RNAUTOTextEditor/SchemaBase","#RNAUTOTextEditor/MenuItem","#RNAUTODialog/Dialog","lit","#RNAUTODialog/DialogBase","lit/decorators","#RNAUTOCommonLibs/DropdownProperty.Model","#RNAUTOCommonLibs/SimpleTextProperty.Model"],(function(e,t,n,i,o,r,a,l,s){"use strict";var u={};!function(e){Object.defineProperty(e,"__esModule",{value:!0});var t="plus",n=[10133,61543,"add"],i="M256 80c0-17.7-14.3-32-32-32s-32 14.3-32 32V224H48c-17.7 0-32 14.3-32 32s14.3 32 32 32H192V432c0 17.7 14.3 32 32 32s32-14.3 32-32V288H400c17.7 0 32-14.3 32-32s-14.3-32-32-32H256V80z";e.definition={prefix:"fas",iconName:t,icon:[448,512,n,"2b",i]},e.faPlus=e.definition,e.prefix="fas",e.iconName=t,e.width=448,e.height=512,e.ligatures=n,e.unicode="2b",e.svgPathData=i,e.aliases=n}(u),a.customElement("rnaut-email-automation-dialog")(class extends r.DialogBase{constructor(...e){super(...e),this.AutomationId="",this.LinkTarget="_self",this.LinkText="Click here to execute"}InternalGetOptions(){return{Title:"Please select an automation",ShowApplyButton:!0,CloseButtonTitle:"Cancel",Styles:{width:"500px",maxWidth:"80%"}}}SubRender(){let e=this.GetAutomationsForForm();if(0==e.length)return o.html`There are no automations for this form, please create one first`;let t=new l.DropdownPropertyModel(null,"","Automation").SetOnGetValue((()=>this.AutomationId)).SetOnChange((e=>(this.AutomationId=e,!1)));for(let n of e)t.AddItem(n.Name,n.Id);let n=new l.DropdownPropertyModel(null,"","Link Target").SetOnGetValue((()=>this.LinkTarget)).SetOnChange((e=>(this.LinkTarget=e,!1)));n.AddItem("Same tab","_self"),n.AddItem("New tab","_blank");let i=new s.SimpleTextPropertyModel(null,"","Link Text").SetOnGetValue((()=>this.LinkText)).SetOnChange((e=>(this.LinkText=e,!1)));return o.html` ${t.Render()} ${n.Render()} ${i.Render()} `}async OnApply(){return this.SendResult({id:this.AutomationId,linkTarget:this.LinkTarget,linkText:this.LinkText}),!0}GetAutomationsForForm(){return null==rnAutoDesignerVar?[]:rnAutoDesignerVar.AutomationList.filter((e=>e.FormId==this.formBuilder.Id.toString()))}});class d extends t.SchemaBase{constructor(e){super(),this.FormBuilder=e}GetNodes(){return{automation:{inline:!1,attrs:{options:{default:null},id:{default:null},linkTarget:{default:"_blank"},linkText:{default:""}},group:"block",draggable:!1,parseDOM:[{tag:"auto",getAttrs:e=>({options:e.getAttribute("data-options")})}],toDOM:e=>{let t="Unknown automation";try{let n=e.attrs.id;if(null!=rnAutoDesignerVar){let e=rnAutoDesignerVar.AutomationList.find((e=>e.Id==n));null!=e&&(t=e.Name)}}catch(e){}return o.renderInline(o.html`<div style="padding:0 2px;border: 1px solid #999;display: inline-block;background-color: #efefef">Auto: ${t}</div>`)}}}}GetMenuItems(){return[new n.MenuItem({title:"Automations",render:()=>o.renderInline(o.html`<div class="MenuNode" style="cursor:pointer;display: flex;align-items: center;" title="Insert Condition"><rn-fontawesome style="margin-right: 3px;font-size: 16px" .icon="${u.faPlus}"></rn-fontawesome>Automations</div>`),enable:function(e){return!0},run:async(e,t,n)=>{let r=await i.Dialog.Show(o.html`<rnaut-email-automation-dialog .formBuilder="${this.FormBuilder}"></rnaut-email-automation-dialog>`);null!=r&&(n.dispatch(n.state.tr.replaceSelectionWith(e.doc.type.schema.nodes.automation.createAndFill(r))),n.focus())}})]}}e.EventManager.Subscribe("GetEmailNodes",(e=>{e.Nodes.push(new d(e.FormBuilder))}))}));
